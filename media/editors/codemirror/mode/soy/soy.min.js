!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../htmlmixed/htmlmixed"],a):a(CodeMirror)}(function(a){"use strict";var b=["template","literal","msg","fallbackmsg","let","if","elseif","else","switch","case","default","foreach","ifempty","for","call","param","deltemplate","delcall","log"];a.defineMode("soy",function(c){function d(a){return a[a.length-1]}function e(a,b,c){var d=a.string,e=c.exec(d.substr(a.pos));e&&(a.string=d.substr(0,a.pos+e.index));var f=a.hideFirstChars(b.indent,function(){return b.localMode.token(a,b.localState)});return a.string=d,f}var f=a.getMode(c,"text/plain"),g={html:a.getMode(c,{name:"text/html",multilineTagIndentFactor:2,multilineTagIndentPastTag:!1}),attributes:f,text:f,uri:f,css:a.getMode(c,"text/css"),js:a.getMode(c,{name:"text/javascript",statementIndent:2*c.indentUnit})};return{startState:function(){return{kind:[],kindTag:[],soyState:[],indent:0,localMode:g.html,localState:a.startState(g.html)}},copyState:function(b){return{tag:b.tag,kind:b.kind.concat([]),kindTag:b.kindTag.concat([]),soyState:b.soyState.concat([]),indent:b.indent,localMode:b.localMode,localState:a.copyState(b.localMode,b.localState)}},token:function(f,h){var i;switch(d(h.soyState)){case"comment":return f.match(/^.*?\*\//)?h.soyState.pop():f.skipToEnd(),"comment";case"variable":return f.match(/^}/)?(h.indent-=2*c.indentUnit,h.soyState.pop(),"variable-2"):(f.next(),null);case"tag":if(f.match(/^\/?}/))return"/template"==h.tag||"/deltemplate"==h.tag?h.indent=0:h.indent-=("/}"==f.current()||-1==b.indexOf(h.tag)?2:1)*c.indentUnit,h.soyState.pop(),"keyword";if(f.match(/^([\w?]+)(?==)/)){if("kind"==f.current()&&(i=f.match(/^="([^"]+)/,!1))){var j=i[1];h.kind.push(j),h.kindTag.push(h.tag),h.localMode=g[j]||g.html,h.localState=a.startState(h.localMode)}return"attribute"}return f.match(/^"/)?(h.soyState.push("string"),"string"):(f.next(),null);case"literal":return f.match(/^(?=\{\/literal})/)?(h.indent-=c.indentUnit,h.soyState.pop(),this.token(f,h)):e(f,h,/\{\/literal}/);case"string":return f.match(/^.*?"/)?h.soyState.pop():f.skipToEnd(),"string"}return f.match(/^\/\*/)?(h.soyState.push("comment"),"comment"):f.match(f.sol()?/^\s*\/\/.*/:/^\s+\/\/.*/)?"comment":f.match(/^\{\$[\w?]*/)?(h.indent+=2*c.indentUnit,h.soyState.push("variable"),"variable-2"):f.match(/^\{literal}/)?(h.indent+=c.indentUnit,h.soyState.push("literal"),"keyword"):(i=f.match(/^\{([\/@\\]?[\w?]*)/))?("/switch"!=i[1]&&(h.indent+=(/^(\/|(else|elseif|case|default)$)/.test(i[1])&&"switch"!=h.tag?1:2)*c.indentUnit),h.tag=i[1],h.tag=="/"+d(h.kindTag)&&(h.kind.pop(),h.kindTag.pop(),h.localMode=g[d(h.kind)]||g.html,h.localState=a.startState(h.localMode)),h.soyState.push("tag"),"keyword"):e(f,h,/\{|\s+\/\/|\/\*/)},indent:function(b,e){var f=b.indent,g=d(b.soyState);if("comment"==g)return a.Pass;if("literal"==g)/^\{\/literal}/.test(e)&&(f-=c.indentUnit);else{if(/^\s*\{\/(template|deltemplate)\b/.test(e))return 0;/^\{(\/|(fallbackmsg|elseif|else|ifempty)\b)/.test(e)&&(f-=c.indentUnit),"switch"!=b.tag&&/^\{(case|default)\b/.test(e)&&(f-=c.indentUnit),/^\{\/switch\b/.test(e)&&(f-=c.indentUnit)}return f&&b.localMode.indent&&(f+=b.localMode.indent(b.localState,e)),f},innerMode:function(a){return a.soyState.length&&"literal"!=d(a.soyState)?null:{state:a.localState,mode:a.localMode}},electricInput:/^\s*\{(\/|\/template|\/deltemplate|\/switch|fallbackmsg|elseif|else|case|default|ifempty|\/literal\})$/,lineComment:"//",blockCommentStart:"/*",blockCommentEnd:"*/",blockCommentContinue:" * ",fold:"indent"}},"htmlmixed"),a.registerHelper("hintWords","soy",b.concat(["delpackage","namespace","alias","print","css","debugger"])),a.defineMIME("text/x-soy","soy")});