!function(a){"use strict";a.subformRepeatable=function(b,c){if(this.$container=a(b),this.$container.data("subformRepeatable"))return d;this.$container.data("subformRepeatable",d),this.options=a.extend({},a.subformRepeatable.defaults,c),this.template="",this.prepareTemplate(),this.$containerRows=this.options.rowsContainer?this.$container.find(this.options.rowsContainer):this.$container,this.lastRowNum=this.$containerRows.find(this.options.repeatableElement).length;var d=this;this.$container.on("click",this.options.btAdd,function(b){b.preventDefault();var c=a(this).parents(d.options.repeatableElement);c.length||(c=null),d.addRow(c)}),this.$container.on("click",this.options.btRemove,function(b){b.preventDefault();var c=a(this).parents(d.options.repeatableElement);d.removeRow(c)}),this.options.btMove&&a.fn.sortable&&this.$containerRows.sortable({items:this.options.repeatableElement,handle:this.options.btMove,tolerance:"pointer"}),this.$container.trigger("subform-ready")},a.subformRepeatable.prototype.prepareTemplate=function(){if(this.options.rowTemplateSelector){var b=this.$container.find(this.options.rowTemplateSelector)[0]||{};this.template=a.trim(b.text||b.textContent)}else{var c=this.$container.find(this.options.repeatableElement).get(0),d=a(c).clone();try{this.clearScripts(d)}catch(a){window.console&&console.log(a)}this.template=d.prop("outerHTML")}},a.subformRepeatable.prototype.addRow=function(b){var c=this.$containerRows.find(this.options.repeatableElement).length;if(c>=this.options.maximum)return null;var d=a.parseHTML(this.template);b?a(b).after(d):this.$containerRows.append(d);var e=a(d);e.attr("data-new","true"),this.fixUniqueAttributes(e,c);try{this.fixScripts(e)}catch(a){window.console&&console.log(a)}return this.$container.trigger("subform-row-add",e),e},a.subformRepeatable.prototype.removeRow=function(a){var b=this.$containerRows.find(this.options.repeatableElement).length;b<=this.options.minimum||(this.$container.trigger("subform-row-remove",a),a.remove())},a.subformRepeatable.prototype.fixUniqueAttributes=function(b,c){this.lastRowNum++;var d=b.attr("data-group"),e=b.attr("data-base-name"),c=c||0,f=Math.max(this.lastRowNum,c+1),g=e+f;this.lastRowNum=f,b.attr("data-group",g);for(var h=b.find("*[name]"),i={},j=0,k=h.length;j<k;j++){var l=a(h[j]),m=l.attr("name"),n=m.replace(/(\]|\[\]$)/g,"").replace(/\[/g,"_"),o=m.replace("["+d+"][","["+g+"]["),p=n.replace(d,g),q=n;if("checkbox"===l.prop("type")){if(m.match(/\[\]$/)){var r=b.find('label[for="'+n+'"]');r.length&&(r.attr("for",p),l.parents("fieldset.checkboxes").attr("id",p));var c=i[n]?i[n].length:0;q+=c,p+=c}}else if("radio"===l.prop("type")){var c=i[n]?i[n].length:0;q+=c,p+=c}i[n]?i[n].push(!0):i[n]=[!0],l.attr("name",o),l.attr("id",p),b.find('label[for="'+q+'"]').attr("for",p)}},a.subformRepeatable.prototype.clearScripts=function(b){a.fn.chosen&&b.find("select.chzn-done").each(function(){var b=a(this);b.next(".chzn-container").remove(),b.show().addClass("fix-chosen")}),a.fn.minicolors&&b.find(".minicolors input").each(function(){a(this).minicolors("destroy",a(this))})},a.subformRepeatable.prototype.fixScripts=function(b){b.find(".minicolors").each(function(){var b=a(this);b.minicolors({control:b.attr("data-control")||"hue",position:b.attr("data-position")||"right",theme:"bootstrap"})}),b.find('a[onclick*="jInsertFieldValue"]').each(function(){var b=a(this),c=b.siblings('input[type="text"]').attr("id"),d=b.prev(),e=d.attr("href");b.attr("onclick","jInsertFieldValue('', '"+c+"');return false;"),d.attr("href",e.replace(/&fieldid=(.+)&/,"&fieldid="+c+"&"))}),a.fn.fieldMedia&&b.find(".field-media-wrapper").fieldMedia(),a.fn.tooltip&&b.find(".hasTooltip").tooltip({html:!0,container:"body"}),a.fn.fieldUser&&b.find(".field-user-wrapper").fieldUser(),window.SqueezeBox&&window.SqueezeBox.assign&&SqueezeBox.assign(b.find("a.modal").get(),{parse:"rel"})},a.subformRepeatable.defaults={btAdd:".group-add",btRemove:".group-remove",btMove:".group-move",minimum:0,maximum:10,repeatableElement:".subform-repeatable-group",rowTemplateSelector:"script.subform-repeatable-template-section",rowsContainer:null},a.fn.subformRepeatable=function(b){return this.each(function(){var b=b||{},c=a(this).data();if(!c.subformRepeatable){for(var d in c)c.hasOwnProperty(d)&&(b[d]=c[d]);var e=new a.subformRepeatable(this,b);a(this).data("subformRepeatable",e)}})},a(window).on("load",function(){a("div.subform-repeatable").subformRepeatable()})}(jQuery);