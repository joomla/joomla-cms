(function(){"use strict";var Searchtools=function(element,options){var defaults={formSelector:".js-stools-form",searchFieldSelector:".js-stools-field-search",clearBtnSelector:".js-stools-btn-clear",mainContainerSelector:".js-stools",searchBtnSelector:".js-stools-btn-search",filterBtnSelector:".js-stools-btn-filter",filterContainerSelector:".js-stools-container-filters",filtersHidden:true,listBtnSelector:".js-stools-btn-list",listContainerSelector:".js-stools-container-list",listHidden:true,orderColumnSelector:".js-stools-column-order",orderBtnSelector:".js-stools-btn-order",orderFieldSelector:".js-stools-field-order",orderFieldName:"list[fullordering]",limitFieldSelector:".js-stools-field-limit",defaultLimit:20,activeOrder:null,activeDirection:"ASC",clearListOptions:false};this.element=element;this.options=Joomla.extend(defaults,options);this.theForm=document.querySelector(this.options.formSelector);this.filterButton=document.querySelector(this.options.formSelector+" "+this.options.filterBtnSelector);this.filterContainer=document.querySelector(this.options.formSelector+" "+this.options.filterContainerSelector)?document.querySelector(this.options.formSelector+" "+this.options.filterContainerSelector):"";this.filtersHidden=this.options.filtersHidden;this.listButton=document.querySelector(this.options.listBtnSelector);this.listContainer=document.querySelector(this.options.formSelector+" "+this.options.listContainerSelector);this.listHidden=this.options.listHidden;this.mainContainer=document.querySelector(this.options.mainContainerSelector);this.searchButton=document.querySelector(this.options.formSelector+" "+this.options.searchBtnSelector);this.searchField=document.querySelector(this.options.formSelector+" "+this.options.searchFieldSelector);this.searchString=null;this.clearButton=document.querySelector(this.options.clearBtnSelector);this.orderCols=Array.prototype.slice.call(document.querySelectorAll(this.options.formSelector+" "+this.options.orderColumnSelector));this.orderField=document.querySelector(this.options.formSelector+" "+this.options.orderFieldSelector);this.limitField=document.querySelector(this.options.formSelector+" "+this.options.limitFieldSelector);this.activeColumn=null;this.activeDirection=this.options.activeDirection;this.activeOrder=this.options.activeOrder;this.activeLimit=null;this.clearListOptions=this.options.clearListOptions;this.init()};Searchtools.prototype={init:function(){var self=this;if(!document.addEventListener){if(this.searchField.value===this.searchField.getAttribute("placeholder")){this.searchField.value=""}}this.searchString=this.searchField.value;if(this.filterContainer&&this.filterContainer.classList.contains("js-stools-container-filters-visible")){this.showFilters();this.showList()}else{this.hideFilters();this.hideList()}if(self.filterButton){self.filterButton.addEventListener("click",function(e){self.toggleFilters();e.stopPropagation();e.preventDefault()})}if(self.listButton){self.listButton.addEventListener("click",function(e){self.toggleList();e.stopPropagation();e.preventDefault()})}if(self.getFilterFields()){self.getFilterFields().forEach(function(i){self.checkFilter(i);i.addEventListener("change",function(){self.checkFilter(i)})})}if(self.clearButton){self.clearButton.addEventListener("click",function(){self.clear()})}this.createOrderField();self.orderCols.forEach(function(item){item.addEventListener("click",function(){var newOrderCol=this.getAttribute("data-order");var newDirection=this.getAttribute("data-direction");var newOrdering=newOrderCol+" "+newDirection;if(newOrderCol.length){self.activeColumn=newOrderCol;if(newOrdering!==self.activeOrder){self.activeDirection=newDirection;self.activeOrder=newOrdering;self.updateFieldValue(self.orderField,newOrdering)}else{self.toggleDirection()}self.theForm.submit()}})});self.checkActiveStatus(self);document.body.addEventListener("click",function(e){if(document.body.classList.contains("filters-shown")){self.hideFilters()}});self.filterContainer.addEventListener("click",function(e){e.stopPropagation()},true)},checkFilter:function(element){var self=this;var option=element.querySelector("option:checked");if(option){if(option.value!==""){self.activeFilter(element,self)}else{self.deactiveFilter(element,self)}}},clear:function(){var self=this;if(self.searchField){self.searchField.value=""}if(self.getFilterFields()){self.getFilterFields().forEach(function(i){i.value="";self.checkFilter(i);if(window.jQuery&&jQuery.chosen){jQuery(i).trigger("liszt:updated")}})}if(self.clearListOptions){self.getListFields().forEach(function(i){i.value="";self.checkFilter(i);if(window.jQuery&&jQuery.chosen){jQuery(i).trigger("liszt:updated")}});document.querySelector("#list_limit").value=self.options.defaultLimit;if(window.jQuery&&jQuery.chosen){jQuery("#list_limit").trigger("liszt:updated")}}self.theForm.submit()},checkActiveStatus:function(cont){var el=cont.mainContainer;var els=[].slice.call(el.querySelectorAll(".js-stools-field-filter select"));els.forEach(function(item){if(item.classList.contains("active")){cont.filterButton.classList.remove("btn-secondary");cont.filterButton.classList.add("btn-primary");return""}})},activeFilter:function(element,cont){element.classList.add("active");var chosenId="#"+element.getAttribute("id");var tmpEl=element.querySelector(chosenId);if(tmpEl){tmpEl.classList.add("active")}},deactiveFilter:function(element,cont){element.classList.remove("active");var chosenId="#"+element.getAttribute("id");var tmpEl=element.querySelector(chosenId);if(tmpEl){tmpEl.classList.remove("active")}},getFilterFields:function(){if(this.filterContainer){return Array.prototype.slice.call(this.filterContainer.querySelectorAll("select,input"))}},getListFields:function(){return Array.prototype.slice.call(this.listContainer.querySelectorAll("select"))},hideContainer:function(container){if(container){container.classList.remove("js-filters-show");document.body.classList.remove("filters-shown")}},showContainer:function(container){container.classList.add("js-filters-show");document.body.classList.add("filters-shown")},toggleContainer:function(container){if(container.classList.contains("js-filters-show")){this.hideContainer(container)}else{this.showContainer(container)}},hideList:function(){this.hideContainer(this.filterContainer)},showList:function(){this.showContainer(this.filterContainer)},toggleList:function(){this.toggleContainer(this.filterContainer)},hideFilters:function(){this.hideContainer(this.filterContainer)},showFilters:function(){this.showContainer(this.filterContainer)},toggleFilters:function(){this.toggleContainer(this.filterContainer)},toggleDirection:function(){var self=this;var newDirection="ASC";if(self.activeDirection.toUpperCase()=="ASC"){newDirection="DESC"}self.activeDirection=newDirection;self.activeOrder=self.activeColumn+" "+newDirection;self.updateFieldValue(self.orderField,self.activeOrder)},createOrderField:function(){var self=this;if(!this.orderField){this.orderField=document.createElement("input");this.orderField.setAttribute("type","hidden");this.orderField.setAttribute("id","js-stools-field-order");this.orderField.setAttribute("class","js-stools-field-order");this.orderField.setAttribute("name",self.options.orderFieldName);this.orderField.setAttribute("value",self.activeOrder+" "+this.activeDirection);this.theForm.innerHTML+=this.orderField.outerHTML}if(this.orderField.tagName.toLowerCase()=="select"){var allOptions=this.orderField.options;for(var i=0,l=allOptions.length;l>i;i++){var value=allOptions[i].getAttribute("data-order");var name=allOptions[i].getAttribute("data-name");var direction=allOptions[i].getAttribute("data-direction");if(value&&value.length){value=value+" "+direction;var $option=self.findOption(self.orderField,value);if(!$option.length){var $option=document.createElement("option");$option.text=name;$option.value=value;if(allOptions[i].classList.contains("active")){$option.setAttribute("selected","selected")}self.orderFieldName.innerHTML+=$option}}}if(window.jQuery&&jQuery.chosen){jQuery(this.orderField).trigger("liszt:updated")}}this.activeOrder=this.orderField.value},updateFieldValue:function(field,newValue){var self=this,type=field.getAttribute("type");if(type==="hidden"||type==="text"){field.setAttribute("value",newValue)}else if(field.tagName.toLowerCase()==="select"){var allOptions=field.options;for(var i=0,l=allOptions.length;l>i;i++){if(allOptions[i].value==newValue){var desiredOption=allOptions[i]}}if(desiredOption&&desiredOption.length){desiredOption.setAttribute("selected","selected")}else{var option=document.createElement("option");option.text=name;option.value=newValue;option.setAttribute("selected","selected");field.appendChild(option)}field.value=newValue;if(window.jQuery&&jQuery.chosen){field.trigger("liszt:updated")}}},findOption:function(select,value){for(var i=0,l=select.length;l>i;i++){if(select[i].value==value){return select[i]}}}};document.addEventListener("DOMContentLoaded",function(){if(Joomla.getOptions("searchtools")){var options=Joomla.getOptions("searchtools"),element=document.querySelector(options.selector);new Searchtools(element,options)}})})();
