function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _iterableToArray(a){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}window.Joomla=window.Joomla||{},function(a,b){'use strict';var c=function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",d="";return Object.keys(a).forEach(function(e){return"object"===_typeof(a[e])?void(d+="".concat(c(a[e],e))):(0<d.length&&(d+="&"),void(d+=""===b?"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(a[e])):"".concat(encodeURIComponent(b),"[").concat(encodeURIComponent(e),"]=").concat(encodeURIComponent(a[e]))))}),d},d=function(b){a.renderMessages({error:[b]})};a.plgSystemWebauthnCreateCredentials=function(e,f){if(!("credentials"in navigator))return void a.renderMessages({error:[a.JText._("PLG_SYSTEM_WEBAUTHN_ERR_NO_BROWSER_SUPPORT")]});var g=b.getElementById(e);if(g){var h=JSON.parse(atob(g.dataset.public_key)),i=atob(g.dataset.postback_url),j=function(b){return btoa(String.fromCharCode.apply(String,_toConsumableArray(b)))},k=function(a){var b=a.replace(/-/g,"+").replace(/_/g,"/"),c=b.length%4;if(c){if(1===c)throw new Error("InvalidLengthError: Input base64url string is the wrong length to determine padding");b+=Array(5-c).join("=")}return b};h.challenge=Uint8Array.from(window.atob(k(h.challenge)),function(a){return a.charCodeAt(0)}),h.user.id=Uint8Array.from(window.atob(h.user.id),function(a){return a.charCodeAt(0)}),h.excludeCredentials&&(h.excludeCredentials=h.excludeCredentials.map(function(a){return a.id=Uint8Array.from(window.atob(k(a.id)),function(a){return a.charCodeAt(0)}),a})),navigator.credentials.create({publicKey:h}).then(function(e){var g={id:e.id,type:e.type,rawId:j(new Uint8Array(e.rawId)),response:{clientDataJSON:j(new Uint8Array(e.response.clientDataJSON)),attestationObject:j(new Uint8Array(e.response.attestationObject))}},h={option:"com_ajax",group:"system",plugin:"webauthn",format:"raw",akaction:"create",encoding:"raw",data:btoa(JSON.stringify(g))};a.request({url:i,method:"POST",data:c(h),onSuccess:function onSuccess(a){var c=b.querySelectorAll(f);if(c){var d=c[0];d.outerHTML=a}},onError:function onError(a){d("".concat(a.status," ").concat(a.statusText))}})}).catch(function(a){d(a)})}},a.plgSystemWebauthnEditLabel=function(e,f){var g=b.getElementById(f);if(!g)return!1;var h=atob(g.dataset.postback_url),i=e.parentElement.parentElement,j=i.dataset.credential_id,k=i.querySelectorAll("td"),l=k[0],m=k[1],n=m.querySelectorAll("button"),o=n[0],p=n[1],q=l.innerText,r=b.createElement("input");r.type="text",r.name="label",r.defaultValue=q;var s=b.createElement("button");s.className="btn btn-success btn-sm",s.innerText=a.JText._("PLG_SYSTEM_WEBAUTHN_MANAGE_BTN_SAVE_LABEL"),s.addEventListener("click",function(){var b=r.value;if(""!==b){a.request({url:h,method:"POST",data:c({option:"com_ajax",group:"system",plugin:"webauthn",format:"json",encoding:"json",akaction:"savelabel",credential_id:j,new_label:b}),onSuccess:function onSuccess(b){var c=!1;try{c=JSON.parse(b)}catch(a){c="true"===b}!0!==c&&d(a.JText._("PLG_SYSTEM_WEBAUTHN_ERR_LABEL_NOT_SAVED"))},onError:function onError(b){d("".concat(a.JText._("PLG_SYSTEM_WEBAUTHN_ERR_LABEL_NOT_SAVED")," -- ").concat(b.status," ").concat(b.statusText))}})}return l.innerText=b,o.disabled=!1,p.disabled=!1,!1},!1);var t=b.createElement("button");return t.className="btn btn-danger btn-sm",t.innerText=a.JText._("PLG_SYSTEM_WEBAUTHN_MANAGE_BTN_CANCEL_LABEL"),t.addEventListener("click",function(){return l.innerText=q,o.disabled=!1,p.disabled=!1,!1},!1),l.innerHTML="",l.appendChild(r),l.appendChild(s),l.appendChild(t),o.disabled=!0,p.disabled=!0,!1},a.plgSystemWebauthnDelete=function(e,f){var g=b.getElementById(f);if(!g)return!1;var h=atob(g.dataset.postback_url),i=e.parentElement.parentElement,j=i.dataset.credential_id,k=i.querySelectorAll("td"),l=k[1],m=l.querySelectorAll("button"),n=m[0],o=m[1];n.disabled=!0,o.disabled=!0;return a.request({url:h,method:"POST",data:c({option:"com_ajax",group:"system",plugin:"webauthn",format:"json",encoding:"json",akaction:"delete",credential_id:j}),onSuccess:function onSuccess(b){var c=!1;try{c=JSON.parse(b)}catch(a){c="true"===b}return!0===c?void i.parentElement.removeChild(i):void d(a.JText._("PLG_SYSTEM_WEBAUTHN_ERR_NOT_DELETED"))},onError:function onError(b){n.disabled=!1,o.disabled=!1,d("".concat(a.JText._("PLG_SYSTEM_WEBAUTHN_ERR_NOT_DELETED")," -- ").concat(b.status," ").concat(b.statusText))}}),!1},b.addEventListener("DOMContentLoaded",function(){var c=b.getElementById("plg_system_webauthn-manage-add");c&&c.addEventListener("click",function(b){var c=b.currentTarget;a.plgSystemWebauthnCreateCredentials(c.getAttribute("data-random-id"),"#plg_system_webauthn-management-interface")});var d=[].slice.call(b.querySelectorAll(".plg_system_webauthn-manage-edit"));d.length&&d.forEach(function(b){b.addEventListener("click",function(b){var c=b.currentTarget;a.plgSystemWebauthnEditLabel(c,c.getAttribute("data-random-id"))})});var e=[].slice.call(b.querySelectorAll(".plg_system_webauthn-manage-delete"));e.length&&e.forEach(function(b){b.addEventListener("click",function(b){var c=b.currentTarget;a.plgSystemWebauthnDelete(c,c.getAttribute("data-random-id"))})})})}(window,Joomla);