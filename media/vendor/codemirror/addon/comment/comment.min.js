!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";var n={},t=/[^\s\u00a0]/,i=e.Pos;function l(e){var n=e.search(t);return-1==n?0:n}function o(e,n){var t=e.getMode();return!1!==t.useInnerComments&&t.innerMode?e.getModeAt(n):t}e.commands.toggleComment=function(e){e.toggleComment()},e.defineExtension("toggleComment",function(e){e||(e=n);for(var t=this,l=1/0,o=this.listSelections(),r=null,a=o.length-1;a>=0;a--){var m=o[a].from(),c=o[a].to();m.line>=l||(c.line>=l&&(c=i(l,0)),l=m.line,null==r?t.uncomment(m,c,e)?r="un":(t.lineComment(m,c,e),r="line"):"un"==r?t.uncomment(m,c,e):t.lineComment(m,c,e))}}),e.defineExtension("lineComment",function(e,r,a){a||(a=n);var m=this,c=o(m,e),f=m.getLine(e.line);if(null!=f&&(g=e,s=f,!/\bstring\b/.test(m.getTokenTypeAt(i(g.line,0)))||/^[\'\"\`]/.test(s))){var g,s,d=a.lineComment||c.lineComment;if(d){var u=Math.min(0!=r.ch||r.line==e.line?r.line+1:r.line,m.lastLine()+1),h=null==a.padding?" ":a.padding,p=a.commentBlankLines||e.line==r.line;m.operation(function(){if(a.indent){for(var n=null,o=e.line;o<u;++o){var r=(c=m.getLine(o)).slice(0,l(c));(null==n||n.length>r.length)&&(n=r)}for(o=e.line;o<u;++o){var c=m.getLine(o),f=n.length;(p||t.test(c))&&(c.slice(0,f)!=n&&(f=l(c)),m.replaceRange(n+d+h,i(o,0),i(o,f)))}}else for(o=e.line;o<u;++o)(p||t.test(m.getLine(o)))&&m.replaceRange(d+h,i(o,0))})}else(a.blockCommentStart||c.blockCommentStart)&&(a.fullLines=!0,m.blockComment(e,r,a))}}),e.defineExtension("blockComment",function(e,l,r){r||(r=n);var a=this,m=o(a,e),c=r.blockCommentStart||m.blockCommentStart,f=r.blockCommentEnd||m.blockCommentEnd;if(c&&f){if(!/\bcomment\b/.test(a.getTokenTypeAt(i(e.line,0)))){var g=Math.min(l.line,a.lastLine());g!=e.line&&0==l.ch&&t.test(a.getLine(g))&&--g;var s=null==r.padding?" ":r.padding;e.line>g||a.operation(function(){if(0!=r.fullLines){var n=t.test(a.getLine(g));a.replaceRange(s+f,i(g)),a.replaceRange(c+s,i(e.line,0));var o=r.blockCommentLead||m.blockCommentLead;if(null!=o)for(var d=e.line+1;d<=g;++d)(d!=g||n)&&a.replaceRange(o+s,i(d,0))}else a.replaceRange(f,l),a.replaceRange(c,e)})}}else(r.lineComment||m.lineComment)&&0!=r.fullLines&&a.lineComment(e,l,r)}),e.defineExtension("uncomment",function(e,l,r){r||(r=n);var a,m=this,c=o(m,e),f=Math.min(0!=l.ch||l.line==e.line?l.line:l.line-1,m.lastLine()),g=Math.min(e.line,f),s=r.lineComment||c.lineComment,d=[],u=null==r.padding?" ":r.padding;e:if(s){for(var h=g;h<=f;++h){var p=m.getLine(h),v=p.indexOf(s);if(v>-1&&!/comment/.test(m.getTokenTypeAt(i(h,v+1)))&&(v=-1),-1==v&&t.test(p))break e;if(v>-1&&t.test(p.slice(0,v)))break e;d.push(p)}if(m.operation(function(){for(var e=g;e<=f;++e){var n=d[e-g],t=n.indexOf(s),l=t+s.length;t<0||(n.slice(l,l+u.length)==u&&(l+=u.length),a=!0,m.replaceRange("",i(e,t),i(e,l)))}}),a)return!0}var C=r.blockCommentStart||c.blockCommentStart,b=r.blockCommentEnd||c.blockCommentEnd;if(!C||!b)return!1;var k=r.blockCommentLead||c.blockCommentLead,L=m.getLine(g),x=L.indexOf(C);if(-1==x)return!1;var R=f==g?L:m.getLine(f),O=R.indexOf(b,f==g?x+C.length:0),T=i(g,x+1),y=i(f,O+1);if(-1==O||!/comment/.test(m.getTokenTypeAt(T))||!/comment/.test(m.getTokenTypeAt(y))||m.getRange(T,y,"\n").indexOf(b)>-1)return!1;var E=L.lastIndexOf(C,e.ch),M=-1==E?-1:L.slice(0,e.ch).indexOf(b,E+C.length);if(-1!=E&&-1!=M&&M+b.length!=e.ch)return!1;M=R.indexOf(b,l.ch);var S=R.slice(l.ch).lastIndexOf(C,M-l.ch);return E=-1==M||-1==S?-1:l.ch+S,(-1==M||-1==E||E==l.ch)&&(m.operation(function(){m.replaceRange("",i(f,O-(u&&R.slice(O-u.length,O)==u?u.length:0)),i(f,O+b.length));var e=x+C.length;if(u&&L.slice(e,e+u.length)==u&&(e+=u.length),m.replaceRange("",i(g,x),i(g,e)),k)for(var n=g+1;n<=f;++n){var l=m.getLine(n),o=l.indexOf(k);if(-1!=o&&!t.test(l.slice(0,o))){var r=o+k.length;u&&l.slice(r,r+u.length)==u&&(r+=u.length),m.replaceRange("",i(n,o),i(n,r))}}}),!0)})});