!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";function t(e,t){if(!e.hasOwnProperty(t))throw new Error("Undefined state "+t+" in simple mode")}function n(e,t){if(!e)return/(?:)/;var n="";return e instanceof RegExp?(e.ignoreCase&&(n="i"),e=e.source):e=String(e),new RegExp((!1===t?"":"^")+"(?:"+e+")",n)}function a(e,a){(e.next||e.push)&&t(a,e.next||e.push),this.regex=n(e.regex),this.token=function(e){if(!e)return null;if(e.apply)return e;if("string"==typeof e)return e.replace(/\./g," ");for(var t=[],n=0;n<e.length;n++)t.push(e[n]&&e[n].replace(/\./g," "));return t}(e.token),this.data=e}function r(e,t){if(e===t)return!0;if(!e||"object"!=typeof e||!t||"object"!=typeof t)return!1;var n=0;for(var a in e)if(e.hasOwnProperty(a)){if(!t.hasOwnProperty(a)||!r(e[a],t[a]))return!1;n++}for(var a in t)t.hasOwnProperty(a)&&n--;return 0==n}function o(t,a,o,i){var l;if(o.persistent)for(var s=a.persistentStates;s&&!l;s=s.next)(o.spec?r(o.spec,s.spec):o.mode==s.mode)&&(l=s);var d=l?l.mode:o.mode||e.getMode(t,o.spec),c=l?l.state:e.startState(d);o.persistent&&!l&&(a.persistentStates={mode:d,spec:o.spec,state:c,next:a.persistentStates}),a.localState=c,a.local={mode:d,end:o.end&&n(o.end),endScan:o.end&&!1!==o.forceEnd&&n(o.end,!1),endToken:i&&i.join?i[i.length-1]:i}}e.defineSimpleMode=function(t,n){e.defineMode(t,function(t){return e.simpleMode(t,n)})},e.simpleMode=function(n,r){t(r,"start");var i={},l=r.meta||{},s=!1;for(var d in r)if(d!=l&&r.hasOwnProperty(d))for(var c=i[d]=[],p=r[d],u=0;u<p.length;u++){var f=p[u];c.push(new a(f,r)),(f.indent||f.dedent)&&(s=!0)}var h,g,S,m,v={startState:function(){return{state:"start",pending:null,local:null,localState:null,indent:s?[]:null}},copyState:function(t){var n={state:t.state,pending:t.pending,local:t.local,localState:null,indent:t.indent&&t.indent.slice(0)};t.localState&&(n.localState=e.copyState(t.local.mode,t.localState)),t.stack&&(n.stack=t.stack.slice(0));for(var a=t.persistentStates;a;a=a.next)n.persistentStates={mode:a.mode,spec:a.spec,state:a.state==t.localState?n.localState:e.copyState(a.mode,a.state),next:n.persistentStates};return n},token:(S=i,m=n,function(e,t){if(t.pending){var n=t.pending.shift();return 0==t.pending.length&&(t.pending=null),e.pos+=n.text.length,n.token}if(t.local){if(t.local.end&&e.match(t.local.end)){var a=t.local.endToken||null;return t.local=t.localState=null,a}var r,a=t.local.mode.token(e,t.localState);return t.local.endScan&&(r=t.local.endScan.exec(e.current()))&&(e.pos=e.start+r.index),a}for(var i=S[t.state],l=0;l<i.length;l++){var s=i[l],d=(!s.data.sol||e.sol())&&e.match(s.regex);if(d){s.data.next?t.state=s.data.next:s.data.push?((t.stack||(t.stack=[])).push(t.state),t.state=s.data.push):s.data.pop&&t.stack&&t.stack.length&&(t.state=t.stack.pop()),s.data.mode&&o(m,t,s.data.mode,s.token),s.data.indent&&t.indent.push(e.indentation()+m.indentUnit),s.data.dedent&&t.indent.pop();var c=s.token;if(c&&c.apply&&(c=c(d)),d.length>2&&s.token&&"string"!=typeof s.token){t.pending=[];for(var p=2;p<d.length;p++)d[p]&&t.pending.push({text:d[p],token:s.token[p-1]});return e.backUp(d[0].length-(d[1]?d[1].length:0)),c[0]}return c&&c.join?c[0]:c}}return e.next(),null}),innerMode:function(e){return e.local&&{mode:e.local.mode,state:e.localState}},indent:(h=i,g=l,function(t,n,a){if(t.local&&t.local.mode.indent)return t.local.mode.indent(t.localState,n,a);if(null==t.indent||t.local||g.dontIndentStates&&function(e,t){for(var n=0;n<t.length;n++)if(t[n]===e)return!0}(t.state,g.dontIndentStates)>-1)return e.Pass;var r=t.indent.length-1,o=h[t.state];e:for(;;){for(var i=0;i<o.length;i++){var l=o[i];if(l.data.dedent&&!1!==l.data.dedentIfLineStart){var s=l.regex.exec(n);if(s&&s[0]){r--,(l.next||l.push)&&(o=h[l.next||l.push]),n=n.slice(s[0].length);continue e}}}break}return r<0?0:t.indent[r]})};if(l)for(var k in l)l.hasOwnProperty(k)&&(v[k]=l[k]);return v}});