!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";function n(t){return t.global?t:new RegExp(t.source,function(t){var n=t.flags;return null!=n?n:(t.ignoreCase?"i":"")+(t.global?"g":"")+(t.multiline?"m":"")}(t)+"g")}function e(t,e,r){e=n(e);for(var i=r.line,o=r.ch,l=t.lastLine();i<=l;i++,o=0){e.lastIndex=o;var h=t.getLine(i),c=e.exec(h);if(c)return{from:s(i,c.index),to:s(i,c.index+c[0].length),match:c}}}function r(t,n){for(var e,r=0;;){n.lastIndex=r;var i=n.exec(t);if(!i)return e;if(e=i,(r=e.index+(e[0].length||1))==t.length)return e}}function i(t,n,e,r){if(t.length==n.length)return e;for(var i=0,o=e+Math.max(0,t.length-n.length);;){if(i==o)return i;var l=i+o>>1,h=r(t.slice(0,l)).length;if(h==e)return l;h>e?o=l:i=l+1}}function o(t,o,c,f){this.atOccurrence=!1,this.doc=t,c=c?t.clipPos(c):s(0,0),this.pos={from:c,to:c};var u;"object"==typeof f?u=f.caseFold:(u=f,f=null),"string"==typeof o?(null==u&&(u=!1),this.matches=function(n,e){return(n?function(t,n,e,r){if(!n.length)return null;var o=r?l:h,c=o(n).split(/\r|\n\r?/);t:for(var f=e.line,u=e.ch,a=t.firstLine()-1+c.length;f>=a;f--,u=-1){var g=t.getLine(f);u>-1&&(g=g.slice(0,u));var m=o(g);if(1==c.length){var v=m.lastIndexOf(c[0]);if(-1==v)continue t;return{from:s(f,i(g,m,v,o)),to:s(f,i(g,m,v+c[0].length,o))}}var d=c[c.length-1];if(m.slice(0,d.length)==d){for(var p=1,e=f-c.length+1;p<c.length-1;p++)if(o(t.getLine(e+p))!=c[p])continue t;var L=t.getLine(f+1-c.length),x=o(L);if(x.slice(x.length-c[0].length)==c[0])return{from:s(f+1-c.length,i(L,x,L.length-c[0].length,o)),to:s(f,i(g,m,d.length,o))}}}}:function(t,n,e,r){if(!n.length)return null;var o=r?l:h,c=o(n).split(/\r|\n\r?/);t:for(var f=e.line,u=e.ch,a=t.lastLine()+1-c.length;f<=a;f++,u=0){var g=t.getLine(f).slice(u),m=o(g);if(1==c.length){var v=m.indexOf(c[0]);if(-1==v)continue t;return e=i(g,m,v,o)+u,{from:s(f,i(g,m,v,o)+u),to:s(f,i(g,m,v+c[0].length,o)+u)}}var d=m.length-c[0].length;if(m.slice(d)==c[0]){for(var p=1;p<c.length-1;p++)if(o(t.getLine(f+p))!=c[p])continue t;var L=t.getLine(f+c.length-1),x=o(L),C=c[c.length-1];if(x.slice(0,C.length)==C)return{from:s(f,i(g,m,d,o)+u),to:s(f+c.length-1,i(L,x,C.length,o))}}}})(t,o,e,u)}):(o=n(o),f&&!1===f.multiline?this.matches=function(i,l){return(i?function(t,e,i){e=n(e);for(var o=i.line,l=i.ch,h=t.firstLine();o>=h;o--,l=-1){var c=t.getLine(o);l>-1&&(c=c.slice(0,l));var f=r(c,e);if(f)return{from:s(o,f.index),to:s(o,f.index+f[0].length),match:f}}}:e)(t,o,l)}:this.matches=function(i,l){return(i?function(t,e,i){e=n(e);for(var o,l=1,h=i.line,c=t.firstLine();h>=c;){for(var f=0;f<l;f++){var u=t.getLine(h--);o=null==o?u.slice(0,i.ch):u+"\n"+o}l*=2;var a=r(o,e);if(a){var g=o.slice(0,a.index).split("\n"),m=a[0].split("\n"),v=h+g.length,d=g[g.length-1].length;return{from:s(v,d),to:s(v+m.length-1,1==m.length?d+m[0].length:m[m.length-1].length),match:a}}}}:function(t,r,i){if(!function(t){return/\\s|\\n|\n|\\W|\\D|\[\^/.test(t.source)}(r))return e(t,r,i);r=n(r);for(var o,l=1,h=i.line,c=t.lastLine();h<=c;){for(var f=0;f<l;f++){var u=t.getLine(h++);o=null==o?u:o+"\n"+u}l*=2,r.lastIndex=i.ch;var a=r.exec(o);if(a){var g=o.slice(0,a.index).split("\n"),m=a[0].split("\n"),v=i.line+g.length-1,d=g[g.length-1].length;return{from:s(v,d),to:s(v+m.length-1,1==m.length?d+m[0].length:m[m.length-1].length),match:a}}}})(t,o,l)})}var l,h,s=t.Pos;String.prototype.normalize?(l=function(t){return t.normalize("NFD").toLowerCase()},h=function(t){return t.normalize("NFD")}):(l=function(t){return t.toLowerCase()},h=function(t){return t}),o.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(n){for(var e=this.matches(n,this.doc.clipPos(n?this.pos.from:this.pos.to));e&&0==t.cmpPos(e.from,e.to);)n?e.from.ch?e.from=s(e.from.line,e.from.ch-1):e=e.from.line==this.doc.firstLine()?null:this.matches(n,this.doc.clipPos(s(e.from.line-1))):e.to.ch<this.doc.getLine(e.to.line).length?e.to=s(e.to.line,e.to.ch+1):e=e.to.line==this.doc.lastLine()?null:this.matches(n,s(e.to.line+1,0));if(e)return this.pos=e,this.atOccurrence=!0,this.pos.match||!0;var r=s(n?this.doc.firstLine():this.doc.lastLine()+1,0);return this.pos={from:r,to:r},this.atOccurrence=!1},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(n,e){if(this.atOccurrence){var r=t.splitLines(n);this.doc.replaceRange(r,this.pos.from,this.pos.to,e),this.pos.to=s(this.pos.from.line+r.length-1,r[r.length-1].length+(1==r.length?this.pos.from.ch:0))}}},t.defineExtension("getSearchCursor",function(t,n,e){return new o(this.doc,t,n,e)}),t.defineDocExtension("getSearchCursor",function(t,n,e){return new o(this,t,n,e)}),t.defineExtension("selectMatches",function(n,e){for(var r=[],i=this.getSearchCursor(n,this.getCursor("from"),e);i.findNext()&&!(t.cmpPos(i.to(),this.getCursor("to"))>0);)r.push({anchor:i.from(),head:i.to()});r.length&&this.setSelections(r,0)})});