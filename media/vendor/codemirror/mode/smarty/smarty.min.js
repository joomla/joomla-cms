!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("smarty",function(t,r){var i,n=r.rightDelimiter||"}",a=r.leftDelimiter||"{",o=r.version||2,l=e.getMode(t,r.baseMode||"null"),f=["debug","extends","function","include","literal"],u={operatorChars:/[+\-*&%=<>!?]/,validIdentifier:/[a-zA-Z0-9_]/,stringChar:/['"]/};function s(e,t){return i=t,e}function d(e,t){for(var r,f,u,s,c,h,b,k=e.string,m=e.pos;;){var g=k.indexOf(a,m);if(m=g+a.length,-1==g||(r=e,null==(f=g+a.length)&&(f=r.pos),3!==o||"{"!=a||f!=r.string.length&&!/\s/.test(r.string.charAt(f))))break}if(g==e.pos)return e.match(a),e.eat("*")?(u=e,h="comment",b="*"+n,c=function(e,t){for(;!e.eol();){if(e.match(b)){t.tokenize=d;break}e.next()}return h},(s=t).tokenize=c,c(u,s)):(t.depth++,t.tokenize=p,i="startTag","tag");g>-1&&(e.string=k.slice(0,g));var v=l.token(e,t.base);return g>-1&&(e.string=k),v}function p(e,t){if(e.match(n,!0))return 3===o?(t.depth--,t.depth<=0&&(t.tokenize=d)):t.tokenize=d,s("tag",null);if(e.match(a,!0))return t.depth++,s("tag","startTag");var r=e.next();if("$"==r)return e.eatWhile(u.validIdentifier),s("variable-2","variable");if("|"==r)return s("operator","pipe");if("."==r)return s("operator","property");if(u.stringChar.test(r))return t.tokenize=(l=r,function(e,t){for(var r=null,i=null;!e.eol();){if(i=e.peek(),e.next()==l&&"\\"!==r){t.tokenize=p;break}r=i}return"string"}),s("string","string");if(u.operatorChars.test(r))return e.eatWhile(u.operatorChars),s("operator","operator");if("["==r||"]"==r)return s("bracket","bracket");if("("==r||")"==r)return s("bracket","operator");if(/\d/.test(r))return e.eatWhile(/\d/),s("number","number");if("variable"==t.last){if("@"==r)return e.eatWhile(u.validIdentifier),s("property","property");if("|"==r)return e.eatWhile(u.validIdentifier),s("qualifier","modifier")}else{if("pipe"==t.last)return e.eatWhile(u.validIdentifier),s("qualifier","modifier");if("whitespace"==t.last)return e.eatWhile(u.validIdentifier),s("attribute","modifier")}if("property"==t.last)return e.eatWhile(u.validIdentifier),s("property",null);if(/\s/.test(r))return i="whitespace",null;var l,c="";"/"!=r&&(c+=r);for(var h=null;h=e.eat(u.validIdentifier);)c+=h;for(var b=0,k=f.length;b<k;b++)if(f[b]==c)return s("keyword","keyword");return/\s/.test(r)?null:s("tag","tag")}return{startState:function(){return{base:e.startState(l),tokenize:d,last:null,depth:0}},copyState:function(t){return{base:e.copyState(l,t.base),tokenize:t.tokenize,last:t.last,depth:t.depth}},innerMode:function(e){if(e.tokenize==d)return{mode:l,state:e.base}},token:function(e,t){var r=t.tokenize(e,t);return t.last=i,r},indent:function(t,r){return t.tokenize==d&&l.indent?l.indent(t.base,r):e.Pass},blockCommentStart:a+"*",blockCommentEnd:"*"+n}}),e.defineMIME("text/x-smarty","smarty")});