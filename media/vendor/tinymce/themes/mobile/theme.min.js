!function(){var e={},t=function(t,n,o){if("string"!=typeof t)throw"module id must be a string";if(void 0===n)throw"no dependencies for "+t;if(void 0===o)throw"no definition function for "+t;e[t]={deps:n,defn:o,instance:void 0}},n=function(t){var o=e[t];if(void 0===o)throw"module ["+t+"] was undefined";return void 0===o.instance&&function(t){for(var o=e[t],r=o.deps,i=o.defn,a=r.length,u=new Array(a),c=0;c<a;++c)u[c]=n(r[c]);var s=i.apply(null,u);if(void 0===s)throw"module ["+t+"] returned undefined";o.instance=s}(t),o.instance},o=t,r=function(e,t){o(e,[],function(){return t})};r("global!Array",Array),r("global!Error",Error),o("ephox.katamari.api.Fun",["global!Array","global!Error"],function(e,t){var n=function(e){return function(){return e}};return{noop:function(){},noarg:function(e){return function(){return e()}},compose:function(e,t){return function(){return e(t.apply(null,arguments))}},constant:n,identity:function(e){return e},tripleEquals:function(e,t){return e===t},curry:function(t){for(var n=new e(arguments.length-1),o=1;o<arguments.length;o++)n[o-1]=arguments[o];return function(){for(var o=new e(arguments.length),r=0;r<o.length;r++)o[r]=arguments[r];var i=n.concat(o);return t.apply(null,i)}},not:function(e){return function(){return!e.apply(null,arguments)}},die:function(e){return function(){throw new t(e)}},apply:function(e){return e()},call:function(e){e()},never:n(!1),always:n(!0)}}),r("global!Object",Object),o("ephox.katamari.api.Option",["ephox.katamari.api.Fun","global!Object"],function(e,t){var n=e.never,o=e.always,r=function(){return i},i=function(){var i=function(e){return e.isNone()},a=function(e){return e()},u=function(e){return e},c={fold:function(e,t){return e()},is:n,isSome:n,isNone:o,getOr:u,getOrThunk:a,getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},or:u,orThunk:a,map:r,ap:r,each:function(){},bind:r,flatten:r,exists:n,forall:o,filter:r,equals:i,equals_:i,toArray:function(){return[]},toString:e.constant("none()")};return t.freeze&&t.freeze(c),c}(),a=function(e){var t=function(){return e},u=function(){return s},c=function(t){return t(e)},s={fold:function(t,n){return n(e)},is:function(t){return e===t},isSome:o,isNone:n,getOr:t,getOrThunk:t,getOrDie:t,or:u,orThunk:u,map:function(t){return a(t(e))},ap:function(t){return t.fold(r,function(t){return a(t(e))})},each:function(t){t(e)},bind:c,flatten:t,exists:c,forall:c,filter:function(t){return t(e)?s:i},equals:function(t){return t.is(e)},equals_:function(t,o){return t.fold(n,function(t){return o(e,t)})},toArray:function(){return[e]},toString:function(){return"some("+e+")"}};return s};return{some:a,none:r,from:function(e){return null===e||void 0===e?i:a(e)}}}),r("global!String",String),o("ephox.katamari.api.Arr",["ephox.katamari.api.Option","global!Array","global!Error","global!String"],function(e,t,n,o){var r=function(){var e=t.prototype.indexOf;return void 0===e?function(e,t){return p(e,t)}:function(t,n){return e.call(t,n)}}(),i=function(e,t){return r(e,t)>-1},a=function(e,n){for(var o=e.length,r=new t(o),i=0;i<o;i++){var a=e[i];r[i]=n(a,i,e)}return r},u=function(e,t){for(var n=0,o=e.length;n<o;n++){t(e[n],n,e)}},c=function(e,t){for(var n=e.length-1;n>=0;n--){t(e[n],n,e)}},s=function(e,t){for(var n=[],o=0,r=e.length;o<r;o++){var i=e[o];t(i,o,e)&&n.push(i)}return n},l=function(t,n){for(var o=0,r=t.length;o<r;o++){if(n(t[o],o,t))return e.some(o)}return e.none()},p=function(e,t){for(var n=0,o=e.length;n<o;++n)if(e[n]===t)return n;return-1},f=t.prototype.push,m=function(e){for(var o=[],r=0,i=e.length;r<i;++r){if(!t.prototype.isPrototypeOf(e[r]))throw new n("Arr.flatten item "+r+" was not an array, input: "+e);f.apply(o,e[r])}return o},d=function(e,t){for(var n=0,o=e.length;n<o;++n){if(!0!==t(e[n],n,e))return!1}return!0},h=t.prototype.slice;return{map:a,each:u,eachr:c,partition:function(e,t){for(var n=[],o=[],r=0,i=e.length;r<i;r++){var a=e[r];(t(a,r,e)?n:o).push(a)}return{pass:n,fail:o}},filter:s,groupBy:function(e,t){if(0===e.length)return[];for(var n=t(e[0]),o=[],r=[],i=0,a=e.length;i<a;i++){var u=e[i],c=t(u);c!==n&&(o.push(r),r=[]),n=c,r.push(u)}return 0!==r.length&&o.push(r),o},indexOf:function(t,n){var o=r(t,n);return-1===o?e.none():e.some(o)},foldr:function(e,t,n){return c(e,function(e){n=t(n,e)}),n},foldl:function(e,t,n){return u(e,function(e){n=t(n,e)}),n},find:function(t,n){for(var o=0,r=t.length;o<r;o++){var i=t[o];if(n(i,o,t))return e.some(i)}return e.none()},findIndex:l,flatten:m,bind:function(e,t){var n=a(e,t);return m(n)},forall:d,exists:function(e,t){return l(e,t).isSome()},contains:i,equal:function(e,t){return e.length===t.length&&d(e,function(e,n){return e===t[n]})},reverse:function(e){var t=h.call(e,0);return t.reverse(),t},chunk:function(e,t){for(var n=[],o=0;o<e.length;o+=t){var r=e.slice(o,o+t);n.push(r)}return n},difference:function(e,t){return s(e,function(e){return!i(t,e)})},mapToObject:function(e,t){for(var n={},r=0,i=e.length;r<i;r++){var a=e[r];n[o(a)]=t(a,r)}return n},pure:function(e){return[e]},sort:function(e,t){var n=h.call(e,0);return n.sort(t),n},range:function(e,t){for(var n=[],o=0;o<e;o++)n.push(t(o));return n},head:function(t){return 0===t.length?e.none():e.some(t[0])},last:function(t){return 0===t.length?e.none():e.some(t[t.length-1])}}}),o("ephox.katamari.api.Global",[],function(){return"undefined"!=typeof window?window:Function("return this;")()}),o("ephox.katamari.api.Resolve",["ephox.katamari.api.Global"],function(e){var t=function(t,n){for(var o=void 0!==n?n:e,r=0;r<t.length&&void 0!==o&&null!==o;++r)o=o[t[r]];return o},n=function(t,n){for(var o=void 0!==n?n:e,r=0;r<t.length;++r)i=o,a=t[r],void 0!==i[a]&&null!==i[a]||(i[a]={}),o=i[a];var i,a;return o};return{path:t,resolve:function(e,n){var o=e.split(".");return t(o,n)},forge:n,namespace:function(e,t){var o=e.split(".");return n(o,t)}}}),o("ephox.sand.util.Global",["ephox.katamari.api.Resolve"],function(e){return{getOrDie:function(t,n){var o,r,i=(o=t,r=n,e.resolve(o,r));if(void 0===i)throw t+" not available on this browser";return i}}}),o("ephox.sand.api.Node",["ephox.sand.util.Global"],function(e){var t=function(){return e.getOrDie("Node")},n=function(e,t,n){return 0!=(e.compareDocumentPosition(t)&n)};return{documentPositionPreceding:function(e,o){return n(e,o,t().DOCUMENT_POSITION_PRECEDING)},documentPositionContainedBy:function(e,o){return n(e,o,t().DOCUMENT_POSITION_CONTAINED_BY)}}}),o("ephox.katamari.api.Thunk",[],function(){return{cached:function(e){var t,n=!1;return function(){return n||(n=!0,t=e.apply(null,arguments)),t}}}}),r("global!Number",Number),o("ephox.sand.detect.Version",["ephox.katamari.api.Arr","global!Number","global!String"],function(e,t,n){var o=function(){return r(0,0)},r=function(e,t){return{major:e,minor:t}};return{nu:r,detect:function(e,i){var a=n(i).toLowerCase();return 0===e.length?o():function(e,n){var o=function(e,t){for(var n=0;n<e.length;n++){var o=e[n];if(o.test(t))return o}}(e,n);if(!o)return{major:0,minor:0};var i=function(e){return t(n.replace(o,"$"+e))};return r(i(1),i(2))}(e,a)},unknown:o}}),o("ephox.sand.core.Browser",["ephox.katamari.api.Fun","ephox.sand.detect.Version"],function(e,t){var n=function(e,t){return function(){return t===e}},o=function(e){var t=e.current;return{current:t,version:e.version,isEdge:n("Edge",t),isChrome:n("Chrome",t),isIE:n("IE",t),isOpera:n("Opera",t),isFirefox:n("Firefox",t),isSafari:n("Safari",t)}};return{unknown:function(){return o({current:void 0,version:t.unknown()})},nu:o,edge:e.constant("Edge"),chrome:e.constant("Chrome"),ie:e.constant("IE"),opera:e.constant("Opera"),firefox:e.constant("Firefox"),safari:e.constant("Safari")}}),o("ephox.sand.core.OperatingSystem",["ephox.katamari.api.Fun","ephox.sand.detect.Version"],function(e,t){var n=function(e,t){return function(){return t===e}},o=function(e){var t=e.current;return{current:t,version:e.version,isWindows:n("Windows",t),isiOS:n("iOS",t),isAndroid:n("Android",t),isOSX:n("OSX",t),isLinux:n("Linux",t),isSolaris:n("Solaris",t),isFreeBSD:n("FreeBSD",t)}};return{unknown:function(){return o({current:void 0,version:t.unknown()})},nu:o,windows:e.constant("Windows"),ios:e.constant("iOS"),android:e.constant("Android"),linux:e.constant("Linux"),osx:e.constant("OSX"),solaris:e.constant("Solaris"),freebsd:e.constant("FreeBSD")}}),o("ephox.sand.detect.DeviceType",["ephox.katamari.api.Fun"],function(e){return function(t,n,o){var r=t.isiOS()&&!0===/ipad/i.test(o),i=t.isiOS()&&!r,a=t.isAndroid()&&3===t.version.major,u=t.isAndroid()&&4===t.version.major,c=r||a||u&&!0===/mobile/i.test(o),s=t.isiOS()||t.isAndroid(),l=s&&!c,p=n.isSafari()&&t.isiOS()&&!1===/safari/i.test(o);return{isiPad:e.constant(r),isiPhone:e.constant(i),isTablet:e.constant(c),isPhone:e.constant(l),isTouch:e.constant(s),isAndroid:t.isAndroid,isiOS:t.isiOS,isWebView:e.constant(p)}}}),o("ephox.sand.detect.UaString",["ephox.katamari.api.Arr","ephox.sand.detect.Version","global!String"],function(e,t,n){var o=function(t,o){var r=n(o).toLowerCase();return e.find(t,function(e){return e.search(r)})};return{detectBrowser:function(e,n){return o(e,n).map(function(e){var o=t.detect(e.versionRegexes,n);return{current:e.name,version:o}})},detectOs:function(e,n){return o(e,n).map(function(e){var o=t.detect(e.versionRegexes,n);return{current:e.name,version:o}})}}}),o("ephox.katamari.str.StrAppend",[],function(){return{addToStart:function(e,t){return t+e},addToEnd:function(e,t){return e+t},removeFromStart:function(e,t){return e.substring(t)},removeFromEnd:function(e,t){return e.substring(0,e.length-t)}}}),o("ephox.katamari.str.StringParts",["ephox.katamari.api.Option","global!Error"],function(e,t){return{first:function(e,t){return e.substr(0,t)},last:function(e,t){return e.substr(e.length-t,e.length)},head:function(t){return""===t?e.none():e.some(t.substr(0,1))},tail:function(t){return""===t?e.none():e.some(t.substring(1))}}}),o("ephox.katamari.api.Strings",["ephox.katamari.str.StrAppend","ephox.katamari.str.StringParts","global!Error"],function(e,t,n){var o=function(e,t,n){if(""===t)return!0;if(e.length<t.length)return!1;return e.substr(n,n+t.length)===t},r=function(e,t){return o(e,t,0)},i=function(e,t){return o(e,t,e.length-t.length)};return{supplant:function(e,t){return e.replace(/\${([^{}]*)}/g,function(e,n){var o=t[n];return function(e){var t=typeof e;return"string"===t||"number"===t}(o)?o:e})},startsWith:r,removeLeading:function(t,n){return r(t,n)?e.removeFromStart(t,n.length):t},removeTrailing:function(t,n){return i(t,n)?e.removeFromEnd(t,n.length):t},ensureLeading:function(t,n){return r(t,n)?t:e.addToStart(t,n)},ensureTrailing:function(t,n){return i(t,n)?t:e.addToEnd(t,n)},endsWith:i,contains:function(e,t){return-1!==e.indexOf(t)},trim:function(e){return e.replace(/^\s+|\s+$/g,"")},lTrim:function(e){return e.replace(/^\s+/g,"")},rTrim:function(e){return e.replace(/\s+$/g,"")},capitalize:function(e){return t.head(e).bind(function(n){return t.tail(e).map(function(e){return n.toUpperCase()+e})}).getOr(e)}}}),o("ephox.sand.info.PlatformInfo",["ephox.katamari.api.Fun","ephox.katamari.api.Strings"],function(e,t){var n=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,o=function(e){return function(n){return t.contains(n,e)}},r=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(e){return t.contains(e,"edge/")&&t.contains(e,"chrome")&&t.contains(e,"safari")&&t.contains(e,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,n],search:function(e){return t.contains(e,"chrome")&&!t.contains(e,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(e){return t.contains(e,"msie")||t.contains(e,"trident")}},{name:"Opera",versionRegexes:[n,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:o("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:o("firefox")},{name:"Safari",versionRegexes:[n,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(e){return(t.contains(e,"safari")||t.contains(e,"mobile/"))&&t.contains(e,"applewebkit")}}],i=[{name:"Windows",search:o("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(e){return t.contains(e,"iphone")||t.contains(e,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:o("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:o("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:o("linux"),versionRegexes:[]},{name:"Solaris",search:o("sunos"),versionRegexes:[]},{name:"FreeBSD",search:o("freebsd"),versionRegexes:[]}];return{browsers:e.constant(r),oses:e.constant(i)}}),o("ephox.sand.core.PlatformDetection",["ephox.sand.core.Browser","ephox.sand.core.OperatingSystem","ephox.sand.detect.DeviceType","ephox.sand.detect.UaString","ephox.sand.info.PlatformInfo"],function(e,t,n,o,r){return{detect:function(i){var a=r.browsers(),u=r.oses(),c=o.detectBrowser(a,i).fold(e.unknown,e.nu),s=o.detectOs(u,i).fold(t.unknown,t.nu);return{browser:c,os:s,deviceType:n(s,c,i)}}}}),r("global!navigator",navigator),o("ephox.sand.api.PlatformDetection",["ephox.katamari.api.Thunk","ephox.sand.core.PlatformDetection","global!navigator"],function(e,t,n){return{detect:e.cached(function(){var e=n.userAgent;return t.detect(e)})}}),o("global!console",[],function(){return"undefined"==typeof console&&(console={log:function(){}}),console}),r("global!document",document),o("ephox.sugar.api.node.Element",["ephox.katamari.api.Fun","ephox.katamari.api.Option","global!Error","global!console","global!document"],function(e,t,n,o,r){var i=function(t){if(null===t||void 0===t)throw new n("Node cannot be null or undefined");return{dom:e.constant(t)}};return{fromHtml:function(e,t){var n=(t||r).createElement("div");if(n.innerHTML=e,!n.hasChildNodes()||n.childNodes.length>1)throw o.error("HTML does not have a single root node",e),"HTML must have a single root node";return i(n.childNodes[0])},fromTag:function(e,t){var n=(t||r).createElement(e);return i(n)},fromText:function(e,t){var n=(t||r).createTextNode(e);return i(n)},fromDom:i,fromPoint:function(e,n,o){return t.from(e.dom().elementFromPoint(n,o)).map(i)}}}),o("ephox.sugar.api.node.NodeTypes",[],function(){return{ATTRIBUTE:2,CDATA_SECTION:4,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,ELEMENT:1,TEXT:3,PROCESSING_INSTRUCTION:7,ENTITY_REFERENCE:5,ENTITY:6,NOTATION:12}}),o("ephox.sugar.api.search.Selectors",["ephox.katamari.api.Arr","ephox.katamari.api.Option","ephox.sugar.api.node.Element","ephox.sugar.api.node.NodeTypes","global!Error","global!document"],function(e,t,n,o,r,i){var a=o.ELEMENT,u=o.DOCUMENT,c=function(e){return e.nodeType!==a&&e.nodeType!==u||0===e.childElementCount};return{all:function(t,o){var r=void 0===o?i:o.dom();return c(r)?[]:e.map(r.querySelectorAll(t),n.fromDom)},is:function(e,t){var n=e.dom();if(n.nodeType!==a)return!1;if(void 0!==n.matches)return n.matches(t);if(void 0!==n.msMatchesSelector)return n.msMatchesSelector(t);if(void 0!==n.webkitMatchesSelector)return n.webkitMatchesSelector(t);if(void 0!==n.mozMatchesSelector)return n.mozMatchesSelector(t);throw new r("Browser lacks native selectors")},one:function(e,o){var r=void 0===o?i:o.dom();return c(r)?t.none():t.from(r.querySelector(e)).map(n.fromDom)}}}),o("ephox.sugar.api.dom.Compare",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.sand.api.Node","ephox.sand.api.PlatformDetection","ephox.sugar.api.search.Selectors"],function(e,t,n,o,r){var i=function(e,t){return e.dom()===t.dom()},a=o.detect().browser.isIE()?function(e,t){return n.documentPositionContainedBy(e.dom(),t.dom())}:function(e,t){var n=e.dom(),o=t.dom();return n!==o&&n.contains(o)};return{eq:i,isEqualNode:function(e,t){return e.dom().isEqualNode(t.dom())},member:function(n,o){return e.exists(o,t.curry(i,n))},contains:a,is:r.is}}),o("ephox.alloy.alien.EventRoot",["ephox.sugar.api.dom.Compare"],function(e){return{isSource:function(t,n){return e.eq(t.element(),n.event().target())}}}),o("ephox.alloy.api.events.NativeEvents",["ephox.katamari.api.Fun"],function(e){return{contextmenu:e.constant("contextmenu"),touchstart:e.constant("touchstart"),touchmove:e.constant("touchmove"),touchend:e.constant("touchend"),gesturestart:e.constant("gesturestart"),mousedown:e.constant("mousedown"),mousemove:e.constant("mousemove"),mouseout:e.constant("mouseout"),mouseup:e.constant("mouseup"),mouseover:e.constant("mouseover"),focusin:e.constant("focusin"),keydown:e.constant("keydown"),input:e.constant("input"),change:e.constant("change"),focus:e.constant("focus"),click:e.constant("click"),transitionend:e.constant("transitionend"),selectstart:e.constant("selectstart")}}),o("ephox.alloy.api.events.SystemEvents",["ephox.alloy.api.events.NativeEvents","ephox.katamari.api.Fun","ephox.sand.api.PlatformDetection"],function(e,t,n){var o={tap:t.constant("alloy.tap")};return{focus:t.constant("alloy.focus"),postBlur:t.constant("alloy.blur.post"),receive:t.constant("alloy.receive"),execute:t.constant("alloy.execute"),focusItem:t.constant("alloy.focus.item"),tap:o.tap,tapOrClick:n.detect().deviceType.isTouch()?o.tap:e.click,longpress:t.constant("alloy.longpress"),sandboxClose:t.constant("alloy.sandbox.close"),systemInit:t.constant("alloy.system.init"),windowScroll:t.constant("alloy.system.scroll"),attachedToDom:t.constant("alloy.system.attached"),detachedFromDom:t.constant("alloy.system.detached"),changeTab:t.constant("alloy.change.tab"),dismissTab:t.constant("alloy.dismiss.tab")}}),o("ephox.katamari.api.Type",["global!Array","global!String"],function(e,t){var n=function(n){return function(o){return function(n){if(null===n)return"null";var o=typeof n;return"object"===o&&e.prototype.isPrototypeOf(n)?"array":"object"===o&&t.prototype.isPrototypeOf(n)?"string":o}(o)===n}};return{isString:n("string"),isObject:n("object"),isArray:n("array"),isNull:n("null"),isBoolean:n("boolean"),isUndefined:n("undefined"),isFunction:n("function"),isNumber:n("number")}}),o("ephox.katamari.api.Merger",["ephox.katamari.api.Type","global!Array","global!Error"],function(e,t,n){var o=function(e){return function(){for(var o=new t(arguments.length),r=0;r<o.length;r++)o[r]=arguments[r];if(0===o.length)throw new n("Can't merge zero objects");for(var i={},a=0;a<o.length;a++){var u=o[a];for(var c in u)u.hasOwnProperty(c)&&(i[c]=e(i[c],u[c]))}return i}},r=o(function(t,n){return e.isObject(t)&&e.isObject(n)?r(t,n):n}),i=o(function(e,t){return t});return{deepMerge:r,merge:i}}),o("ephox.katamari.api.Obj",["ephox.katamari.api.Option","global!Object"],function(e,t){var n=function(){var e=t.keys;return void 0===e?function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}:e}(),o=function(e,t){for(var o=n(e),r=0,i=o.length;r<i;r++){var a=o[r];t(e[a],a,e)}},r=function(e,t){var n={};return o(e,function(o,r){var i=t(o,r,e);n[i.k]=i.v}),n},i=function(e,t){var n=[];return o(e,function(e,o){n.push(t(e,o))}),n},a=function(e){return i(e,function(e){return e})};return{bifilter:function(e,t){var n={},r={};return o(e,function(e,o){(t(e,o)?n:r)[o]=e}),{t:n,f:r}},each:o,map:function(e,t){return r(e,function(e,n,o){return{k:n,v:t(e,n,o)}})},mapToArray:i,tupleMap:r,find:function(t,o){for(var r=n(t),i=0,a=r.length;i<a;i++){var u=r[i],c=t[u];if(o(c,u,t))return e.some(c)}return e.none()},keys:n,values:a,size:function(e){return a(e).length}}}),o("ephox.alloy.api.events.AlloyTriggers",["ephox.alloy.api.events.SystemEvents","ephox.katamari.api.Fun","ephox.katamari.api.Merger","ephox.katamari.api.Obj"],function(e,t,n,o){var r=function(e,t){i(e,e.element(),t,{})},i=function(e,r,i,a){var u=n.deepMerge({target:r},a);e.getSystem().triggerEvent(i,r,o.map(u,t.constant))};return{emit:r,emitWith:function(e,t,n){i(e,e.element(),t,n)},emitExecute:function(t){r(t,e.execute())},dispatch:function(e,t,n){i(e,t,n,{})},dispatchWith:i,dispatchEvent:function(e,t,n,o){e.getSystem().triggerEvent(n,t,o.event())},dispatchFocus:function(e,t){e.getSystem().triggerFocus(t,e.element())}}}),o("ephox.katamari.api.Adt",["ephox.katamari.api.Arr","ephox.katamari.api.Obj","ephox.katamari.api.Type","global!Array","global!Error","global!console"],function(e,t,n,o,r,i){return{generate:function(a){if(!n.isArray(a))throw new r("cases must be an array");if(0===a.length)throw new r("there must be at least one case");var u=[],c={};return e.each(a,function(s,l){var p=t.keys(s);if(1!==p.length)throw new r("one and only one name per case");var f=p[0],m=s[f];if(void 0!==c[f])throw new r("duplicate key detected:"+f);if("cata"===f)throw new r("cannot have a case named cata (sorry)");if(!n.isArray(m))throw new r("case arguments must be an array");u.push(f),c[f]=function(){var n=arguments.length;if(n!==m.length)throw new r("Wrong number of arguments to case "+f+". Expected "+m.length+" ("+m+"), got "+n);for(var c=new o(n),s=0;s<c.length;s++)c[s]=arguments[s];return{fold:function(){if(arguments.length!==a.length)throw new r("Wrong number of arguments to fold. Expected "+a.length+", got "+arguments.length);return arguments[l].apply(null,c)},match:function(n){var o=t.keys(n);if(u.length!==o.length)throw new r("Wrong number of arguments to match. Expected: "+u.join(",")+"\nActual: "+o.join(","));if(!e.forall(u,function(t){return e.contains(o,t)}))throw new r("Not all branches were specified when using match. Specified: "+o.join(", ")+"\nRequired: "+u.join(", "));return n[f].apply(null,c)},log:function(e){i.log(e,{constructors:u,constructor:f,params:c})}}}}),c}}}),o("ephox.boulder.api.FieldPresence",["ephox.katamari.api.Adt","ephox.katamari.api.Fun"],function(e,t){var n=e.generate([{strict:[]},{defaultedThunk:["fallbackThunk"]},{asOption:[]},{asDefaultedOptionThunk:["fallbackThunk"]},{mergeWithThunk:["baseThunk"]}]);return{strict:n.strict,asOption:n.asOption,defaulted:function(e){return n.defaultedThunk(t.constant(e))},defaultedThunk:n.defaultedThunk,asDefaultedOption:function(e){return n.asDefaultedOptionThunk(t.constant(e))},asDefaultedOptionThunk:n.asDefaultedOptionThunk,mergeWith:function(e){return n.mergeWithThunk(t.constant(e))},mergeWithThunk:n.mergeWithThunk}}),o("ephox.katamari.api.Result",["ephox.katamari.api.Fun","ephox.katamari.api.Option"],function(e,t){var n=function(o){return{is:function(e){return o===e},isValue:e.constant(!0),isError:e.constant(!1),getOr:e.constant(o),getOrThunk:e.constant(o),getOrDie:e.constant(o),or:function(e){return n(o)},orThunk:function(e){return n(o)},fold:function(e,t){return t(o)},map:function(e){return n(e(o))},each:function(e){e(o)},bind:function(e){return e(o)},exists:function(e){return e(o)},forall:function(e){return e(o)},toOption:function(){return t.some(o)}}},o=function(n){return{is:e.constant(!1),isValue:e.constant(!1),isError:e.constant(!0),getOr:e.identity,getOrThunk:function(e){return e()},getOrDie:function(){return e.die(n)()},or:function(e){return e},orThunk:function(e){return e()},fold:function(e,t){return e(n)},map:function(e){return o(n)},each:e.noop,bind:function(e){return o(n)},exists:e.constant(!1),forall:e.constant(!0),toOption:t.none}};return{value:n,error:o}}),o("ephox.katamari.api.Results",["ephox.katamari.api.Adt","ephox.katamari.api.Arr"],function(e,t){var n=e.generate([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]);return{partition:function(e){var n=[],o=[];return t.each(e,function(e){e.fold(function(e){n.push(e)},function(e){o.push(e)})}),{errors:n,values:o}},compare:function(e,t){return e.fold(function(e){return t.fold(function(t){return n.bothErrors(e,t)},function(t){return n.firstError(e,t)})},function(e){return t.fold(function(t){return n.secondError(e,t)},function(t){return n.bothValues(e,t)})})}}}),o("ephox.boulder.combine.ResultCombine",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Merger","ephox.katamari.api.Result","ephox.katamari.api.Results"],function(e,t,n,o,r){var i=function(n){return t.compose(o.error,e.flatten)(n)};return{consolidateObj:function(e,t){var a=r.partition(e);return a.errors.length>0?i(a.errors):(u=a.values,c=t,o.value(n.deepMerge.apply(void 0,[c].concat(u))));var u,c},consolidateArr:function(e){var t=r.partition(e);return t.errors.length>0?i(t.errors):o.value(t.values)}}}),o("ephox.boulder.core.ObjChanger",["ephox.katamari.api.Arr","ephox.katamari.api.Obj"],function(e,t){return{narrow:function(t,n){var o={};return e.each(n,function(e){void 0!==t[e]&&t.hasOwnProperty(e)&&(o[e]=t[e])}),o},exclude:function(n,o){var r={};return t.each(n,function(t,n){e.contains(o,n)||(r[n]=t)}),r},indexOnKey:function(t,n){var o={};return e.each(t,function(e){var t=e[n];o[t]=e}),o}}}),o("ephox.boulder.core.ObjReader",["ephox.katamari.api.Option"],function(e){var t=function(t){return function(n){return n.hasOwnProperty(t)?e.from(n[t]):e.none()}};return{readOpt:t,readOr:function(e,n){return function(o){return t(e)(o).getOr(n)}},readOptFrom:function(e,n){return t(n)(e)},hasKey:function(e,t){return e.hasOwnProperty(t)&&void 0!==e[t]&&null!==e[t]}}}),o("ephox.boulder.core.ObjWriter",["ephox.katamari.api.Arr"],function(e){return{wrap:function(e,t){var n={};return n[e]=t,n},wrapAll:function(t){var n={};return e.each(t,function(e){n[e.key]=e.value}),n}}}),o("ephox.boulder.api.Objects",["ephox.boulder.combine.ResultCombine","ephox.boulder.core.ObjChanger","ephox.boulder.core.ObjReader","ephox.boulder.core.ObjWriter"],function(e,t,n,o){return{narrow:function(e,n){return t.narrow(e,n)},exclude:function(e,n){return t.exclude(e,n)},readOpt:function(e){return n.readOpt(e)},readOr:function(e,t){return n.readOr(e,t)},readOptFrom:function(e,t){return n.readOptFrom(e,t)},wrap:function(e,t){return o.wrap(e,t)},wrapAll:function(e){return o.wrapAll(e)},indexOnKey:function(e,n){return t.indexOnKey(e,n)},hasKey:function(e,t){return n.hasKey(e,t)},consolidate:function(t,n){return e.consolidateObj(t,n)}}}),o("ephox.sand.api.JSON",["ephox.sand.util.Global"],function(e){var t=function(){return e.getOrDie("JSON")};return{parse:function(e){return t().parse(e)},stringify:function(e,n,o){return t().stringify(e,n,o)}}}),o("ephox.boulder.format.PrettyPrinter",["ephox.katamari.api.Arr","ephox.katamari.api.Obj","ephox.katamari.api.Type","ephox.sand.api.JSON"],function(e,t,n,o){return{formatObj:function(e){return n.isObject(e)&&t.keys(e).length>100?" removed due to size":o.stringify(e,null,2)},formatErrors:function(t){var n=t.length>10?t.slice(0,10).concat([{path:[],getErrorInfo:function(){return"... (only showing first ten failures)"}}]):t;return e.map(n,function(e){return"Failed path: ("+e.path.join(" > ")+")\n"+e.getErrorInfo()})}}}),o("ephox.boulder.core.SchemaError",["ephox.boulder.format.PrettyPrinter","ephox.katamari.api.Result"],function(e,t){var n=function(e,n){return t.error([{path:e,getErrorInfo:n}])};return{missingStrict:function(t,o,r){return n(t,function(){return'Could not find valid *strict* value for "'+o+'" in '+e.formatObj(r)})},missingKey:function(e,t){return n(e,function(){return'Choice schema did not contain choice key: "'+t+'"'})},missingBranch:function(t,o,r){return n(t,function(){return'The chosen schema: "'+r+'" did not exist in branches: '+e.formatObj(o)})},unsupportedFields:function(e,t){return n(e,function(){return"There are unsupported fields: ["+t.join(", ")+"] specified"})},custom:function(e,t){return n(e,function(){return t})},toString:function(e){return"Failed path: ("+e.path.join(" > ")+")\n"+e.getErrorInfo()}}}),o("ephox.boulder.format.TypeTokens",["ephox.katamari.api.Adt"],function(e){return{typeAdt:e.generate([{setOf:["validator","valueType"]},{arrOf:["valueType"]},{objOf:["fields"]},{itemOf:["validator"]},{choiceOf:["key","branches"]}]),fieldAdt:e.generate([{field:["name","presence","type"]},{state:["name"]}])}}),o("ephox.boulder.core.ValueProcessor",["ephox.boulder.api.FieldPresence","ephox.boulder.api.Objects","ephox.boulder.combine.ResultCombine","ephox.boulder.core.ObjReader","ephox.boulder.core.ObjWriter","ephox.boulder.core.SchemaError","ephox.boulder.format.TypeTokens","ephox.katamari.api.Adt","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Merger","ephox.katamari.api.Obj","ephox.katamari.api.Option","ephox.katamari.api.Result","ephox.katamari.api.Type"],function(e,t,n,o,r,i,a,u,c,s,l,p,f,m,d){var h=u.generate([{field:["key","okey","presence","prop"]},{state:["okey","instantiator"]}]),g=function(e,t,n){var r=o.readOptFrom(e,t).fold(function(){return n(e)},s.identity);return m.value(r)},v=function(e,t,n,a){return n.fold(function(n,u,c,p){var d=function(t){return p.extract(e.concat([n]),a,t).map(function(e){return r.wrap(u,a(e))})},h=function(t){return t.fold(function(){var e=r.wrap(u,a(f.none()));return m.value(e)},function(t){return p.extract(e.concat([n]),a,t).map(function(e){return r.wrap(u,a(f.some(e)))})})};return c.fold(function(){return(r=e,a=t,u=n,o.readOptFrom(a,u).fold(function(){return i.missingStrict(r,u,a)},m.value)).bind(d);var r,a,u},function(e){return g(t,n,e).bind(d)},function(){return(e=t,r=n,m.value(o.readOptFrom(e,r))).bind(h);var e,r},function(e){return function(e,t,n){var r=o.readOptFrom(e,t).map(function(t){return!0===t?n(e):t});return m.value(r)}(t,n,e).bind(h)},function(e){var o=e(t);return g(t,n,s.constant({})).map(function(e){return l.deepMerge(o,e)}).bind(d)})},function(e,n){var o=n(t);return m.value(r.wrap(e,a(o)))})},x=function(e){return{extract:function(t,n,o){return e(o).fold(function(e){return i.custom(t,e)},m.value)},toString:function(){return"val"},toDsl:function(){return a.typeAdt.itemOf(e)}}},y=function(e){return{extract:function(t,o,r){return function(e,t,o,r){var i=c.map(o,function(n){return v(e,t,n,r)});return n.consolidateObj(i,{})}(t,r,e,o)},toString:function(){return"obj{\n"+c.map(e,function(e){return e.fold(function(e,t,n,o){return e+" -> "+o.toString()},function(e,t){return"state("+e+")"})}).join("\n")+"}"},toDsl:function(){return a.typeAdt.objOf(c.map(e,function(e){return e.fold(function(e,t,n,o){return a.fieldAdt.field(e,n,o)},function(e,t){return a.fieldAdt.state(e)})}))}}},b=function(e){return{extract:function(t,o,r){var i=c.map(r,function(n,r){return e.extract(t.concat(["["+r+"]"]),o,n)});return n.consolidateArr(i)},toString:function(){return"array("+e.toString()+")"},toDsl:function(){return a.typeAdt.arrOf(e)}}},k=x(m.value),S=s.compose(b,y);return{anyValue:s.constant(k),value:x,obj:y,objOnly:function(e){var n=y(e),o=c.foldr(e,function(e,n){return n.fold(function(n){return l.deepMerge(e,t.wrap(n,!0))},s.constant(e))},{});return{extract:function(e,r,a){var u=d.isBoolean(a)?[]:function(e){var n=p.keys(e);return c.filter(n,function(n){return t.hasKey(e,n)})}(a),s=c.filter(u,function(e){return!t.hasKey(o,e)});return 0===s.length?n.extract(e,r,a):i.unsupportedFields(e,s)},toString:n.toString,toDsl:n.toDsl}},arr:b,setOf:function(t,n){return{extract:function(o,r,i){var a=p.keys(i);return(u=o,l=a,b(x(t)).extract(u,s.identity,l)).bind(function(t){var a=c.map(t,function(t){return h.field(t,t,e.strict(),n)});return y(a).extract(o,r,i)});var u,l},toString:function(){return"setOf("+n.toString()+")"},toDsl:function(){return a.typeAdt.setOf(t,n)}}},arrOfObj:S,state:h.state,field:h.field,output:function(e,t){return h.state(e,s.constant(t))},snapshot:function(e){return h.state(e,s.identity)}}}),o("ephox.boulder.api.FieldSchema",["ephox.boulder.api.FieldPresence","ephox.boulder.core.ValueProcessor","ephox.katamari.api.Result","ephox.katamari.api.Type"],function(e,t,n,o){var r=function(n,o){return t.field(n,n,e.strict(),o)};return{strict:function(n){return t.field(n,n,e.strict(),t.anyValue())},strictOf:r,strictObjOf:function(n,o){return t.field(n,n,e.strict(),t.obj(o))},strictArrayOf:function(e,t){return r(e,t)},strictArrayOfObj:function(n,o){return t.field(n,n,e.strict(),t.arrOfObj(o))},strictFunction:function(r){return t.field(r,r,e.strict(),t.value(function(e){return o.isFunction(e)?n.value(e):n.error("Not a function")}))},forbid:function(o,r){return t.field(o,o,e.asOption(),t.value(function(e){return n.error("The field: "+o+" is forbidden. "+r)}))},option:function(n){return t.field(n,n,e.asOption(),t.anyValue())},optionOf:function(n,o){return t.field(n,n,e.asOption(),o)},optionObjOf:function(n,o){return t.field(n,n,e.asOption(),t.obj(o))},optionObjOfOnly:function(n,o){return t.field(n,n,e.asOption(),t.objOnly(o))},defaulted:function(n,o){return t.field(n,n,e.defaulted(o),t.anyValue())},defaultedOf:function(n,o,r){return t.field(n,n,e.defaulted(o),r)},defaultedObjOf:function(n,o,r){return t.field(n,n,e.defaulted(o),t.obj(r))},field:function(e,n,o,r){return t.field(e,n,o,r)},state:function(e,n){return t.state(e,n)}}}),o("ephox.boulder.core.ChoiceProcessor",["ephox.boulder.api.Objects","ephox.boulder.core.SchemaError","ephox.boulder.core.ValueProcessor","ephox.boulder.format.TypeTokens","ephox.katamari.api.Obj"],function(e,t,n,o,r){return{choose:function(i,a){return{extract:function(o,r,u){return e.readOptFrom(u,i).fold(function(){return t.missingKey(o,i)},function(i){return c=o,s=r,l=u,p=a,f=i,e.readOptFrom(p,f).fold(function(){return t.missingBranch(c,p,f)},function(e){return n.obj(e).extract(c.concat(["branch: "+f]),s,l)});var c,s,l,p,f})},toString:function(){return"chooseOn("+i+"). Possible values: "+r.keys(a)},toDsl:function(){return o.typeAdt.choiceOf(i,a)}}}}}),o("ephox.boulder.api.ValueSchema",["ephox.boulder.core.ChoiceProcessor","ephox.boulder.core.ValueProcessor","ephox.boulder.format.PrettyPrinter","ephox.katamari.api.Fun","ephox.katamari.api.Result","global!Error"],function(e,t,n,o,r,i){var a=t.value(r.value),u=t.arr,c=t.obj,s=t.objOnly,l=t.setOf,p=function(e,t,n,o){return t.extract([e],n,o).fold(function(e){return r.error({input:o,errors:e})},r.value)},f=function(e,t,n){return p(e,t,o.constant,n)},m=function(e,t,n){return p(e,t,o.identity,n)},d=function(e){return e.fold(function(e){throw new i(h(e))},o.identity)},h=function(e){return"Errors: \n"+n.formatErrors(e.errors)+"\n\nInput object: "+n.formatObj(e.input)};return{anyValue:o.constant(a),arrOfObj:function(e){return t.arrOfObj(e)},arrOf:u,arrOfVal:function(){return t.arr(a)},valueOf:function(e){return t.value(e)},setOf:l,objOf:c,objOfOnly:s,asStruct:f,asRaw:m,asStructOrDie:function(e,t,n){return d(f(e,t,n))},asRawOrDie:function(e,t,n){return d(m(e,t,n))},getOrDie:d,formatError:h,choose:function(t,n){return e.choose(t,n)}}}),o("ephox.alloy.construct.EventHandler",["ephox.boulder.api.FieldSchema","ephox.boulder.api.Objects","ephox.boulder.api.ValueSchema","ephox.katamari.api.Type","ephox.katamari.api.Arr","ephox.sand.api.JSON","ephox.katamari.api.Fun","global!Array","global!Error"],function(e,t,n,o,r,i,a,u,c){var s=function(o){if(!t.hasKey(o,"can")&&!t.hasKey(o,"abort")&&!t.hasKey(o,"run"))throw new c("EventHandler defined by: "+i.stringify(o,null,2)+" does not have can, abort, or run!");return n.asRawOrDie("Extracting event.handler",n.objOfOnly([e.defaulted("can",a.constant(!0)),e.defaulted("abort",a.constant(!1)),e.defaulted("run",a.noop)]),o)};return{read:function(e){return o.isFunction(e)?{can:a.constant(!0),abort:a.constant(!1),run:e}:e},fuse:function(e){var t,n,o,i,a=(t=e,n=function(e){return e.can},function(){var e=u.prototype.slice.call(arguments,0);return r.foldl(t,function(t,o){return t&&n(o).apply(void 0,e)},!0)}),c=(o=e,i=function(e){return e.abort},function(){var e=u.prototype.slice.call(arguments,0);return r.foldl(o,function(t,n){return t||i(n).apply(void 0,e)},!1)});return s({can:a,abort:c,run:function(){var t=u.prototype.slice.call(arguments,0);r.each(e,function(e){e.run.apply(void 0,t)})}})},nu:s}}),o("ephox.alloy.api.events.AlloyEvents",["ephox.alloy.alien.EventRoot","ephox.alloy.api.events.AlloyTriggers","ephox.alloy.api.events.SystemEvents","ephox.alloy.construct.EventHandler","ephox.boulder.api.Objects"],function(e,t,n,o,r){var i=function(e,t){return{key:e,value:o.nu({run:t})}},a=function(t){return function(n){return{key:t,value:o.nu({run:function(t,o){e.isSource(t,o)&&n(t,o)}})}}},u=function(e,n){return i(e,function(o,r){o.getSystem().getByUid(n).each(function(n){t.dispatchEvent(n,n.element(),e,r)})})};return{derive:r.wrapAll,run:i,preventDefault:function(e){return{key:e,value:o.nu({run:function(e,t){t.event().prevent()}})}},runActionExtra:function(e,t,n){return{key:e,value:o.nu({run:function(e){t.apply(void 0,[e].concat(n))}})}},runOnAttached:a(n.attachedToDom()),runOnDetached:a(n.detachedFromDom()),runOnInit:a(n.systemInit()),runOnExecute:(c=n.execute(),function(e){return i(c,e)}),redirectToUid:u,redirectToPart:function(e,t,n){var o=t.partUids()[n];return u(e,o)},runWithTarget:function(e,t){return i(e,function(e,n){e.getSystem().getByDom(n.event().target()).each(function(o){t(e,o,n)})})},abort:function(e,t){return{key:e,value:o.nu({abort:t})}},can:function(e,t){return{key:e,value:o.nu({can:t})}},cutter:function(e){return i(e,function(e,t){t.cut()})},stopper:function(e){return i(e,function(e,t){t.stop()})}};var c}),o("ephox.alloy.debugging.FunctionAnnotator",["ephox.katamari.api.Option"],function(e){return{markAsBehaviourApi:function(e,t,n){return e},markAsExtraApi:function(e,t){return e},markAsSketchApi:function(e,t){return e},getAnnotation:e.none}}),o("ephox.katamari.data.Immutable",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","global!Array","global!Error"],function(e,t,n,o){return function(){var r=arguments;return function(){for(var i=new n(arguments.length),a=0;a<i.length;a++)i[a]=arguments[a];if(r.length!==i.length)throw new o('Wrong number of arguments to struct. Expected "['+r.length+']", got '+i.length+" arguments");var u={};return e.each(r,function(e,n){u[e]=t.constant(i[n])}),u}}}),o("ephox.katamari.util.BagUtils",["ephox.katamari.api.Arr","ephox.katamari.api.Type","global!Error"],function(e,t,n){var o=function(e){return e.slice(0).sort()};return{sort:o,reqMessage:function(e,t){throw new n("All required keys ("+o(e).join(", ")+") were not specified. Specified keys were: "+o(t).join(", ")+".")},unsuppMessage:function(e){throw new n("Unsupported keys for object: "+o(e).join(", "))},validateStrArr:function(o,r){if(!t.isArray(r))throw new n("The "+o+" fields must be an array. Was: "+r+".");e.each(r,function(e){if(!t.isString(e))throw new n("The value "+e+" in the "+o+" fields was not a string.")})},invalidTypeMessage:function(e,t){throw new n("All values need to be of type: "+t+". Keys ("+o(e).join(", ")+") were not.")},checkDupes:function(t){var r=o(t);e.find(r,function(e,t){return t<r.length-1&&e===r[t+1]}).each(function(e){throw new n("The field: "+e+" occurs more than once in the combined fields: ["+r.join(", ")+"].")})}}}),o("ephox.katamari.data.MixedBag",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Obj","ephox.katamari.api.Option","ephox.katamari.util.BagUtils","global!Error","global!Object"],function(e,t,n,o,r,i,a){return function(u,c){var s=u.concat(c);if(0===s.length)throw new i("You must specify at least one required or optional field.");return r.validateStrArr("required",u),r.validateStrArr("optional",c),r.checkDupes(s),function(i){var l=n.keys(i);e.forall(u,function(t){return e.contains(l,t)})||r.reqMessage(u,l);var p=e.filter(l,function(t){return!e.contains(s,t)});p.length>0&&r.unsuppMessage(p);var f={};return e.each(u,function(e){f[e]=t.constant(i[e])}),e.each(c,function(e){f[e]=t.constant(a.prototype.hasOwnProperty.call(i,e)?o.some(i[e]):o.none())}),f}}}),o("ephox.katamari.api.Struct",["ephox.katamari.data.Immutable","ephox.katamari.data.MixedBag"],function(e,t){return{immutable:e,immutableBag:t}}),o("ephox.alloy.dom.DomDefinition",["ephox.sand.api.JSON","ephox.katamari.api.Struct","global!String"],function(e,t,n){var o=function(e){return{tag:e.tag(),classes:e.classes().getOr([]),attributes:e.attributes().getOr({}),styles:e.styles().getOr({}),value:e.value().getOr("<none>"),innerHtml:e.innerHtml().getOr("<none>"),defChildren:e.defChildren().getOr("<none>"),domChildren:e.domChildren().fold(function(){return"<none>"},function(e){return 0===e.length?"0 children, but still specified":n(e.length)})}};return{nu:t.immutableBag(["tag"],["classes","attributes","styles","value","innerHtml","domChildren","defChildren"]),defToStr:function(t){var n=o(t);return e.stringify(n,null,2)},defToRaw:o}}),o("ephox.alloy.dom.DomModification",["ephox.alloy.dom.DomDefinition","ephox.boulder.api.Objects","ephox.katamari.api.Arr","ephox.katamari.api.Obj","ephox.katamari.api.Merger","ephox.sand.api.JSON","ephox.katamari.api.Struct"],function(e,t,n,o,r,i,a){var u=a.immutableBag([],["classes","attributes","styles","value","innerHtml","defChildren","domChildren"]),c=function(e){return{classes:e.classes().getOr("<none>"),attributes:e.attributes().getOr("<none>"),styles:e.styles().getOr("<none>"),value:e.value().getOr("<none>"),innerHtml:e.innerHtml().getOr("<none>"),defChildren:e.defChildren().getOr("<none>"),domChildren:e.domChildren().fold(function(){return"<none>"},function(e){return 0===e.length?"0 children, but still specified":String(e.length)})}},s=function(e,n,o){return n.fold(function(){return o.fold(function(){return{}},function(n){return t.wrap(e,n)})},function(n){return o.fold(function(){return t.wrap(e,n)},function(n){return t.wrap(e,n)})})};return{nu:u,derive:function(e){var t={},r=o.keys(e);return n.each(r,function(n){e[n].each(function(e){t[n]=e})}),u(t)},merge:function(n,o){var i=r.deepMerge({tag:n.tag(),classes:o.classes().getOr([]).concat(n.classes().getOr([])),attributes:r.merge(n.attributes().getOr({}),o.attributes().getOr({})),styles:r.merge(n.styles().getOr({}),o.styles().getOr({}))},o.innerHtml().or(n.innerHtml()).map(function(e){return t.wrap("innerHtml",e)}).getOr({}),s("domChildren",o.domChildren(),n.domChildren()),s("defChildren",o.defChildren(),n.defChildren()),o.value().or(n.value()).map(function(e){return t.wrap("value",e)}).getOr({}));return e.nu(i)},modToStr:function(e){var t=c(e);return i.stringify(t,null,2)},modToRaw:c}}),o("ephox.alloy.behaviour.common.Behaviour",["ephox.alloy.api.events.AlloyEvents","ephox.alloy.debugging.FunctionAnnotator","ephox.alloy.dom.DomModification","ephox.boulder.api.FieldSchema","ephox.boulder.api.Objects","ephox.boulder.api.ValueSchema","ephox.katamari.api.Fun","ephox.katamari.api.Merger","ephox.katamari.api.Obj","ephox.katamari.api.Option","ephox.katamari.api.Thunk","global!Array","global!console","global!Error"],function(e,t,n,o,r,i,a,u,c,s,l,p,f,m){var d=function(e){return{key:e,value:void 0}},h=function(e,o,f,h,g,v,x){var y=function(e){return r.hasKey(e,f)?e[f]():s.none()},b=c.map(g,function(e,n){return o=f,r=e,i=n,t.markAsBehaviourApi(function(e){var t=arguments;return e.config({name:a.constant(o)}).fold(function(){throw new m("We could not find any behaviour configuration for: "+o+". Using API: "+i)},function(n){var o=p.prototype.slice.call(t,1);return r.apply(void 0,[e,n.config,n.state].concat(o))})},i,r);var o,r,i}),k=c.map(v,function(e,n){return t.markAsExtraApi(e,n)}),S=u.deepMerge(k,b,{revoke:a.curry(d,f),config:function(t){var n=i.asStructOrDie(f+"-config",e,t);return{key:f,value:{config:n,me:S,configAsRaw:l.cached(function(){return i.asRawOrDie(f+"-config",e,t)}),initialConfig:t,state:x}}},schema:function(){return o},exhibit:function(e,t){return y(e).bind(function(e){return r.readOptFrom(h,"exhibit").map(function(n){return n(t,e.config,e.state)})}).getOr(n.nu({}))},name:function(){return f},handlers:function(e){return y(e).bind(function(e){return r.readOptFrom(h,"events").map(function(t){return t(e.config,e.state)})}).getOr({})}});return S};return{executeEvent:function(t,n,o){return e.runOnExecute(function(e){o(e,t,n)})},loadEvent:function(t,n,o){return e.runOnInit(function(e,r){o(e,t,n)})},create:function(e,t,n,r,a,u){var c=i.objOfOnly(e),s=o.optionObjOf(t,[o.optionObjOfOnly("config",e)]);return h(c,s,t,n,r,a,u)},createModes:function(e,t,n,r,i,a){var u=e,c=o.optionObjOf(t,[o.optionOf("config",e)]);return h(u,c,t,n,r,i,a)}}}),o("ephox.katamari.api.Contracts",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Obj","ephox.katamari.api.Type","ephox.katamari.util.BagUtils","global!Error"],function(e,t,n,o,r,i){var a=function(e,t){return u(e,t,{validate:o.isFunction,label:"function"})},u=function(t,o,a){if(0===o.length)throw new i("You must specify at least one required field.");return r.validateStrArr("required",o),r.checkDupes(o),function(i){var u=n.keys(i);e.forall(o,function(t){return e.contains(u,t)})||r.reqMessage(o,u),t(o,u);var c=e.filter(o,function(e){return!a.validate(i[e],e)});return c.length>0&&r.invalidTypeMessage(c,a.label),i}},c=t.noop;return{exactly:t.curry(a,function(t,n){var o=e.filter(n,function(n){return!e.contains(t,n)});o.length>0&&r.unsuppMessage(o)}),ensure:t.curry(a,c),ensureWith:t.curry(u,c)}}),o("ephox.alloy.behaviour.common.BehaviourState",["ephox.katamari.api.Contracts"],function(e){return e.ensure(["readState"])}),r("global!Math",Math),o("ephox.alloy.behaviour.common.NoState",["ephox.alloy.behaviour.common.BehaviourState","global!Math"],function(e,t){return{init:function(){return e({readState:function(){return"No State required"}})}}}),o("ephox.alloy.api.behaviour.Behaviour",["ephox.alloy.behaviour.common.Behaviour","ephox.alloy.behaviour.common.NoState","ephox.boulder.api.FieldSchema","ephox.boulder.api.Objects","ephox.boulder.api.ValueSchema","ephox.katamari.api.Fun"],function(e,t,n,o,r,i){var a=r.objOfOnly([n.strict("fields"),n.strict("name"),n.defaulted("active",{}),n.defaulted("apis",{}),n.defaulted("extra",{}),n.defaulted("state",t)]),u=r.objOfOnly([n.strict("branchKey"),n.strict("branches"),n.strict("name"),n.defaulted("active",{}),n.defaulted("apis",{}),n.defaulted("extra",{}),n.defaulted("state",t)]);return{derive:function(e){return o.wrapAll(e)},revoke:i.constant(void 0),noActive:i.constant({}),noApis:i.constant({}),noExtra:i.constant({}),noState:i.constant(t),create:function(t){var n=r.asRawOrDie("Creating behaviour: "+t.name,a,t);return e.create(n.fields,n.name,n.active,n.apis,n.extra,n.state)},createModes:function(t){var n=r.asRawOrDie("Creating behaviour: "+t.name,u,t);return e.createModes(r.choose(n.branchKey,n.branches),n.name,n.active,n.apis,n.extra,n.state)}}}),o("ephox.sugar.api.properties.Toggler",[],function(){return function(e,t,n){var o=n||!1,r=function(){t(),o=!0},i=function(){e(),o=!1};return{on:r,off:i,toggle:function(){(o?i:r)()},isOn:function(){return o}}}}),o("ephox.sugar.api.node.Node",["ephox.sugar.api.node.NodeTypes"],function(e){var t=function(e){return e.dom().nodeName.toLowerCase()},n=function(e){return e.dom().nodeType},o=function(e){return function(t){return n(t)===e}},r=o(e.ELEMENT),i=o(e.TEXT),a=o(e.DOCUMENT);return{name:t,type:n,value:function(e){return e.dom().nodeValue},isElement:r,isText:i,isDocument:a,isComment:function(o){return n(o)===e.COMMENT||"#comment"===t(o)}}}),o("ephox.sugar.api.properties.Attr",["ephox.katamari.api.Type","ephox.katamari.api.Arr","ephox.katamari.api.Obj","ephox.sugar.api.node.Node","global!Error","global!console"],function(e,t,n,o,r,i){var a=function(t,n,o){if(!(e.isString(o)||e.isBoolean(o)||e.isNumber(o)))throw i.error("Invalid call to Attr.set. Key ",n,":: Value ",o,":: Element ",t),new r("Attribute value was not simple");t.setAttribute(n,o+"")},u=function(e,t,n){a(e.dom(),t,n)},c=function(e,t){var n=e.dom().getAttribute(t);return null===n?void 0:n},s=function(e,t){var n=e.dom();return!(!n||!n.hasAttribute)&&n.hasAttribute(t)};return{clone:function(e){return t.foldl(e.dom().attributes,function(e,t){return e[t.name]=t.value,e},{})},set:u,setAll:function(e,t){var o=e.dom();n.each(t,function(e,t){a(o,t,e)})},get:c,has:s,remove:function(e,t){e.dom().removeAttribute(t)},hasNone:function(e){var t=e.dom().attributes;return void 0===t||null===t||0===t.length},transfer:function(e,n,r){o.isElement(e)&&o.isElement(n)&&t.each(r,function(t){r=n,s(o=e,i=t)&&!s(r,i)&&u(r,i,c(o,i));var o,r,i})}}}),o("ephox.sugar.api.properties.AttrList",["ephox.katamari.api.Arr","ephox.sugar.api.properties.Attr"],function(e,t){var n=function(e,n){var o=t.get(e,n);return void 0===o||""===o?[]:o.split(" ")};return{read:n,add:function(e,o,r){var i=n(e,o).concat([r]);t.set(e,o,i.join(" "))},remove:function(o,r,i){var a=e.filter(n(o,r),function(e){return e!==i});a.length>0?t.set(o,r,a.join(" ")):t.remove(o,r)}}}),o("ephox.sugar.impl.ClassList",["ephox.katamari.api.Arr","ephox.sugar.api.properties.AttrList"],function(e,t){var n=function(e){return t.read(e,"class")},o=function(e,n){return t.add(e,"class",n)},r=function(e,n){return t.remove(e,"class",n)};return{get:n,add:o,remove:r,toggle:function(t,i){e.contains(n(t),i)?r(t,i):o(t,i)},supports:function(e){return void 0!==e.dom().classList}}}),o("ephox.sugar.api.properties.Class",["ephox.sugar.api.properties.Toggler","ephox.sugar.api.properties.Attr","ephox.sugar.impl.ClassList"],function(e,t,n){var o=function(e,t){return n.supports(e)&&e.dom().classList.contains(t)};return{add:function(e,t){n.supports(e)?e.dom().classList.add(t):n.add(e,t)},remove:function(e,o){n.supports(e)?e.dom().classList.remove(o):n.remove(e,o);r=e,0===(n.supports(r)?r.dom().classList:n.get(r)).length&&t.remove(r,"class");var r},toggle:function(e,t){return n.supports(e)?e.dom().classList.toggle(t):n.toggle(e,t)},toggler:function(t,r){var i=n.supports(t),a=t.dom().classList;return e(function(){i?a.remove(r):n.remove(t,r)},function(){i?a.add(r):n.add(t,r)},o(t,r))},has:o}}),o("ephox.alloy.behaviour.swapping.SwapApis",["ephox.sugar.api.properties.Class"],function(e){var t=function(t,n,o){e.remove(t,o),e.add(t,n)};return{toAlpha:function(e,n,o){t(e.element(),n.alpha(),n.omega())},toOmega:function(e,n,o){t(e.element(),n.omega(),n.alpha())},isAlpha:function(t,n,o){return e.has(t.element(),n.alpha())},isOmega:function(t,n,o){return e.has(t.element(),n.omega())},clear:function(t,n,o){e.remove(t.element(),n.alpha()),e.remove(t.element(),n.omega())}}}),o("ephox.alloy.behaviour.swapping.SwapSchema",["ephox.boulder.api.FieldSchema"],function(e){return[e.strict("alpha"),e.strict("omega")]}),o("ephox.alloy.api.behaviour.Swapping",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.behaviour.swapping.SwapApis","ephox.alloy.behaviour.swapping.SwapSchema"],function(e,t,n){return e.create({fields:n,name:"swapping",apis:t})}),o("ephox.sugar.alien.Recurse",[],function(){return{toArray:function(e,t){var n=[],o=function(e){return n.push(e),t(e)},r=t(e);do{r=r.bind(o)}while(r.isSome());return n}}}),o("ephox.sugar.api.search.Traverse",["ephox.katamari.api.Type","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.katamari.api.Struct","ephox.sugar.alien.Recurse","ephox.sugar.api.dom.Compare","ephox.sugar.api.node.Element"],function(e,t,n,o,r,i,a,u){var c=function(e){return u.fromDom(e.dom().ownerDocument)},s=function(e){var t=e.dom();return o.from(t.parentNode).map(u.fromDom)},l=function(e){var t=e.dom();return o.from(t.previousSibling).map(u.fromDom)},p=function(e){var t=e.dom();return o.from(t.nextSibling).map(u.fromDom)},f=function(e){var n=e.dom();return t.map(n.childNodes,u.fromDom)},m=function(e,t){var n=e.dom().childNodes;return o.from(n[t]).map(u.fromDom)},d=r.immutable("element","offset");return{owner:c,defaultView:function(e){var t=e.dom().ownerDocument.defaultView;return u.fromDom(t)},documentElement:function(e){var t=c(e);return u.fromDom(t.dom().documentElement)},parent:s,findIndex:function(e){return s(e).bind(function(n){var o=f(n);return t.findIndex(o,function(t){return a.eq(e,t)})})},parents:function(t,o){for(var r=e.isFunction(o)?o:n.constant(!1),i=t.dom(),a=[];null!==i.parentNode&&void 0!==i.parentNode;){var c=i.parentNode,s=u.fromDom(c);if(a.push(s),!0===r(s))break;i=c}return a},siblings:function(e){return s(e).map(f).map(function(n){return t.filter(n,function(t){return!a.eq(e,t)})}).getOr([])},prevSibling:l,offsetParent:function(e){var t=e.dom();return o.from(t.offsetParent).map(u.fromDom)},prevSiblings:function(e){return t.reverse(i.toArray(e,l))},nextSibling:p,nextSiblings:function(e){return i.toArray(e,p)},children:f,child:m,firstChild:function(e){return m(e,0)},lastChild:function(e){return m(e,e.dom().childNodes.length-1)},childNodesCount:function(e){return e.dom().childNodes.length},hasChildNodes:function(e){return e.dom().hasChildNodes()},leaf:function(e,t){var n=f(e);return n.length>0&&t<n.length?d(n[t],0):d(e,t)}}}),o("ephox.sugar.api.dom.Insert",["ephox.sugar.api.search.Traverse"],function(e){var t=function(t,n){e.parent(t).each(function(e){e.dom().insertBefore(n.dom(),t.dom())})},n=function(e,t){e.dom().appendChild(t.dom())};return{before:t,after:function(o,r){e.nextSibling(o).fold(function(){e.parent(o).each(function(e){n(e,r)})},function(e){t(e,r)})},prepend:function(t,o){e.firstChild(t).fold(function(){n(t,o)},function(e){t.dom().insertBefore(o.dom(),e.dom())})},append:n,appendAt:function(o,r,i){e.child(o,i).fold(function(){n(o,r)},function(e){t(e,r)})},wrap:function(e,o){t(e,o),n(o,e)}}}),o("ephox.sugar.api.dom.InsertAll",["ephox.katamari.api.Arr","ephox.sugar.api.dom.Insert"],function(e,t){return{before:function(n,o){e.each(o,function(e){t.before(n,e)})},after:function(n,o){e.each(o,function(e,r){var i=0===r?n:o[r-1];t.after(i,e)})},prepend:function(n,o){e.each(o.slice().reverse(),function(e){t.prepend(n,e)})},append:function(n,o){e.each(o,function(e){t.append(n,e)})}}}),o("ephox.sugar.api.dom.Remove",["ephox.katamari.api.Arr","ephox.sugar.api.dom.InsertAll","ephox.sugar.api.search.Traverse"],function(e,t,n){var o=function(e){var t=e.dom();null!==t.parentNode&&t.parentNode.removeChild(t)};return{empty:function(t){t.dom().textContent="",e.each(n.children(t),function(e){o(e)})},remove:o,unwrap:function(e){var r=n.children(e);r.length>0&&t.before(e,r),o(e)}}}),o("ephox.sugar.api.node.Body",["ephox.katamari.api.Thunk","ephox.sugar.api.node.Element","ephox.sugar.api.node.Node","global!document"],function(e,t,n,o){var r=e.cached(function(){return i(t.fromDom(o))}),i=function(e){var n=e.dom().body;if(null===n||void 0===n)throw"Body is not available yet";return t.fromDom(n)};return{body:r,getBody:i,inBody:function(e){var t=n.isText(e)?e.dom().parentNode:e.dom();return void 0!==t&&null!==t&&t.ownerDocument.body.contains(t)}}}),o("ephox.alloy.api.system.Attachment",["ephox.alloy.api.events.AlloyTriggers","ephox.alloy.api.events.SystemEvents","ephox.katamari.api.Arr","ephox.katamari.api.Option","ephox.sugar.api.dom.Insert","ephox.sugar.api.dom.Remove","ephox.sugar.api.node.Body","ephox.sugar.api.search.Traverse"],function(e,t,n,o,r,i,a,u){var c=function(o){e.emit(o,t.detachedFromDom());var r=o.components();n.each(r,c)},s=function(o){var r=o.components();n.each(r,s),e.emit(o,t.attachedToDom())},l=function(e,t,n){e.getSystem().addToWorld(t),n(e.element(),t.element()),a.inBody(e.element())&&s(t),e.syncComponents()},p=function(e){c(e),i.remove(e.element()),e.getSystem().removeFromWorld(e)};return{attach:function(e,t){l(e,t,r.append)},attachWith:l,detach:function(e){var t=u.parent(e.element()).bind(function(t){return e.getSystem().getByDom(t).fold(o.none,o.some)});p(e),t.each(function(e){e.syncComponents()})},detachChildren:function(e){var t=e.components();n.each(t,p),i.empty(e.element()),e.syncComponents()},attachSystem:function(e,t){r.append(e,t.element());var o=u.children(t.element());n.each(o,function(e){t.getByDom(e).each(s)})},detachSystem:function(e){var t=u.children(e.element());n.each(t,function(t){e.getByDom(t).each(c)}),i.remove(e.element())}}}),o("ephox.sugar.api.node.Elements",["ephox.katamari.api.Arr","ephox.sugar.api.node.Element","ephox.sugar.api.search.Traverse","global!document"],function(e,t,n,o){return{fromHtml:function(e,r){var i=(r||o).createElement("div");return i.innerHTML=e,n.children(t.fromDom(i))},fromTags:function(n,o){return e.map(n,function(e){return t.fromTag(e,o)})},fromText:function(n,o){return e.map(n,function(e){return t.fromText(e,o)})},fromDom:function(n){return e.map(n,t.fromDom)}}}),o("ephox.sugar.api.properties.Html",["ephox.sugar.api.node.Element","ephox.sugar.api.node.Elements","ephox.sugar.api.dom.Insert","ephox.sugar.api.dom.InsertAll","ephox.sugar.api.dom.Remove","ephox.sugar.api.search.Traverse"],function(e,t,n,o,r,i){var a=function(e){return e.dom().innerHTML};return{get:a,set:function(a,u){var c=i.owner(a).dom(),s=e.fromDom(c.createDocumentFragment()),l=t.fromHtml(u,c);o.append(s,l),r.empty(a),n.append(a,s)},getOuter:function(t){var o=e.fromTag("div"),r=e.fromDom(t.dom().cloneNode(!0));return n.append(o,r),a(o)}}}),o("ephox.sugar.api.dom.Replication",["ephox.sugar.api.properties.Attr","ephox.sugar.api.node.Element","ephox.sugar.api.dom.Insert","ephox.sugar.api.dom.InsertAll","ephox.sugar.api.dom.Remove","ephox.sugar.api.search.Traverse"],function(e,t,n,o,r,i){var a=function(e,n){return t.fromDom(e.dom().cloneNode(n))},u=function(e){return a(e,!0)},c=function(n,o){var r=t.fromTag(o),i=e.clone(n);return e.setAll(r,i),r};return{shallow:function(e){return a(e,!1)},shallowAs:c,deep:u,copy:function(e,t){var n=c(e,t),r=i.children(u(e));return o.append(n,r),n},mutate:function(e,t){var a=c(e,t);n.before(e,a);var u=i.children(e);return o.append(a,u),r.remove(e),a}}}),o("ephox.alloy.alien.Truncate",["ephox.sugar.api.properties.Html","ephox.sugar.api.dom.Replication"],function(e,t){return{getHtml:function(n){var o=t.shallow(n);return e.getOuter(o)}}}),o("ephox.alloy.log.AlloyLogger",["ephox.alloy.alien.Truncate"],function(e){return{element:function(t){return e.getHtml(t)}}}),o("ephox.katamari.api.Options",["ephox.katamari.api.Option"],function(e){return{cat:function(e){for(var t=[],n=function(e){t.push(e)},o=0;o<e.length;o++)e[o].each(n);return t},findMap:function(t,n){for(var o=0;o<t.length;o++){var r=n(t[o],o);if(r.isSome())return r}return e.none()},liftN:function(t,n){for(var o=[],r=0;r<t.length;r++){var i=t[r];if(!i.isSome())return e.none();o.push(i.getOrDie())}return e.some(n.apply(null,o))}}}),o("ephox.alloy.debugging.Debugging",["ephox.alloy.api.events.SystemEvents","ephox.alloy.log.AlloyLogger","ephox.boulder.api.Objects","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Obj","ephox.katamari.api.Options","global!console","global!Error"],function(e,t,n,o,r,i,a,u,c){var s="__CHROME_INSPECTOR_CONNECTION_TO_ALLOY__",l=[],p=["alloy/data/Fields","alloy/debugging/Debugging"],f={logEventCut:r.noop,logEventStopped:r.noop,logNoParent:r.noop,logEventNoHandlers:r.noop,logEventResponse:r.noop,write:r.noop},m=function(){return void 0!==window[s]?window[s]:(window[s]={systems:{},lookup:function(e){var r=window[s].systems,u=i.keys(r);return a.findMap(u,function(a){return r[a].getByUid(e).toOption().map(function(e){return n.wrap(t.element(e.element()),function(e){var n=function(e){var r=e.spec();return{"(original.spec)":r,"(dom.ref)":e.element().dom(),"(element)":t.element(e.element()),"(initComponents)":o.map(void 0!==r.components?r.components:[],n),"(components)":o.map(e.components(),n),"(bound.events)":i.mapToArray(e.events(),function(e,t){return[t]}).join(", "),"(behaviours)":void 0!==r.behaviours?i.map(r.behaviours,function(t,n){return void 0===t?"--revoked--":{config:t.configAsRaw(),"original-config":t.initialConfig,state:e.readState(n)}}):"none"}};return n(e)}(e))})})}},window[s])};return{logHandler:function(e,t,n){},noLogger:r.constant(f),getTrace:function(){var e=new c;if(void 0!==e.stack){var t=e.stack.split("\n");return o.find(t,function(e){return e.indexOf("alloy")>0&&!o.exists(p,function(t){return e.indexOf(t)>-1})}).getOr("unknown")}return"unknown"},monitorEvent:function(n,r,i){var a="*"===l||o.contains(l,n)?function(){var i=[];return{logEventCut:function(e,t,n){i.push({outcome:"cut",target:t,purpose:n})},logEventStopped:function(e,t,n){i.push({outcome:"stopped",target:t,purpose:n})},logNoParent:function(e,t,n){i.push({outcome:"no-parent",target:t,purpose:n})},logEventNoHandlers:function(e,t){i.push({outcome:"no-handlers-left",target:t})},logEventResponse:function(e,t,n){i.push({outcome:"response",purpose:n,target:t})},write:function(){o.contains(["mousemove","mouseover","mouseout",e.systemInit()],n)||u.log(n,{event:n,target:r.dom(),sequence:o.map(i,function(e){return o.contains(["cut","stopped","response"],e.outcome)?"{"+e.purpose+"} "+e.outcome+" at ("+t.element(e.target)+")":e.outcome})})}}}():f,c=i(a);return a.write(),c},isDebugging:r.constant(!0),registerInspector:function(e,t){m().systems[e]=t}}}),o("ephox.katamari.api.Cell",[],function(){var e=function(t){var n=t,o=function(){return n};return{get:o,set:function(e){n=e},clone:function(){return e(o())}}};return e}),o("ephox.sugar.impl.ClosestOrAncestor",["ephox.katamari.api.Type","ephox.katamari.api.Option"],function(e,t){return function(n,o,r,i,a){return n(r,i)?t.some(r):e.isFunction(a)&&a(r)?t.none():o(r,i,a)}}),o("ephox.sugar.api.search.PredicateFind",["ephox.katamari.api.Type","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.sugar.api.node.Body","ephox.sugar.api.dom.Compare","ephox.sugar.api.node.Element","ephox.sugar.impl.ClosestOrAncestor"],function(e,t,n,o,r,i,a,u){var c=function(t,r,i){for(var u=t.dom(),c=e.isFunction(i)?i:n.constant(!1);u.parentNode;){u=u.parentNode;var s=a.fromDom(u);if(r(s))return o.some(s);if(c(s))break}return o.none()},s=function(e,o){return t.find(e.dom().childNodes,n.compose(o,a.fromDom)).map(a.fromDom)},l=function(e,t){var n=function(e){for(var r=0;r<e.childNodes.length;r++){if(t(a.fromDom(e.childNodes[r])))return o.some(a.fromDom(e.childNodes[r]));var i=n(e.childNodes[r]);if(i.isSome())return i}return o.none()};return n(e.dom())};return{first:function(e){return l(r.body(),e)},ancestor:c,closest:function(e,t,n){return u(function(e){return t(e)},c,e,t,n)},sibling:function(e,t){var n=e.dom();return n.parentNode?s(a.fromDom(n.parentNode),function(n){return!i.eq(e,n)&&t(n)}):o.none()},child:s,descendant:l}}),o("ephox.sugar.api.search.PredicateExists",["ephox.sugar.api.search.PredicateFind"],function(e){return{any:function(t){return e.first(t).isSome()},ancestor:function(t,n,o){return e.ancestor(t,n,o).isSome()},closest:function(t,n,o){return e.closest(t,n,o).isSome()},sibling:function(t,n){return e.sibling(t,n).isSome()},child:function(t,n){return e.child(t,n).isSome()},descendant:function(t,n){return e.descendant(t,n).isSome()}}}),o("ephox.sugar.api.dom.Focus",["ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.sugar.api.dom.Compare","ephox.sugar.api.node.Element","ephox.sugar.api.search.PredicateExists","ephox.sugar.api.search.Traverse","global!document"],function(e,t,n,o,r,i,a){var u=function(e){e.dom().focus()},c=function(e){var n=void 0!==e?e.dom():a;return t.from(n.activeElement).map(o.fromDom)};return{hasFocus:function(e){var t=i.owner(e).dom();return e.dom()===t.activeElement},focus:u,blur:function(e){e.dom().blur()},active:c,search:function(e){return c(i.owner(e)).filter(function(t){return e.dom().contains(t.dom())})},focusInside:function(t){var o=i.owner(t);c(o).filter(function(o){return r.closest(o,e.curry(n.eq,t))}).fold(function(){u(t)},e.noop)}}}),r("global!tinymce.util.Tools.resolve",tinymce.util.Tools.resolve),o("tinymce.core.ThemeManager",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.ThemeManager")}),o("tinymce.core.dom.DOMUtils",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.dom.DOMUtils")}),o("tinymce.themes.mobile.alien.TinyCodeDupe",["global!document"],function(e){return{openLink:function(t){var n=e.createElement("a");n.target="_blank",n.href=t.href,n.rel="noreferrer noopener";var o=e.createEvent("MouseEvents");o.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),e.body.appendChild(n),n.dispatchEvent(o),e.body.removeChild(n)}}}),o("tinymce.themes.mobile.api.Settings",[],function(){return{isSkinDisabled:function(e){return!1===e.settings.skin}}}),o("tinymce.themes.mobile.channels.TinyChannels",["ephox.katamari.api.Fun"],function(e){return{formatChanged:e.constant("formatChanged"),orientationChanged:e.constant("orientationChanged"),dropupDismissed:e.constant("dropupDismissed")}}),o("ephox.alloy.behaviour.receiving.ActiveReceiving",["ephox.alloy.api.events.AlloyEvents","ephox.alloy.api.events.SystemEvents","ephox.alloy.log.AlloyLogger","ephox.boulder.api.ValueSchema","ephox.katamari.api.Arr","ephox.katamari.api.Obj"],function(e,t,n,o,r,i){return{events:function(a){return e.derive([e.run(t.receive(),function(e,t){var u,c,s=a.channels(),l=i.keys(s),p=(u=l,c=t,c.universal()?u:r.filter(u,function(e){return r.contains(c.channels(),e)}));r.each(p,function(r){var i=s[r](),a=i.schema(),u=o.asStructOrDie("channel["+r+"] data\nReceiver: "+n.element(e.element()),a,t.data());i.onReceive()(e,u)})})])}}}),o("ephox.alloy.menu.util.MenuMarkers",["ephox.boulder.api.FieldSchema","ephox.boulder.api.ValueSchema","ephox.katamari.api.Fun"],function(e,t,n){var o=[e.strict("menu"),e.strict("selectedMenu")],r=[e.strict("item"),e.strict("selectedItem")],i=t.objOfOnly(r.concat(o)),a=t.objOfOnly(r);return{menuFields:n.constant(o),itemFields:n.constant(r),schema:n.constant(i),itemSchema:n.constant(a)}}),o("ephox.alloy.data.Fields",["ephox.alloy.debugging.Debugging","ephox.alloy.menu.util.MenuMarkers","ephox.boulder.api.FieldPresence","ephox.boulder.api.FieldSchema","ephox.boulder.api.ValueSchema","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.katamari.api.Result","global!console"],function(e,t,n,o,r,i,a,u,c,s){var l=o.strictObjOf("initSize",[o.strict("numColumns"),o.strict("numRows")]),p=function(t,n,i){var a=e.getTrace();return o.field(n,n,i,r.valueOf(function(o){return c.value(function(){return e.logHandler(t,n,a),o.apply(void 0,arguments)})}))};return{initSize:a.constant(l),itemMarkers:function(){return o.strictOf("markers",t.itemSchema())},menuMarkers:function(){return o.strictOf("markers",t.schema())},tieredMenuMarkers:function(){return o.strictObjOf("markers",[o.strict("backgroundMenu")].concat(t.menuFields()).concat(t.itemFields()))},markers:function(e){return o.strictObjOf("markers",i.map(e,o.strict))},onHandler:function(e){return p("onHandler",e,n.defaulted(a.noop))},onKeyboardHandler:function(e){return p("onKeyboardHandler",e,n.defaulted(u.none))},onStrictHandler:function(e){return p("onHandler",e,n.strict())},onStrictKeyboardHandler:function(e){return p("onKeyboardHandler",e,n.strict())},output:function(e,t){return o.state(e,a.constant(t))},snapshot:function(e){return o.state(e,a.identity)}}}),o("ephox.alloy.behaviour.receiving.ReceivingSchema",["ephox.alloy.data.Fields","ephox.boulder.api.FieldSchema","ephox.boulder.api.ValueSchema","ephox.katamari.api.Result"],function(e,t,n,o){return[t.strictOf("channels",n.setOf(o.value,n.objOfOnly([e.onStrictHandler("onReceive"),t.defaulted("schema",n.anyValue())])))]}),o("ephox.alloy.api.behaviour.Receiving",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.behaviour.receiving.ActiveReceiving","ephox.alloy.behaviour.receiving.ReceivingSchema"],function(e,t,n){return e.create({fields:n,name:"receiving",active:t})}),o("ephox.alloy.behaviour.toggling.ToggleApis",["ephox.sugar.api.properties.Class"],function(e){var t=function(e,t,n){var o=r(e,t),i=t.aria();i.update()(e,i,o)},n=function(n,o,r){e.add(n.element(),o.toggleClass()),t(n,o)},o=function(n,o,r){e.remove(n.element(),o.toggleClass()),t(n,o)},r=function(t,n,o){return e.has(t.element(),n.toggleClass())};return{onLoad:function(e,t,r){(t.selected()?n:o)(e,t,r)},toggle:function(n,o,r){e.toggle(n.element(),o.toggleClass()),t(n,o)},isOn:r,on:n,off:o}}),o("ephox.alloy.behaviour.toggling.ActiveToggle",["ephox.alloy.api.events.AlloyEvents","ephox.alloy.behaviour.common.Behaviour","ephox.alloy.behaviour.toggling.ToggleApis","ephox.alloy.dom.DomModification","ephox.katamari.api.Arr"],function(e,t,n,o,r){return{exhibit:function(e,t,n){return o.nu({})},events:function(o,i){var a=t.executeEvent(o,i,n.toggle),u=t.loadEvent(o,i,n.onLoad);return e.derive(r.flatten([o.toggleOnExecute()?[a]:[],[u]]))}}}),o("ephox.alloy.behaviour.toggling.ToggleModes",["ephox.boulder.api.Objects","ephox.katamari.api.Arr","ephox.katamari.api.Option","ephox.sugar.api.node.Node","ephox.sugar.api.properties.Attr"],function(e,t,n,o,r){var i=function(e,t,n){r.set(e.element(),"aria-expanded",n)},a={button:["aria-pressed"],"input:checkbox":["aria-checked"]},u={button:["aria-pressed"],listbox:["aria-pressed","aria-expanded"],menuitemcheckbox:["aria-checked"]};return{updatePressed:function(e,t,n){r.set(e.element(),"aria-pressed",n),t.syncWithExpanded()&&i(e,t,n)},updateSelected:function(e,t,n){r.set(e.element(),"aria-selected",n)},updateChecked:function(e,t,n){r.set(e.element(),"aria-checked",n)},updateExpanded:i,updateAuto:function(i,c,s){var l=function(t){var o=t.element();if(r.has(o,"role")){var i=r.get(o,"role");return e.readOptFrom(u,i)}return n.none()}(i).orThunk(function(){return function(t){var n=t.element(),i=o.name(n),u="input"===i&&r.has(n,"type")?":"+r.get(n,"type"):"";return e.readOptFrom(a,i+u)}(i)}).getOr([]);t.each(l,function(e){r.set(i.element(),e,s)})}}}),o("ephox.alloy.behaviour.toggling.ToggleSchema",["ephox.alloy.behaviour.toggling.ToggleModes","ephox.alloy.data.Fields","ephox.boulder.api.FieldSchema","ephox.boulder.api.ValueSchema","ephox.katamari.api.Fun"],function(e,t,n,o,r){return[n.defaulted("selected",!1),n.strict("toggleClass"),n.defaulted("toggleOnExecute",!0),n.defaultedOf("aria",{mode:"none"},o.choose("mode",{pressed:[n.defaulted("syncWithExpanded",!1),t.output("update",e.updatePressed)],checked:[t.output("update",e.updateChecked)],expanded:[t.output("update",e.updateExpanded)],selected:[t.output("update",e.updateSelected)],none:[t.output("update",r.noop)]}))]}),o("ephox.alloy.api.behaviour.Toggling",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.behaviour.toggling.ActiveToggle","ephox.alloy.behaviour.toggling.ToggleApis","ephox.alloy.behaviour.toggling.ToggleSchema"],function(e,t,n,o){return e.create({fields:o,name:"toggling",active:t,apis:n})}),o("ephox.alloy.ephemera.AlloyTags",["ephox.katamari.api.Fun"],function(e){return{prefix:e.constant("alloy-id-"),idAttr:e.constant("data-alloy-id")}}),r("global!Date",Date),o("ephox.katamari.api.Id",["global!Date","global!Math","global!String"],function(e,t,n){var o=0;return{generate:function(r){var i=(new e).getTime();return r+"_"+t.floor(1e9*t.random())+ ++o+n(i)}}}),o("ephox.sugar.api.search.SelectorFind",["ephox.sugar.api.search.PredicateFind","ephox.sugar.api.search.Selectors","ephox.sugar.impl.ClosestOrAncestor"],function(e,t,n){var o=function(n,o,r){return e.ancestor(n,function(e){return t.is(e,o)},r)};return{first:function(e){return t.one(e)},ancestor:o,sibling:function(n,o){return e.sibling(n,function(e){return t.is(e,o)})},child:function(n,o){return e.child(n,function(e){return t.is(e,o)})},descendant:function(e,n){return t.one(n,e)},closest:function(e,r,i){return n(t.is,o,e,r,i)}}}),o("ephox.alloy.registry.Tagger",["ephox.alloy.ephemera.AlloyTags","ephox.katamari.api.Id","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.sugar.api.properties.Attr","ephox.sugar.api.node.Node","ephox.sugar.api.search.SelectorFind"],function(e,t,n,o,r,i,a){var u=e.prefix(),c=e.idAttr();return{revoke:function(e){r.remove(e,c)},write:function(e,n){var o=t.generate(u+e);return r.set(n,c,o),o},writeOnly:function(e,t){r.set(e,c,t)},read:function(e){var t=i.isElement(e)?r.get(e,c):null;return o.from(t)},find:function(e,t){return a.descendant(e,t)},generate:function(e){return t.generate(e)},attribute:n.constant(c)}}),o("ephox.alloy.api.component.Memento",["ephox.alloy.registry.Tagger","ephox.boulder.api.Objects","ephox.katamari.api.Merger","ephox.katamari.api.Option"],function(e,t,n,o){return{record:function(r){var i=t.hasKey(r,"uid")?r.uid:e.generate("memento");return{get:function(e){return e.getSystem().getByUid(i).getOrDie()},getOpt:function(e){return e.getSystem().getByUid(i).fold(o.none,o.some)},asSpec:function(){return n.deepMerge(r,{uid:i})}}}}}),r("global!setTimeout",setTimeout),r("global!window",window),o("tinymce.themes.mobile.channels.Receivers",["ephox.alloy.api.behaviour.Receiving","ephox.boulder.api.Objects","tinymce.themes.mobile.channels.TinyChannels"],function(e,t,n){return{format:function(o,r){return e.config({channels:t.wrap(n.formatChanged(),{onReceive:function(e,t){t.command===o&&r(e,t.state)}})})},orientation:function(o){return e.config({channels:t.wrap(n.orientationChanged(),{onReceive:o})})},receive:function(e,t){return{key:e,value:{onReceive:t}}}}}),o("tinymce.themes.mobile.style.Styles",["ephox.katamari.api.Fun"],function(e){return{resolve:function(e){return"tinymce-mobile-"+e},prefix:e.constant("tinymce-mobile")}}),o("ephox.alloy.behaviour.unselecting.ActiveUnselecting",["ephox.alloy.api.events.AlloyEvents","ephox.alloy.api.events.NativeEvents","ephox.alloy.dom.DomModification","ephox.katamari.api.Fun"],function(e,t,n,o){return{events:function(n){return e.derive([e.abort(t.selectstart(),o.constant(!0))])},exhibit:function(e,t){return n.nu({styles:{"-webkit-user-select":"none","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none"},attributes:{unselectable:"on"}})}}}),o("ephox.alloy.api.behaviour.Unselecting",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.behaviour.unselecting.ActiveUnselecting"],function(e,t){return e.create({fields:[],name:"unselecting",active:t})}),o("ephox.alloy.behaviour.focusing.FocusApis",["ephox.sugar.api.dom.Focus"],function(e){return{focus:function(t,n){n.ignore()||(e.focus(t.element()),n.onFocus()(t))},blur:function(t,n){n.ignore()||e.blur(t.element())},isFocused:function(t){return e.hasFocus(t.element())}}}),o("ephox.alloy.behaviour.focusing.ActiveFocus",["ephox.alloy.api.events.AlloyEvents","ephox.alloy.api.events.SystemEvents","ephox.alloy.behaviour.focusing.FocusApis","ephox.alloy.dom.DomModification"],function(e,t,n,o){return{exhibit:function(e,t){return t.ignore()?o.nu({}):o.nu({attributes:{tabindex:"-1"}})},events:function(o){return e.derive([e.run(t.focus(),function(e,t){n.focus(e,o),t.stop()})])}}}),o("ephox.alloy.behaviour.focusing.FocusSchema",["ephox.alloy.data.Fields","ephox.boulder.api.FieldSchema"],function(e,t){return[e.onHandler("onFocus"),t.defaulted("ignore",!1)]}),o("ephox.alloy.api.behaviour.Focusing",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.behaviour.focusing.ActiveFocus","ephox.alloy.behaviour.focusing.FocusApis","ephox.alloy.behaviour.focusing.FocusSchema"],function(e,t,n,o){return e.create({fields:o,name:"focusing",active:t,apis:n})}),o("ephox.alloy.alien.Keys",["ephox.katamari.api.Fun"],function(e){return{BACKSPACE:e.constant([8]),TAB:e.constant([9]),ENTER:e.constant([13]),SHIFT:e.constant([16]),CTRL:e.constant([17]),ALT:e.constant([18]),CAPSLOCK:e.constant([20]),ESCAPE:e.constant([27]),SPACE:e.constant([32]),PAGEUP:e.constant([33]),PAGEDOWN:e.constant([34]),END:e.constant([35]),HOME:e.constant([36]),LEFT:e.constant([37]),UP:e.constant([38]),RIGHT:e.constant([39]),DOWN:e.constant([40]),INSERT:e.constant([45]),DEL:e.constant([46]),META:e.constant([91,93,224]),F10:e.constant([121])}}),o("ephox.alloy.alien.Cycles",[],function(){return{cycleBy:function(e,t,n,o){var r=e+t;return r>o?n:r<n?o:r},cap:function(e,t,n){return e<=t?t:e>=n?n:e}}}),o("ephox.sugar.api.search.PredicateFilter",["ephox.katamari.api.Arr","ephox.sugar.api.node.Body","ephox.sugar.api.search.Traverse"],function(e,t,n){var o=function(t,r){var i=[];return e.each(n.children(t),function(e){r(e)&&(i=i.concat([e])),i=i.concat(o(e,r))}),i};return{all:function(e){return o(t.body(),e)},ancestors:function(t,o,r){return e.filter(n.parents(t,r),o)},siblings:function(t,o){return e.filter(n.siblings(t),o)},children:function(t,o){return e.filter(n.children(t),o)},descendants:o}}),o("ephox.sugar.api.search.SelectorFilter",["ephox.sugar.api.search.PredicateFilter","ephox.sugar.api.search.Selectors"],function(e,t){return{all:function(e){return t.all(e)},ancestors:function(n,o,r){return e.ancestors(n,function(e){return t.is(e,o)},r)},siblings:function(n,o){return e.siblings(n,function(e){return t.is(e,o)})},children:function(n,o){return e.children(n,function(e){return t.is(e,o)})},descendants:function(e,n){return t.all(n,e)}}}),o("ephox.alloy.behaviour.highlighting.HighlightApis",["ephox.alloy.alien.Cycles","ephox.katamari.api.Arr","ephox.katamari.api.Option","ephox.katamari.api.Result","ephox.sugar.api.properties.Class","ephox.sugar.api.search.SelectorFilter","ephox.sugar.api.search.SelectorFind","global!Error"],function(e,t,n,o,r,i,a,u){var c=function(e,n,o){var a=i.descendants(e.element(),"."+n.highlightClass());t.each(a,function(t){r.remove(t,n.highlightClass()),e.getSystem().getByDom(t).each(function(t){n.onDehighlight()(e,t)})})},s=function(e,t,n,o){var i=l(e,t,n,o);c(e,t),r.add(o.element(),t.highlightClass()),i||t.onHighlight()(e,o)},l=function(e,t,n,o){return r.has(o.element(),t.highlightClass())},p=function(e,t,r,a){var u=i.descendants(e.element(),"."+t.itemClass());return n.from(u[a]).fold(function(){return o.error("No element found with index "+a)},e.getSystem().getByDom)},f=function(e,t,n){return a.descendant(e.element(),"."+t.itemClass()).bind(e.getSystem().getByDom)},m=function(e,t,o){var r=i.descendants(e.element(),"."+t.itemClass());return(r.length>0?n.some(r[r.length-1]):n.none()).bind(e.getSystem().getByDom)},d=function(n,o,a,u){var c=i.descendants(n.element(),"."+o.itemClass());return t.findIndex(c,function(e){return r.has(e,o.highlightClass())}).bind(function(t){var o=e.cycleBy(t,u,0,c.length-1);return n.getSystem().getByDom(c[o])})};return{dehighlightAll:c,dehighlight:function(e,t,n,o){var i=l(e,t,n,o);r.remove(o.element(),t.highlightClass()),i&&t.onDehighlight()(e,o)},highlight:s,highlightFirst:function(e,t,n){f(e,t,n).each(function(o){s(e,t,n,o)})},highlightLast:function(e,t,n){m(e,t,n).each(function(o){s(e,t,n,o)})},highlightAt:function(e,t,n,o){p(e,t,n,o).fold(function(e){throw new u(e)},function(o){s(e,t,n,o)})},isHighlighted:l,getHighlighted:function(e,t,n){return a.descendant(e.element(),"."+t.highlightClass()).bind(e.getSystem().getByDom)},getFirst:f,getLast:m,getPrevious:function(e,t,n){return d(e,t,0,-1)},getNext:function(e,t,n){return d(e,t,0,1)}}}),o("ephox.alloy.behaviour.highlighting.HighlightSchema",["ephox.alloy.data.Fields","ephox.boulder.api.FieldSchema"],function(e,t){return[t.strict("highlightClass"),t.strict("itemClass"),e.onHandler("onHighlight"),e.onHandler("onDehighlight")]}),o("ephox.alloy.api.behaviour.Highlighting",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.behaviour.highlighting.HighlightApis","ephox.alloy.behaviour.highlighting.HighlightSchema","global!Array"],function(e,t,n,o){return e.create({fields:n,name:"highlighting",apis:t})}),o("ephox.alloy.api.focus.FocusManagers",["ephox.alloy.api.behaviour.Highlighting","ephox.katamari.api.Fun","ephox.sugar.api.dom.Focus"],function(e,t,n){return{dom:function(){return{get:function(e){return n.search(e.element())},set:function(e,t){e.getSystem().triggerFocus(t,e.element())}}},highlights:function(){return{get:function(t){return e.getHighlighted(t).map(function(e){return e.element()})},set:function(n,o){n.getSystem().getByDom(o).fold(t.noop,function(t){e.highlight(n,t)})}}}}}),o("ephox.alloy.navigation.KeyMatch",["ephox.katamari.api.Arr","ephox.katamari.api.Fun"],function(e,t){var n=function(e){return!0===e.raw().shiftKey};return{inSet:function(t){return function(n){return e.contains(t,n.raw().which)}},and:function(t){return function(n){return e.forall(t,function(e){return e(n)})}},is:function(e){return function(t){return t.raw().which===e}},isShift:n,isNotShift:t.not(n)}}),o("ephox.alloy.navigation.KeyRules",["ephox.alloy.navigation.KeyMatch","ephox.katamari.api.Arr"],function(e,t){return{basic:function(t,n){return{matches:e.is(t),classification:n}},rule:function(e,t){return{matches:e,classification:t}},choose:function(e,n){return t.find(e,function(e){return e.matches(n)}).map(function(e){return e.classification})}}}),o("ephox.alloy.keying.KeyingType",["ephox.alloy.api.events.AlloyEvents","ephox.alloy.api.events.NativeEvents","ephox.alloy.api.events.SystemEvents","ephox.alloy.api.focus.FocusManagers","ephox.alloy.data.Fields","ephox.alloy.navigation.KeyRules","ephox.boulder.api.FieldSchema","ephox.katamari.api.Merger"],function(e,t,n,o,r,i,a,u){return{typical:function(c,s,l,p,f,m){var d=function(e,t,n,o){var r=l(e,t,n,o);return i.choose(r,t.event()).bind(function(r){return r(e,t,n,o)})},h={schema:function(){return c.concat([a.defaulted("focusManager",o.dom()),r.output("handler",h),r.output("state",s)])},processKey:d,toEvents:function(o,r){var i=p(o,r),a=e.derive(m.map(function(t){return e.run(n.focus(),function(e,n){t(e,o,r,n),n.stop()})}).toArray().concat([e.run(t.keydown(),function(e,t){d(e,t,o,r).each(function(e){t.stop()})})]));return u.deepMerge(i,a)},toApis:f};return h}}}),o("ephox.alloy.navigation.ArrNavigation",["ephox.katamari.api.Arr","global!Math"],function(e,t){return{cyclePrev:function(t,n,o){var r=e.reverse(t.slice(0,n)),i=e.reverse(t.slice(n+1));return e.find(r.concat(i),o)},cycleNext:function(t,n,o){var r=t.slice(0,n),i=t.slice(n+1);return e.find(i.concat(r),o)},tryPrev:function(t,n,o){var r=e.reverse(t.slice(0,n));return e.find(r,o)},tryNext:function(t,n,o){var r=t.slice(n+1);return e.find(r,o)}}}),o("ephox.sugar.impl.Style",[],function(){return{isSupported:function(e){return void 0!==e.style}}}),o("ephox.sugar.api.properties.Css",["ephox.katamari.api.Type","ephox.katamari.api.Arr","ephox.katamari.api.Obj","ephox.katamari.api.Option","ephox.sugar.api.properties.Attr","ephox.sugar.api.node.Body","ephox.sugar.api.node.Element","ephox.sugar.api.node.Node","ephox.sugar.impl.Style","ephox.katamari.api.Strings","global!Error","global!console","global!window"],function(e,t,n,o,r,i,a,u,c,s,l,p,f){var m=function(t,n,o){if(!e.isString(o))throw p.error("Invalid call to CSS.set. Property ",n,":: Value ",o,":: Element ",t),new l("CSS value must be a string: "+o);c.isSupported(t)&&t.style.setProperty(n,o)},d=function(e,t){c.isSupported(e)&&e.style.removeProperty(t)},h=function(e,t,n){var o=e.dom();m(o,t,n)},g=function(e,t){return c.isSupported(e)?e.style.getPropertyValue(t):""},v=function(e,t){var n=e.dom(),r=g(n,t);return o.from(r).filter(function(e){return e.length>0})};return{copy:function(e,t){var n=e.dom(),o=t.dom();c.isSupported(n)&&c.isSupported(o)&&(o.style.cssText=n.style.cssText)},set:h,preserve:function(e,t){var n=r.get(e,"style"),o=t(e);return(void 0===n?r.remove:r.set)(e,"style",n),o},setAll:function(e,t){var o=e.dom();n.each(t,function(e,t){m(o,t,e)})},setOptions:function(e,t){var o=e.dom();n.each(t,function(e,t){e.fold(function(){d(o,t)},function(e){m(o,t,e)})})},remove:function(e,t){var n=e.dom();d(n,t),r.has(e,"style")&&""===s.trim(r.get(e,"style"))&&r.remove(e,"style")},get:function(e,t){var n=e.dom(),o=f.getComputedStyle(n).getPropertyValue(t),r=""!==o||i.inBody(e)?o:g(n,t);return null===r?void 0:r},getRaw:v,getAllRaw:function(e){var t={},n=e.dom();if(c.isSupported(n))for(var o=0;o<n.style.length;o++){var r=n.style.item(o);t[r]=n.style[r]}return t},isValidValue:function(e,t,n){var o=a.fromTag(e);h(o,t,n);return v(o,t).isSome()},reflow:function(e){return e.dom().offsetWidth},transfer:function(e,n,o){u.isElement(e)&&u.isElement(n)&&t.each(o,function(t){o=n,v(e,r=t).each(function(e){v(o,r).isNone()&&h(o,r,e)});var o,r})}}}),o("ephox.sugar.impl.Dimension",["ephox.katamari.api.Type","ephox.katamari.api.Arr","ephox.sugar.api.properties.Css","ephox.sugar.impl.Style"],function(e,t,n,o){return function(r,i){var a=function(e){var t=i(e);if(t<=0||null===t){var o=n.get(e,r);return parseFloat(o)||0}return t},u=function(e,o){return t.foldl(o,function(t,o){var r=n.get(e,o),i=void 0===r?0:parseInt(r,10);return isNaN(i)?t:t+i},0)};return{set:function(t,n){if(!e.isNumber(n)&&!n.match(/^[0-9]+$/))throw r+".set accepts only positive integer values. Value was "+n;var i=t.dom();o.isSupported(i)&&(i.style[r]=n+"px")},get:a,getOuter:a,aggregate:u,max:function(e,t,n){var o=u(e,n);return t>o?t-o:0}}}}),o("ephox.sugar.api.view.Height",["ephox.sugar.api.node.Body","ephox.sugar.api.properties.Css","ephox.sugar.impl.Dimension"],function(e,t,n){var o=n("height",function(t){return e.inBody(t)?t.dom().getBoundingClientRect().height:t.dom().offsetHeight});return{set:function(e,t){o.set(e,t)},get:function(e){return o.get(e)},getOuter:function(e){return o.getOuter(e)},setMax:function(e,n){var r=o.max(e,n,["margin-top","border-top-width","padding-top","padding-bottom","border-bottom-width","margin-bottom"]);t.set(e,"max-height",r+"px")}}}),o("ephox.alloy.keying.CyclicType",["ephox.alloy.alien.Keys","ephox.alloy.behaviour.common.NoState","ephox.alloy.data.Fields","ephox.alloy.keying.KeyingType","ephox.alloy.log.AlloyLogger","ephox.alloy.navigation.ArrNavigation","ephox.alloy.navigation.KeyMatch","ephox.alloy.navigation.KeyRules","ephox.boulder.api.FieldSchema","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.sugar.api.dom.Compare","ephox.sugar.api.dom.Focus","ephox.sugar.api.search.SelectorFilter","ephox.sugar.api.search.SelectorFind","ephox.sugar.api.view.Height"],function(e,t,n,o,r,i,a,u,c,s,l,p,f,m,d,h,g){var v=[c.defaulted("selector",'[data-alloy-tabstop="true"]'),c.option("onEscape"),c.option("onEnter"),c.defaulted("firstTabstop",0),c.defaulted("useTabstopAt",l.constant(!0)),c.option("visibilitySelector")],x=function(e,t){var n=e.visibilitySelector().bind(function(e){return h.closest(t,e)}).getOr(t);return g.get(n)>0},y=function(e,t,n,o){var r=d.descendants(e.element(),n.selector());return(i=e,a=n,m.search(i.element()).bind(function(e){return h.closest(e,a.selector())})).bind(function(t){return s.findIndex(r,l.curry(f.eq,t)).bind(function(t){return i=e,a=n,o(r,t,function(e){return x(a,e)&&a.useTabstopAt(e)}).fold(function(){return p.some(!0)},function(e){var t=i.getSystem(),n=i.element();return t.triggerFocus(e,n),p.some(!0)});var i,a})});var i,a},b=l.constant([u.rule(a.and([a.isShift,a.inSet(e.TAB())]),function(e,t,n,o){return y(e,0,n,i.cyclePrev)}),u.rule(a.inSet(e.TAB()),function(e,t,n,o){return y(e,0,n,i.cycleNext)}),u.rule(a.inSet(e.ESCAPE()),function(e,t,n,o){return n.onEscape().bind(function(n){return n(e,t)})}),u.rule(a.and([a.isNotShift,a.inSet(e.ENTER())]),function(e,t,n,o){return n.onEnter().bind(function(n){return n(e,t)})})]),k=l.constant({}),S=l.constant({});return o.typical(v,t.init,b,k,S,p.some(function(e,t,n){var o=d.descendants(e.element(),t.selector()),r=s.filter(o,function(e){return x(t,e)});p.from(r[t.firstTabstop()]).each(function(t){var n=e.element();e.getSystem().triggerFocus(t,n)})}))}),o("ephox.alloy.alien.EditableFields",["ephox.sugar.api.properties.Attr","ephox.sugar.api.node.Node"],function(e,t){return{inside:function(n){return"input"===t.name(n)&&"radio"!==e.get(n,"type")||"textarea"===t.name(n)}}}),o("ephox.alloy.keying.KeyingTypes",["ephox.alloy.alien.EditableFields","ephox.alloy.alien.Keys","ephox.alloy.api.events.AlloyTriggers","ephox.alloy.api.events.SystemEvents","ephox.alloy.navigation.KeyMatch","ephox.katamari.api.Option"],function(e,t,n,o,r,i){return{defaultExecute:function(a,u,c){return e.inside(c)&&r.inSet(t.SPACE())(u.event())?i.none():(s=a,l=c,n.dispatch(s,l,o.execute()),i.some(!0));var s,l}}}),o("ephox.alloy.keying.ExecutionType",["ephox.alloy.alien.EditableFields","ephox.alloy.alien.Keys","ephox.alloy.behaviour.common.NoState","ephox.alloy.keying.KeyingType","ephox.alloy.keying.KeyingTypes","ephox.alloy.log.AlloyLogger","ephox.alloy.navigation.KeyMatch","ephox.alloy.navigation.KeyRules","ephox.boulder.api.FieldSchema","ephox.katamari.api.Fun","ephox.katamari.api.Option"],function(e,t,n,o,r,i,a,u,c,s,l){var p=[c.defaulted("execute",r.defaultExecute),c.defaulted("useSpace",!1),c.defaulted("useEnter",!0),c.defaulted("useDown",!1)],f=function(e,t,n,o){return n.execute()(e,t,e.element())},m=s.constant({}),d=s.constant({});return o.typical(p,n.init,function(n,o,r,i){var c=r.useSpace()&&!e.inside(n.element())?t.SPACE():[],s=r.useEnter()?t.ENTER():[],l=r.useDown()?t.DOWN():[],p=c.concat(s).concat(l);return[u.rule(a.inSet(p),f)]},m,d,l.none())}),o("ephox.alloy.behaviour.keyboard.KeyingState",["ephox.alloy.behaviour.common.BehaviourState","ephox.katamari.api.Cell","ephox.katamari.api.Fun","ephox.katamari.api.Option"],function(e,t,n,o){return{flatgrid:function(r){var i=t(o.none());return e({readState:n.constant({}),setGridSize:function(e,t){i.set(o.some({numRows:n.constant(e),numColumns:n.constant(t)}))},getNumRows:function(){return i.get().map(function(e){return e.numRows()})},getNumColumns:function(){return i.get().map(function(e){return e.numColumns()})}})},init:function(e){return e.state()(e)}}}),o("ephox.sugar.api.properties.Direction",["ephox.sugar.api.properties.Css"],function(e){var t=function(t){return"rtl"===e.get(t,"direction")?"rtl":"ltr"};return{onDirection:function(e,n){return function(o){return"rtl"===t(o)?n:e}},getDirection:t}}),o("ephox.alloy.navigation.DomMovement",["ephox.sugar.api.properties.Direction"],function(e){var t=function(e){return function(t,n,r,i){var a=e(t.element());return o(a,t,n,r,i)}},n=function(e){return function(t,n,r,i){return o(e,t,n,r,i)}},o=function(e,t,n,o,r){return o.focusManager().get(t).bind(function(n){return e(t.element(),n,o,r)}).map(function(e){return o.focusManager().set(t,e),!0})};return{east:function(n,o){var r=e.onDirection(o,n);return t(r)},west:function(n,o){var r=e.onDirection(n,o);return t(r)},north:n,south:n,move:n}}),o("ephox.alloy.navigation.ArrPinpoint",["ephox.katamari.api.Arr","ephox.katamari.api.Struct"],function(e,t){var n=t.immutableBag(["index","candidates"],[]);return{locate:function(t,o){return e.findIndex(t,o).map(function(e){return n({index:e,candidates:t})})}}}),o("ephox.sugar.api.view.Visibility",["ephox.katamari.api.Fun","ephox.sugar.api.properties.Toggler","ephox.sugar.api.properties.Css"],function(e,t,n){var o=function(o,r,i,a){var u=n.get(o,r);void 0===u&&(u="");var c=u===i?a:i,s=e.curry(n.set,o,r,u),l=e.curry(n.set,o,r,c);return t(s,l,!1)};return{toggler:function(e){return o(e,"visibility","hidden","visible")},displayToggler:function(e,t){return o(e,"display","none",t)},isVisible:function(e){var t=e.dom();return!((n=t).offsetWidth<=0&&n.offsetHeight<=0);var n}}}),o("ephox.alloy.navigation.DomPinpoint",["ephox.alloy.navigation.ArrPinpoint","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.sugar.api.dom.Compare","ephox.sugar.api.search.SelectorFilter","ephox.sugar.api.view.Visibility"],function(e,t,n,o,r,i){var a=function(a,u,c,s){var l=n.curry(o.eq,u),p=r.descendants(a,c),f=t.filter(p,i.isVisible);return e.locate(f,l)};return{locateVisible:function(e,t,n){var o=i.isVisible;return a(e,t,n,o)},locateIn:a,findIndex:function(e,n){return t.findIndex(e,function(e){return o.eq(n,e)})}}}),o("ephox.alloy.navigation.WrapArrNavigation",["ephox.alloy.alien.Cycles","ephox.katamari.api.Fun","ephox.katamari.api.Option","global!Math"],function(e,t,n,o){var r=function(e,t,r,i){return i(o.floor(t/r),t%r).bind(function(t){var o=t.row()*r+t.column();return o>=0&&o<e.length?n.some(e[o]):n.none()})},i=function(o,i,a,u,c){return r(o,i,u,function(r,i){var s=r===a-1?o.length-r*u:u,l=e.cycleBy(i,c,0,s-1);return n.some({row:t.constant(r),column:t.constant(l)})})},a=function(o,i,a,u,c){return r(o,i,u,function(r,i){var s=e.cycleBy(r,c,0,a-1),l=s===a-1?o.length-s*u:u,p=e.cap(i,0,l-1);return n.some({row:t.constant(s),column:t.constant(p)})})};return{cycleDown:function(e,t,n,o){return a(e,t,n,o,1)},cycleUp:function(e,t,n,o){return a(e,t,n,o,-1)},cycleLeft:function(e,t,n,o){return i(e,t,n,o,-1)},cycleRight:function(e,t,n,o){return i(e,t,n,o,1)}}}),o("ephox.alloy.keying.FlatgridType",["ephox.alloy.alien.Keys","ephox.alloy.behaviour.keyboard.KeyingState","ephox.alloy.data.Fields","ephox.alloy.keying.KeyingType","ephox.alloy.keying.KeyingTypes","ephox.alloy.navigation.DomMovement","ephox.alloy.navigation.DomPinpoint","ephox.alloy.navigation.KeyMatch","ephox.alloy.navigation.KeyRules","ephox.alloy.navigation.WrapArrNavigation","ephox.boulder.api.FieldSchema","ephox.katamari.api.Cell","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.sugar.api.dom.Focus","ephox.sugar.api.search.SelectorFind"],function(e,t,n,o,r,i,a,u,c,s,l,p,f,m,d,h){var g=[l.strict("selector"),l.defaulted("execute",r.defaultExecute),n.onKeyboardHandler("onEscape"),l.defaulted("captureTab",!1),n.initSize()],v=function(e){return function(t,n,o,r){return a.locateVisible(t,n,o.selector()).bind(function(t){return e(t.candidates(),t.index(),r.getNumRows().getOr(o.initSize().numRows()),r.getNumColumns().getOr(o.initSize().numColumns()))})}},x=function(e,t,n,o){return n.captureTab()?m.some(!0):m.none()},y=v(s.cycleLeft),b=v(s.cycleRight),k=v(s.cycleUp),S=v(s.cycleDown),O=f.constant([c.rule(u.inSet(e.LEFT()),i.west(y,b)),c.rule(u.inSet(e.RIGHT()),i.east(y,b)),c.rule(u.inSet(e.UP()),i.north(k)),c.rule(u.inSet(e.DOWN()),i.south(S)),c.rule(u.and([u.isShift,u.inSet(e.TAB())]),x),c.rule(u.and([u.isNotShift,u.inSet(e.TAB())]),x),c.rule(u.inSet(e.ESCAPE()),function(e,t,n,o){return n.onEscape()(e,t)}),c.rule(u.inSet(e.SPACE().concat(e.ENTER())),function(e,t,n,o){return d.search(e.element(),n.selector()).bind(function(o){return n.execute()(e,t,o)})})]),T=f.constant({});return o.typical(g,t.flatgrid,O,T,{},m.some(function(e,t,n){h.descendant(e.element(),t.selector()).each(function(t){e.getSystem().triggerFocus(t,e.element())})}))}),o("ephox.alloy.navigation.DomNavigation",["ephox.alloy.alien.Cycles","ephox.alloy.navigation.DomPinpoint","ephox.katamari.api.Fun","ephox.katamari.api.Option"],function(e,t,n,o){return{horizontal:function(r,i,a,u){return t.locateVisible(r,a,i,n.constant(!0)).bind(function(t){var n=t.index(),r=t.candidates(),i=e.cycleBy(n,u,0,r.length-1);return o.from(r[i])})}}}),o("ephox.alloy.keying.FlowType",["ephox.alloy.alien.EditableFields","ephox.alloy.alien.Keys","ephox.alloy.behaviour.common.NoState","ephox.alloy.keying.KeyingType","ephox.alloy.keying.KeyingTypes","ephox.alloy.navigation.DomMovement","ephox.alloy.navigation.DomNavigation","ephox.alloy.navigation.KeyMatch","ephox.alloy.navigation.KeyRules","ephox.boulder.api.FieldSchema","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.sugar.api.dom.Focus","ephox.sugar.api.search.SelectorFind"],function(e,t,n,o,r,i,a,u,c,s,l,p,f,m){var d=[s.strict("selector"),s.defaulted("getInitial",p.none),s.defaulted("execute",r.defaultExecute),s.defaulted("executeOnMove",!1)],h=function(e,t,n){return f.search(e.element()).bind(function(o){return n.execute()(e,t,o)})},g=function(e,t,n){return a.horizontal(e,n.selector(),t,-1)},v=function(e,t,n){return a.horizontal(e,n.selector(),t,1)},x=function(e){return function(t,n,o){return e(t,n,o).bind(function(){return o.executeOnMove()?h(t,n,o):p.some(!0)})}},y=l.constant({}),b=l.constant({});return o.typical(d,n.init,function(e){return[c.rule(u.inSet(t.LEFT().concat(t.UP())),x(i.west(g,v))),c.rule(u.inSet(t.RIGHT().concat(t.DOWN())),x(i.east(g,v))),c.rule(u.inSet(t.ENTER()),h),c.rule(u.inSet(t.SPACE()),h)]},y,b,p.some(function(e,t){t.getInitial()(e).or(m.descendant(e.element(),t.selector())).each(function(t){e.getSystem().triggerFocus(t,e.element())})}))}),o("ephox.alloy.navigation.MatrixNavigation",["ephox.alloy.alien.Cycles","ephox.katamari.api.Option","ephox.katamari.api.Struct","global!Math"],function(e,t,n,o){var r=n.immutableBag(["rowIndex","columnIndex","cell"],[]),i=function(e,n,o){return t.from(e[n]).bind(function(e){return t.from(e[o]).map(function(e){return r({rowIndex:n,columnIndex:o,cell:e})})})},a=function(t,n,o,r){var a=t[n].length,u=e.cycleBy(o,r,0,a-1);return i(t,n,u)},u=function(t,n,o,r){var a=e.cycleBy(o,r,0,t.length-1),u=t[a].length,c=e.cap(n,0,u-1);return i(t,a,c)},c=function(t,n,o,r){var a=t[n].length,u=e.cap(o+r,0,a-1);return i(t,n,u)},s=function(t,n,o,r){var a=e.cap(o+r,0,t.length-1),u=t[a].length,c=e.cap(n,0,u-1);return i(t,a,c)};return{cycleRight:function(e,t,n){return a(e,t,n,1)},cycleLeft:function(e,t,n){return a(e,t,n,-1)},cycleUp:function(e,t,n){return u(e,n,t,-1)},cycleDown:function(e,t,n){return u(e,n,t,1)},moveLeft:function(e,t,n){return c(e,t,n,-1)},moveRight:function(e,t,n){return c(e,t,n,1)},moveUp:function(e,t,n){return s(e,n,t,-1)},moveDown:function(e,t,n){return s(e,n,t,1)}}}),o("ephox.alloy.keying.MatrixType",["ephox.alloy.alien.Keys","ephox.alloy.behaviour.common.NoState","ephox.alloy.keying.KeyingType","ephox.alloy.keying.KeyingTypes","ephox.alloy.navigation.DomMovement","ephox.alloy.navigation.DomPinpoint","ephox.alloy.navigation.KeyMatch","ephox.alloy.navigation.KeyRules","ephox.alloy.navigation.MatrixNavigation","ephox.boulder.api.FieldSchema","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.sugar.api.dom.Focus","ephox.sugar.api.search.SelectorFilter","ephox.sugar.api.search.SelectorFind"],function(e,t,n,o,r,i,a,u,c,s,l,p,f,m,d,h){var g=[s.strictObjOf("selectors",[s.strict("row"),s.strict("cell")]),s.defaulted("cycles",!0),s.defaulted("previousSelector",f.none),s.defaulted("execute",o.defaultExecute)],v=function(e,t){return function(n,o,r){var a=r.cycles()?e:t;return h.closest(o,r.selectors().row()).bind(function(e){var t=d.descendants(e,r.selectors().cell());return i.findIndex(t,o).bind(function(t){var o=d.descendants(n,r.selectors().row());return i.findIndex(o,e).bind(function(e){var n,i,u=(n=o,i=r,l.map(n,function(e){return d.descendants(e,i.selectors().cell())}));return a(u,e,t).map(function(e){return e.cell()})})})})}},x=v(c.cycleLeft,c.moveLeft),y=v(c.cycleRight,c.moveRight),b=v(c.cycleUp,c.moveUp),k=v(c.cycleDown,c.moveDown),S=p.constant([u.rule(a.inSet(e.LEFT()),r.west(x,y)),u.rule(a.inSet(e.RIGHT()),r.east(x,y)),u.rule(a.inSet(e.UP()),r.north(b)),u.rule(a.inSet(e.DOWN()),r.south(k)),u.rule(a.inSet(e.SPACE().concat(e.ENTER())),function(e,t,n){return m.search(e.element()).bind(function(o){return n.execute()(e,t,o)})})]),O=p.constant({}),T=p.constant({});return n.typical(g,t.init,S,O,T,f.some(function(e,t){t.previousSelector()(e).orThunk(function(){var n=t.selectors();return h.descendant(e.element(),n.cell())}).each(function(t){e.getSystem().triggerFocus(t,e.element())})}))}),o("ephox.alloy.keying.MenuType",["ephox.alloy.alien.Keys","ephox.alloy.behaviour.common.NoState","ephox.alloy.keying.KeyingType","ephox.alloy.keying.KeyingTypes","ephox.alloy.navigation.DomMovement","ephox.alloy.navigation.DomNavigation","ephox.alloy.navigation.KeyMatch","ephox.alloy.navigation.KeyRules","ephox.boulder.api.FieldSchema","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.sugar.api.dom.Focus","ephox.sugar.api.search.SelectorFind"],function(e,t,n,o,r,i,a,u,c,s,l,p,f){var m=[c.strict("selector"),c.defaulted("execute",o.defaultExecute),c.defaulted("moveOnTab",!1)],d=function(e,t,n){return n.focusManager().get(e).bind(function(o){return n.execute()(e,t,o)})},h=function(e,t,n){return i.horizontal(e,n.selector(),t,-1)},g=function(e,t,n){return i.horizontal(e,n.selector(),t,1)},v=s.constant([u.rule(a.inSet(e.UP()),r.move(h)),u.rule(a.inSet(e.DOWN()),r.move(g)),u.rule(a.and([a.isShift,a.inSet(e.TAB())]),function(e,t,n){return n.moveOnTab()?r.move(h)(e,t,n):l.none()}),u.rule(a.and([a.isNotShift,a.inSet(e.TAB())]),function(e,t,n){return n.moveOnTab()?r.move(g)(e,t,n):l.none()}),u.rule(a.inSet(e.ENTER()),d),u.rule(a.inSet(e.SPACE()),d)]),x=s.constant({}),y=s.constant({});return n.typical(m,t.init,v,x,y,l.some(function(e,t,n){f.descendant(e.element(),t.selector()).each(function(n){t.focusManager().set(e,n)})}))}),o("ephox.alloy.keying.SpecialType",["ephox.alloy.alien.Keys","ephox.alloy.behaviour.common.NoState","ephox.alloy.data.Fields","ephox.alloy.keying.KeyingType","ephox.alloy.navigation.KeyMatch","ephox.alloy.navigation.KeyRules","ephox.boulder.api.FieldSchema","ephox.katamari.api.Fun","ephox.katamari.api.Option"],function(e,t,n,o,r,i,a,u,c){var s=[n.onKeyboardHandler("onSpace"),n.onKeyboardHandler("onEnter"),n.onKeyboardHandler("onShiftEnter"),n.onKeyboardHandler("onLeft"),n.onKeyboardHandler("onRight"),n.onKeyboardHandler("onTab"),n.onKeyboardHandler("onShiftTab"),n.onKeyboardHandler("onUp"),n.onKeyboardHandler("onDown"),n.onKeyboardHandler("onEscape"),a.option("focusIn")],l=u.constant({}),p=u.constant({});return o.typical(s,t.init,function(t,n,o){return[i.rule(r.inSet(e.SPACE()),o.onSpace()),i.rule(r.and([r.isNotShift,r.inSet(e.ENTER())]),o.onEnter()),i.rule(r.and([r.isShift,r.inSet(e.ENTER())]),o.onShiftEnter()),i.rule(r.and([r.isShift,r.inSet(e.TAB())]),o.onShiftTab()),i.rule(r.and([r.isNotShift,r.inSet(e.TAB())]),o.onTab()),i.rule(r.inSet(e.UP()),o.onUp()),i.rule(r.inSet(e.DOWN()),o.onDown()),i.rule(r.inSet(e.LEFT()),o.onLeft()),i.rule(r.inSet(e.RIGHT()),o.onRight()),i.rule(r.inSet(e.SPACE()),o.onSpace()),i.rule(r.inSet(e.ESCAPE()),o.onEscape())]},l,p,c.some(function(e,t){return t.focusIn().bind(function(n){return n(e,t)})}))}),o("ephox.alloy.behaviour.keyboard.KeyboardBranches",["ephox.alloy.keying.CyclicType","ephox.alloy.keying.ExecutionType","ephox.alloy.keying.FlatgridType","ephox.alloy.keying.FlowType","ephox.alloy.keying.MatrixType","ephox.alloy.keying.MenuType","ephox.alloy.keying.SpecialType"],function(e,t,n,o,r,i,a){return{cyclic:e.schema(),flow:o.schema(),flatgrid:n.schema(),matrix:r.schema(),execution:t.schema(),menu:i.schema(),special:a.schema()}}),o("ephox.alloy.api.behaviour.Keying",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.behaviour.keyboard.KeyboardBranches","ephox.alloy.behaviour.keyboard.KeyingState","ephox.boulder.api.Objects","global!console"],function(e,t,n,o,r){return e.createModes({branchKey:"mode",branches:t,name:"keying",active:{events:function(e,t){return e.handler().toEvents(e,t)}},apis:{focusIn:function(e){e.getSystem().triggerFocus(e.element(),e.element())},setGridSize:function(e,t,n,i,a){o.hasKey(n,"setGridSize")?n.setGridSize(i,a):r.error("Layout does not support setGridSize")}},state:n})}),o("ephox.alloy.api.ui.GuiTypes",["ephox.alloy.debugging.FunctionAnnotator","ephox.boulder.api.Objects","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Id","global!Array"],function(e,t,n,o,r,i){var a=r.generate("alloy-premade"),u=r.generate("api");return{apiConfig:o.constant(u),makeApi:function(t){return e.markAsSketchApi(function(e){var n=i.prototype.slice.call(arguments,0),o=e.config(u);return t.apply(void 0,[o].concat(n))},t)},premade:function(e){return t.wrap(a,e)},getPremade:function(e){return t.readOptFrom(e,a)}}}),o("ephox.alloy.parts.PartType",["ephox.boulder.api.FieldPresence","ephox.boulder.api.FieldSchema","ephox.boulder.api.ValueSchema","ephox.katamari.api.Adt","ephox.katamari.api.Fun","ephox.katamari.api.Id","ephox.katamari.api.Option"],function(e,t,n,o,r,i,a){var u=o.generate([{required:["data"]},{external:["data"]},{optional:["data"]},{group:["data"]}]),c=t.defaulted("factory",{sketch:r.identity}),s=t.defaulted("schema",[]),l=t.strict("name"),p=t.field("pname","pname",e.defaultedThunk(function(e){return"<alloy."+i.generate(e.name)+">"}),n.anyValue()),f=t.defaulted("defaults",r.constant({})),m=t.defaulted("overrides",r.constant({})),d=n.objOf([c,s,l,p,f,m]),h=n.objOf([c,s,l,f,m]),g=n.objOf([c,s,l,p,f,m]),v=n.objOf([c,s,l,t.strict("unit"),p,f,m]),x=function(e,t){return function(o){var r=n.asStructOrDie("Converting part type",t,o);return e(r)}};return{required:x(u.required,d),external:x(u.external,h),optional:x(u.optional,g),group:x(u.group,v),asNamedPart:function(e){return e.fold(a.some,a.none,a.some,a.some)},name:function(e){var t=function(e){return e.name()};return e.fold(t,t,t,t)},asCommon:function(e){return e.fold(r.identity,r.identity,r.identity,r.identity)},original:r.constant("entirety")}}),o("ephox.alloy.spec.UiSubstitutes",["ephox.boulder.api.Objects","ephox.katamari.api.Arr","ephox.katamari.api.Obj","ephox.katamari.api.Merger","ephox.sand.api.JSON","ephox.katamari.api.Fun","ephox.katamari.api.Adt","global!Error"],function(e,t,n,o,r,i,a,u){var c=a.generate([{single:["required","valueThunk"]},{multiple:["required","valueThunks"]}]),s=function(t,o,a,s){return"placeholder"===a.uiType?(p=a,f=s,(l=t).exists(function(e){return e!==p.owner})?c.single(!0,i.constant(p)):e.readOptFrom(f,p.name).fold(function(){throw new u("Unknown placeholder component: "+p.name+"\nKnown: ["+n.keys(f)+"]\nNamespace: "+l.getOr("none")+"\nSpec: "+r.stringify(p,null,2))},function(e){return e.replace()})):c.single(!1,i.constant(a));var l,p,f},l=function(n,r,i,a){return s(n,0,i,a).fold(function(u,c){var s=c(r,i.config,i.validated),p=e.readOptFrom(s,"components").getOr([]),f=t.bind(p,function(e){return l(n,r,e,a)});return[o.deepMerge(s,{components:f})]},function(e,t){return t(r,i.config,i.validated)})},p=function(e,n,o,r){return t.bind(o,function(t){return l(e,n,t,r)})};return{single:c.single,multiple:c.multiple,isSubstitute:function(e){return t.contains(["placeholder"],e)},placeholder:i.constant("placeholder"),substituteAll:p,substitutePlaces:function(e,t,o,a){var c=n.map(a,function(e,t){return function(e,t){var n=!1;return{name:i.constant(e),required:function(){return t.fold(function(e,t){return e},function(e,t){return e})},used:function(){return n},replace:function(){if(!0===n)throw new u("Trying to use the same placeholder more than once: "+e);return n=!0,t}}}(t,e)}),s=p(e,t,o,c);return n.each(c,function(n){if(!1===n.used()&&n.required())throw new u("Placeholder: "+n.name()+" was not found in components list\nNamespace: "+e.getOr("none")+"\nComponents: "+r.stringify(t.components(),null,2))}),s},singleReplace:function(e,t){return t.fold(function(t,n){return[n(e)]},function(t,n){return n(e)})}}}),o("ephox.alloy.parts.PartSubstitutes",["ephox.alloy.parts.PartType","ephox.alloy.spec.UiSubstitutes","ephox.boulder.api.Objects","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Merger"],function(e,t,n,o,r,i){var a=function(e,t,o,r){var a=o;return i.deepMerge(t.defaults()(e,o,r),o,{uid:e.partUids()[t.name()]},t.overrides()(e,o,r),{"debug.sketcher":n.wrap("part-"+t.name(),a)})};return{subs:function(n,u,c){var s={},l={};return o.each(c,function(n){n.fold(function(e){s[e.pname()]=t.single(!0,function(t,n,o){return e.factory().sketch(a(t,e,n,o))})},function(t){var n=u.parts()[t.name()]();l[t.name()]=r.constant(a(u,t,n[e.original()]()))},function(e){s[e.pname()]=t.single(!1,function(t,n,o){return e.factory().sketch(a(t,e,n,o))})},function(e){s[e.pname()]=t.multiple(!0,function(t,n,r){var a=t[e.name()]();return o.map(a,function(n){return e.factory().sketch(i.deepMerge(e.defaults()(t,n),n,e.overrides()(t,n)))})})})}),{internals:r.constant(s),externals:r.constant(l)}}}}),o("ephox.alloy.parts.AlloyParts",["ephox.alloy.data.Fields","ephox.alloy.parts.PartSubstitutes","ephox.alloy.parts.PartType","ephox.alloy.spec.UiSubstitutes","ephox.boulder.api.FieldPresence","ephox.boulder.api.FieldSchema","ephox.boulder.api.Objects","ephox.boulder.api.ValueSchema","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Merger","ephox.katamari.api.Obj","ephox.katamari.api.Option"],function(e,t,n,o,r,i,a,u,c,s,l,p,f){var m=function(e,t){return{uiType:o.placeholder(),owner:e,name:t}},d=function(e){return c.map(e,n.name)},h=function(e,t,n){var o=t.partUids()[n];return e.getSystem().getByUid(o).toOption()},g=function(e,t){var n=d(t);return a.wrapAll(c.map(n,function(t){return{key:t,value:e+"-"+t}}))};return{generate:function(e,t){var o={};return c.each(t,function(t){n.asNamedPart(t).each(function(t){var n=m(e,t.pname());o[t.name()]=function(o){var r=u.asRawOrDie("Part: "+t.name()+" in "+e,u.objOf(t.schema()),o);return l.deepMerge(n,{config:o,validated:r})}})}),o},generateOne:function(e,t,n){return{uiType:o.placeholder(),owner:e,name:t,config:n,validated:{}}},schemas:function(t){return c.bind(t,function(t){return t.fold(f.none,f.some,f.none,f.none).map(function(t){return i.strictObjOf(t.name(),t.schema().concat([e.snapshot(n.original())]))}).toArray()})},names:d,substitutes:function(e,n,o){return t.subs(e,n,o)},components:function(e,t,n){return o.substitutePlaces(f.some(e),t,t.components(),n)},defaultUids:g,defaultUidsSchema:function(e){return i.field("partUids","partUids",r.mergeWithThunk(function(t){return g(t.uid,e)}),u.anyValue())},getAllParts:function(e,t){var n=e.getSystem();return p.map(t.partUids(),function(e,t){return s.constant(n.getByUid(e))})},getPart:h,getPartOrDie:function(e,t,n){return h(e,t,n).getOrDie("Could not find part: "+n)},getParts:function(e,t,n){var o={},r=t.partUids(),i=e.getSystem();return c.each(n,function(e){o[e]=i.getByUid(r[e])}),p.map(o,s.constant)},getPartsOrDie:function(e,t,n){var o={},r=t.partUids(),i=e.getSystem();return c.each(n,function(e){o[e]=i.getByUid(r[e]).getOrDie()}),p.map(o,s.constant)}}}),o("ephox.alloy.spec.SpecSchema",["ephox.alloy.data.Fields","ephox.alloy.spec.UiSubstitutes","ephox.boulder.api.FieldSchema","ephox.boulder.api.Objects","ephox.boulder.api.ValueSchema","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Merger","ephox.katamari.api.Obj","ephox.sand.api.JSON","global!Error"],function(e,t,n,o,r,i,a,u,c,s,l){var p=function(t,o,r,i){return(o.length>0?[n.strictObjOf("parts",o)]:[]).concat([n.strict("uid"),n.defaulted("dom",{}),n.defaulted("components",[]),e.snapshot("originalSpec"),n.defaulted("debug.sketcher",{})]).concat(r)};return{asRawOrDie:function(e,t,n,o){var i=p(0,o,n);return r.asRawOrDie(e+" [SpecSchema]",r.objOfOnly(i.concat(t)),n)},asStructOrDie:function(e,t,n,o,i){var a=p(0,o,i);return r.asStructOrDie(e+" [SpecSchema]",r.objOfOnly(a.concat(t)),n)},addBehaviours:function(e,t){return u.deepMerge(e,t)},getPartsSchema:function(r,a,u){var p=void 0!==u?u:"Unknown owner",f=function(){return[e.output("partUids",{})]},m=void 0!==a?a:f();if(0===r.length&&0===m.length)return f();return[n.strictObjOf("parts",i.flatten([i.map(r,n.strict),i.map(m,function(e){return n.defaulted(e,t.single(!1,function(){throw new l("The optional part: "+e+" was not specified in the config, but it was used in components")}))})])),n.state("partUids",function(e){if(!o.hasKey(e,"parts"))throw new l("Part uid definition for owner: "+p+' requires "parts"\nExpected parts: '+r.join(", ")+"\nSpec: "+s.stringify(e,null,2));return c.map(e.parts,function(t,n){return o.readOptFrom(t,"uid").getOrThunk(function(){return e.uid+"-"+n})})})]},extend:function(e,t,n){return e(u.deepMerge(t,n))}}}),o("ephox.alloy.api.ui.UiSketcher",["ephox.alloy.parts.AlloyParts","ephox.alloy.registry.Tagger","ephox.alloy.spec.SpecSchema","ephox.boulder.api.Objects","ephox.katamari.api.Merger"],function(e,t,n,o,r){var i=function(e){return r.deepMerge({uid:t.generate("uid")},e)};return{supplyUid:i,single:function(e,t,a,u){var c=i(u),s=n.asStructOrDie(e,t,c,[],[]);return r.deepMerge(a(s,c),{"debug.sketcher":o.wrap(e,u)})},composite:function(t,a,u,c,s){var l=i(s),p=e.schemas(u),f=e.defaultUidsSchema(u),m=n.asStructOrDie(t,a,l,p,[f]),d=e.substitutes(t,m,u),h=e.components(t,m,d.internals());return r.deepMerge(c(m,h,l,d.externals()),{"debug.sketcher":o.wrap(t,s)})}}}),o("ephox.alloy.api.ui.Sketcher",["ephox.alloy.api.ui.GuiTypes","ephox.alloy.api.ui.UiSketcher","ephox.alloy.debugging.FunctionAnnotator","ephox.alloy.parts.AlloyParts","ephox.alloy.parts.PartType","ephox.boulder.api.FieldSchema","ephox.boulder.api.ValueSchema","ephox.katamari.api.Fun","ephox.katamari.api.Merger","ephox.katamari.api.Obj"],function(e,t,n,o,r,i,a,u,c,s){var l=a.objOfOnly([i.strict("name"),i.strict("factory"),i.strict("configFields"),i.defaulted("apis",{}),i.defaulted("extraApis",{})]),p=a.objOfOnly([i.strict("name"),i.strict("factory"),i.strict("configFields"),i.strict("partFields"),i.defaulted("apis",{}),i.defaulted("extraApis",{})]);return{single:function(o){var r=a.asRawOrDie("Sketcher for "+o.name,l,o),i=s.map(r.apis,e.makeApi),p=s.map(r.extraApis,function(e,t){return n.markAsExtraApi(e,t)});return c.deepMerge({name:u.constant(r.name),partFields:u.constant([]),configFields:u.constant(r.configFields),sketch:function(e){return t.single(r.name,r.configFields,r.factory,e)}},i,p)},composite:function(r){var i=a.asRawOrDie("Sketcher for "+r.name,p,r),l=o.generate(i.name,i.partFields),f=s.map(i.apis,e.makeApi),m=s.map(i.extraApis,function(e,t){return n.markAsExtraApi(e,t)});return c.deepMerge({name:u.constant(i.name),partFields:u.constant(i.partFields),configFields:u.constant(i.configFields),sketch:function(e){return t.composite(i.name,i.configFields,i.partFields,i.factory,e)},parts:u.constant(l)},f,m)}}}),o("ephox.alloy.ui.common.ButtonBase",["ephox.alloy.api.events.AlloyEvents","ephox.alloy.api.events.AlloyTriggers","ephox.alloy.api.events.NativeEvents","ephox.alloy.api.events.SystemEvents","ephox.katamari.api.Arr","ephox.sand.api.PlatformDetection"],function(e,t,n,o,r,i){return{events:function(a){var u=function(e,n){n.stop(),t.emitExecute(e)},c=i.detect().deviceType.isTouch()?[e.run(o.tap(),u)]:[e.run(n.click(),u),e.run(n.mousedown(),function(e,t){t.cut()})];return e.derive(r.flatten([a.map(function(t){return e.run(o.execute(),function(e,n){t(e),n.stop()})}).toArray(),c]))}}}),o("ephox.alloy.api.ui.Button",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.api.behaviour.Focusing","ephox.alloy.api.behaviour.Keying","ephox.alloy.api.ui.Sketcher","ephox.alloy.ui.common.ButtonBase","ephox.boulder.api.FieldSchema","ephox.katamari.api.Merger"],function(e,t,n,o,r,i,a){return o.single({name:"Button",factory:function(o,i){var u=r.events(o.action());return{uid:o.uid(),dom:o.dom(),components:o.components(),events:u,behaviours:a.deepMerge(e.derive([t.config({}),n.config({mode:"execution",useSpace:!0,useEnter:!0})]),o.buttonBehaviours()),domModification:{attributes:{type:"button",role:o.role().getOr("button")}},eventOrder:o.eventOrder()}},configFields:[i.defaulted("uid",void 0),i.strict("dom"),i.defaulted("components",[]),i.defaulted("buttonBehaviours",{}),i.option("action"),i.option("role"),i.defaulted("eventOrder",{})]})}),o("ephox.alloy.api.component.DomFactory",["ephox.boulder.api.Objects","ephox.katamari.api.Arr","ephox.katamari.api.Merger","ephox.sugar.api.node.Element","ephox.sugar.api.node.Node","ephox.sugar.api.properties.Html","ephox.sugar.api.search.Traverse","global!Array"],function(e,t,n,o,r,i,a,u){var c=function(c){var s,l=o.fromHtml(c),p=a.children(l),f=function(o){var r=void 0!==o.dom().attributes?o.dom().attributes:[];return t.foldl(r,function(t,o){return"class"===o.name?t:n.deepMerge(t,e.wrap(o.name,o.value))},{})}(l),m=(s=l,u.prototype.slice.call(s.dom().classList,0)),d=0===p.length?{}:{innerHtml:i.get(l)};return n.deepMerge({tag:r.name(l),classes:m,attributes:f},d)};return{fromHtml:c,sketch:function(e,t,o){return e.sketch(n.deepMerge({dom:c(t)},o))}}}),o("tinymce.themes.mobile.util.UiDomFactory",["ephox.alloy.api.component.DomFactory","ephox.katamari.api.Strings","tinymce.themes.mobile.style.Styles"],function(e,t,n){var o=function(o){var r=t.supplant(o,{prefix:n.prefix()});return e.fromHtml(r)};return{dom:o,spec:function(e){return{dom:o(e)}}}}),o("tinymce.themes.mobile.ui.Buttons",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.api.behaviour.Toggling","ephox.alloy.api.behaviour.Unselecting","ephox.alloy.api.ui.Button","ephox.katamari.api.Merger","tinymce.themes.mobile.channels.Receivers","tinymce.themes.mobile.style.Styles","tinymce.themes.mobile.util.UiDomFactory"],function(e,t,n,o,r,i,a,u){var c=function(n){return e.derive([t.config({toggleClass:a.resolve("toolbar-button-selected"),toggleOnExecute:!1,aria:{mode:"pressed"}}),i.format(n,function(e,n){(n?t.on:t.off)(e)})])},s=function(t,i,a){return o.sketch({dom:u.dom('<span class="${prefix}-toolbar-button ${prefix}-icon-'+t+' ${prefix}-icon"></span>'),action:i,buttonBehaviours:r.deepMerge(e.derive([n.config({})]),a)})};return{forToolbar:s,forToolbarCommand:function(e,t){return s(t,function(){e.execCommand(t)},{})},forToolbarStateAction:function(e,t,n,o){var r=c(n);return s(t,o,r)},forToolbarStateCommand:function(e,t){var n=c(t);return s(t,function(){e.execCommand(t)},n)}}}),o("ephox.alloy.ui.slider.SliderModel",["global!Math"],function(e){var t=function(t,n,o){return e.max(n,e.min(o,t))};return{reduceBy:function(t,n,o,r){return t<n?t:t>o?o:t===n?n-1:e.max(n,t-r)},increaseBy:function(t,n,o,r){return t>o?t:t<n?n:t===o?o+1:e.min(o,t+r)},findValueOfX:function(n,o,r,i,a,u,c){var s=r-o;if(i<n.left)return o-1;if(i>n.right)return r+1;var l=e.min(n.right,e.max(i,n.left))-n.left,p=t(l/n.width*s+o,o-1,r+1),f=e.round(p);return u&&p>=o&&p<=r?(m=p,d=o,h=r,g=a,c.fold(function(){var n=m-d,o=e.round(n/g)*g;return t(d+o,d-1,h+1)},function(t){var n=(m-t)%g,o=e.round(n/g),r=e.floor((m-t)/g),i=e.floor((h-t)/g),a=t+e.min(i,r+o)*g;return e.max(t,a)})):f;var m,d,h,g}}}),o("ephox.alloy.ui.slider.SliderActions",["ephox.alloy.api.events.AlloyTriggers","ephox.alloy.ui.slider.SliderModel","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.sand.api.PlatformDetection","global!Math"],function(e,t,n,o,r,i){var a=r.detect().deviceType.isTouch(),u=function(e){return function(e){var t=e.event().raw();return a&&void 0!==t.touches&&1===t.touches.length?o.some(t.touches[0]):a&&void 0!==t.touches?o.none():a||void 0===t.clientX?o.none():o.some(t)}(e).map(function(e){return e.clientX})},c=function(t,n){e.emitWith(t,"slider.change.value",{value:n})};return{setXFromEvent:function(e,n,o,r){return u(r).map(function(r){return function(e,n,o,r){var i=t.findValueOfX(n,o.min(),o.max(),r,o.stepSize(),o.snapToGrid(),o.snapStart());c(e,i)}(e,o,n,r),r})},setToLedge:function(e,t){c(e,t.min()-1,o.none())},setToRedge:function(e,t){c(e,t.max()+1,o.none())},moveLeftFromRedge:function(e,t){c(e,t.max(),o.none())},moveRightFromLedge:function(e,t){c(e,t.min(),o.none())},moveLeft:function(e,n){var r=t.reduceBy(n.value().get(),n.min(),n.max(),n.stepSize());c(e,r,o.none())},moveRight:function(e,n){var r=t.increaseBy(n.value().get(),n.min(),n.max(),n.stepSize());c(e,r,o.none())},changeEvent:n.constant("slider.change.value")}}),o("ephox.alloy.ui.slider.SliderParts",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.api.behaviour.Focusing","ephox.alloy.api.behaviour.Keying","ephox.alloy.api.events.AlloyEvents","ephox.alloy.api.events.NativeEvents","ephox.alloy.parts.PartType","ephox.alloy.ui.slider.SliderActions","ephox.boulder.api.FieldSchema","ephox.katamari.api.Cell","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.sand.api.PlatformDetection"],function(e,t,n,o,r,i,a,u,c,s,l,p){var f=p.detect().deviceType.isTouch(),m=function(e,t){return i.optional({name:e+"-edge",overrides:function(e){var n=o.derive([o.runActionExtra(r.touchstart(),t,[e])]),i=o.derive([o.runActionExtra(r.mousedown(),t,[e]),o.runActionExtra(r.mousemove(),function(e,n){n.mouseIsDown().get()&&t(e,n)},[e])]);return{events:f?n:i}}})};return[m("left",a.setToLedge),m("right",a.setToRedge),i.required({name:"thumb",defaults:s.constant({dom:{styles:{position:"absolute"}}}),overrides:function(e){return{events:o.derive([o.redirectToPart(r.touchstart(),e,"spectrum"),o.redirectToPart(r.touchmove(),e,"spectrum"),o.redirectToPart(r.touchend(),e,"spectrum")])}}}),i.required({schema:[u.state("mouseIsDown",function(){return c(!1)})],name:"spectrum",overrides:function(i){var u=function(e,t){var n=e.element().dom().getBoundingClientRect();a.setXFromEvent(e,i,n,t)},c=o.derive([o.run(r.touchstart(),u),o.run(r.touchmove(),u)]),s=o.derive([o.run(r.mousedown(),u),o.run(r.mousemove(),function(e,t){i.mouseIsDown().get()&&u(e,t)})]);return{behaviours:e.derive(f?[]:[n.config({mode:"special",onLeft:function(e){return a.moveLeft(e,i),l.some(!0)},onRight:function(e){return a.moveRight(e,i),l.some(!0)}}),t.config({})]),events:f?c:s}}})]}),o("ephox.alloy.ui.slider.SliderSchema",["ephox.boulder.api.FieldSchema","ephox.katamari.api.Cell","ephox.katamari.api.Fun","ephox.sand.api.PlatformDetection"],function(e,t,n,o){var r=o.detect().deviceType.isTouch();return[e.strict("min"),e.strict("max"),e.defaulted("stepSize",1),e.defaulted("onChange",n.noop),e.defaulted("onInit",n.noop),e.defaulted("onDragStart",n.noop),e.defaulted("onDragEnd",n.noop),e.defaulted("snapToGrid",!1),e.option("snapStart"),e.strict("getInitialValue"),e.defaulted("sliderBehaviours",{}),e.state("value",function(e){return t(e.min)})].concat(r?[]:[e.state("mouseIsDown",function(){return t(!1)})])}),o("ephox.alloy.behaviour.representing.RepresentApis",[],function(){return{onLoad:function(e,t,n){t.store().manager().onLoad(e,t,n)},onUnload:function(e,t,n){t.store().manager().onUnload(e,t,n)},setValue:function(e,t,n,o){t.store().manager().setValue(e,t,n,o)},getValue:function(e,t,n){return t.store().manager().getValue(e,t,n)}}}),o("ephox.alloy.behaviour.representing.ActiveRepresenting",["ephox.alloy.api.events.AlloyEvents","ephox.alloy.behaviour.common.Behaviour","ephox.alloy.behaviour.representing.RepresentApis"],function(e,t,n){return{events:function(o,r){var i=o.resetOnDom()?[e.runOnAttached(function(e,t){n.onLoad(e,o,r)}),e.runOnDetached(function(e,t){n.onUnload(e,o,r)})]:[t.loadEvent(o,r,n.onLoad)];return e.derive(i)}}}),o("ephox.alloy.behaviour.representing.RepresentState",["ephox.alloy.behaviour.common.BehaviourState","ephox.katamari.api.Cell"],function(e,t){return{memory:function(){var n=t(null);return e({set:n.set,get:n.get,isNotSet:function(){return null===n.get()},clear:function(){n.set(null)},readState:function(){return{mode:"memory",value:n.get()}}})},dataset:function(){var n=t({});return e({readState:function(){return{mode:"dataset",dataset:n.get()}},set:n.set,get:n.get})},manual:function(){return e({readState:function(){}})},init:function(e){return e.store().manager().state(e)}}}),o("ephox.alloy.behaviour.representing.DatasetStore",["ephox.alloy.behaviour.representing.RepresentState","ephox.alloy.data.Fields","ephox.boulder.api.FieldSchema","ephox.boulder.api.Objects","ephox.katamari.api.Fun"],function(e,t,n,o,r){var i=function(e,t,n,o){t.store().getDataKey();n.set({}),t.store().setData()(e,o),t.onSetValue()(e,o)};return[n.option("initialValue"),n.strict("getFallbackEntry"),n.strict("getDataKey"),n.strict("setData"),t.output("manager",{setValue:i,getValue:function(e,t,n){var r=t.store().getDataKey()(e),i=n.get();return o.readOptFrom(i,r).fold(function(){return t.store().getFallbackEntry()(r)},function(e){return e})},onLoad:function(e,t,n){t.store().initialValue().each(function(o){i(e,t,n,o)})},onUnload:function(e,t,n){n.set({})},state:e.dataset})]}),o("ephox.alloy.behaviour.representing.ManualStore",["ephox.alloy.behaviour.common.NoState","ephox.alloy.data.Fields","ephox.boulder.api.FieldSchema","ephox.katamari.api.Fun"],function(e,t,n,o){return[n.strict("getValue"),n.defaulted("setValue",o.noop),n.option("initialValue"),t.output("manager",{setValue:function(e,t,n,o){t.store().setValue()(e,o),t.onSetValue()(e,o)},getValue:function(e,t,n){return t.store().getValue()(e)},onLoad:function(e,t,n){t.store().initialValue().each(function(n){t.store().setValue()(e,n)})},onUnload:o.noop,state:e.init})]}),o("ephox.alloy.behaviour.representing.MemoryStore",["ephox.alloy.behaviour.representing.RepresentState","ephox.alloy.data.Fields","ephox.boulder.api.FieldSchema"],function(e,t,n){return[n.option("initialValue"),t.output("manager",{setValue:function(e,t,n,o){n.set(o),t.onSetValue()(e,o)},getValue:function(e,t,n){return n.get()},onLoad:function(e,t,n){t.store().initialValue().each(function(e){n.isNotSet()&&n.set(e)})},onUnload:function(e,t,n){n.clear()},state:e.memory})]}),o("ephox.alloy.behaviour.representing.RepresentSchema",["ephox.alloy.behaviour.representing.DatasetStore","ephox.alloy.behaviour.representing.ManualStore","ephox.alloy.behaviour.representing.MemoryStore","ephox.alloy.data.Fields","ephox.boulder.api.FieldSchema","ephox.boulder.api.ValueSchema"],function(e,t,n,o,r,i){return[r.defaultedOf("store",{mode:"memory"},i.choose("mode",{memory:n,manual:t,dataset:e})),o.onHandler("onSetValue"),r.defaulted("resetOnDom",!1)]}),o("ephox.alloy.api.behaviour.Representing",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.behaviour.representing.ActiveRepresenting","ephox.alloy.behaviour.representing.RepresentApis","ephox.alloy.behaviour.representing.RepresentSchema","ephox.alloy.behaviour.representing.RepresentState"],function(e,t,n,o,r){var i=e.create({fields:o,name:"representing",active:t,apis:n,extra:{setValueFrom:function(e,t){var n=i.getValue(t);i.setValue(e,n)}},state:r});return i}),o("ephox.sugar.api.view.Width",["ephox.sugar.api.properties.Css","ephox.sugar.impl.Dimension"],function(e,t){var n=t("width",function(e){return e.dom().offsetWidth});return{set:function(e,t){n.set(e,t)},get:function(e){return n.get(e)},getOuter:function(e){return n.getOuter(e)},setMax:function(t,o){var r=n.max(t,o,["margin-left","border-left-width","padding-left","padding-right","border-right-width","margin-right"]);e.set(t,"max-width",r+"px")}}}),o("ephox.alloy.ui.slider.SliderUi",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.api.behaviour.Keying","ephox.alloy.api.behaviour.Representing","ephox.alloy.api.events.AlloyEvents","ephox.alloy.api.events.NativeEvents","ephox.alloy.parts.AlloyParts","ephox.alloy.ui.slider.SliderActions","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Merger","ephox.katamari.api.Option","ephox.sand.api.PlatformDetection","ephox.sugar.api.properties.Css","ephox.sugar.api.view.Width"],function(e,t,n,o,r,i,a,u,c,s,l,p,f,m){var d=p.detect().deviceType.isTouch();return{sketch:function(p,h,g,v){var x=p.max()-p.min(),y=function(e){var t=e.element().dom().getBoundingClientRect();return(t.left+t.right)/2},b=function(e){return i.getPartOrDie(e,p,"thumb")},k=function(e){var t=i.getPartOrDie(e,p,"spectrum").element().dom().getBoundingClientRect(),n=e.element().dom().getBoundingClientRect(),o=function(e,t,n){var o=n.value().get();return o<n.min()?i.getPart(e,n,"left-edge").fold(function(){return 0},function(e){return y(e)-t.left}):o>n.max()?i.getPart(e,n,"right-edge").fold(function(){return t.width},function(e){return y(e)-t.left}):(n.value().get()-n.min())/x*t.width}(e,t,p);return t.left-n.left+o},S=function(e){var t=k(e),n=b(e),o=m.get(n.element())/2;f.set(n.element(),"left",t-o+"px")},O=function(e,t){var n=p.value().get(),o=b(e);return n!==t||f.getRaw(o.element(),"left").isNone()?(p.value().set(t),S(e),p.onChange()(e,o,t),l.some(!0)):l.none()},T=d?[o.run(r.touchstart(),function(e,t){p.onDragStart()(e,b(e))}),o.run(r.touchend(),function(e,t){p.onDragEnd()(e,b(e))})]:[o.run(r.mousedown(),function(e,t){t.stop(),p.onDragStart()(e,b(e)),p.mouseIsDown().set(!0)}),o.run(r.mouseup(),function(e,t){p.onDragEnd()(e,b(e)),p.mouseIsDown().set(!1)})];return{uid:p.uid(),dom:p.dom(),components:h,behaviours:s.deepMerge(e.derive(u.flatten([d?[]:[t.config({mode:"special",focusIn:function(e){return i.getPart(e,p,"spectrum").map(t.focusIn).map(c.constant(!0))}})],[n.config({store:{mode:"manual",getValue:function(e){return p.value().get()}}})]])),p.sliderBehaviours()),events:o.derive([o.run(a.changeEvent(),function(e,t){O(e,t.event().value())}),o.runOnAttached(function(e,t){p.value().set(p.getInitialValue()());var n=b(e);S(e),p.onInit()(e,n,p.value().get())})].concat(T)),apis:{resetToMin:function(e){O(e,p.min(),l.none())},resetToMax:function(e){O(e,p.max(),l.none())},refresh:S},domModification:{styles:{position:"relative"}}}}}}),o("ephox.alloy.api.ui.Slider",["ephox.alloy.api.ui.Sketcher","ephox.alloy.ui.slider.SliderParts","ephox.alloy.ui.slider.SliderSchema","ephox.alloy.ui.slider.SliderUi","global!Math"],function(e,t,n,o,r){return e.composite({name:"Slider",configFields:n,partFields:t,factory:o.sketch,apis:{resetToMin:function(e,t){e.resetToMin(t)},resetToMax:function(e,t){e.resetToMax(t)},refresh:function(e,t){e.refresh(t)}}})}),o("tinymce.themes.mobile.ui.ToolbarWidgets",["tinymce.themes.mobile.ui.Buttons"],function(e){return{button:function(t,n,o){return e.forToolbar(n,function(){var e=o();t.setContextToolbar([{label:n+" group",items:e}])},{})}}}),o("tinymce.themes.mobile.ui.ColorSlider",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.api.behaviour.Receiving","ephox.alloy.api.behaviour.Toggling","ephox.alloy.api.ui.Slider","ephox.sugar.api.properties.Css","tinymce.themes.mobile.channels.Receivers","tinymce.themes.mobile.style.Styles","tinymce.themes.mobile.ui.ToolbarWidgets","tinymce.themes.mobile.util.UiDomFactory"],function(e,t,n,o,r,i,a,u,c){var s=function(t){return[function(t){var u=function(e){return e<0?"black":e>360?"white":"hsl("+e+", 100%, 50%)"};return o.sketch({dom:c.dom('<div class="${prefix}-slider ${prefix}-hue-slider-container"></div>'),components:[o.parts()["left-edge"](c.spec('<div class="${prefix}-hue-slider-black"></div>')),o.parts().spectrum({dom:c.dom('<div class="${prefix}-slider-gradient-container"></div>'),components:[c.spec('<div class="${prefix}-slider-gradient"></div>')],behaviours:e.derive([n.config({toggleClass:a.resolve("thumb-active")})])}),o.parts()["right-edge"](c.spec('<div class="${prefix}-hue-slider-white"></div>')),o.parts().thumb({dom:c.dom('<div class="${prefix}-slider-thumb"></div>'),behaviours:e.derive([n.config({toggleClass:a.resolve("thumb-active")})])})],onChange:function(e,n,o){var i=u(o);r.set(n.element(),"background-color",i),t.onChange(e,n,i)},onDragStart:function(e,t){n.on(t)},onDragEnd:function(e,t){n.off(t)},onInit:function(e,t,n){var o=u(n);r.set(t.element(),"background-color",o)},stepSize:10,min:0,max:360,getInitialValue:t.getInitialValue,sliderBehaviours:e.derive([i.orientation(o.refresh)])})}(t)]};return{makeItems:s,sketch:function(e,t){var n={onChange:function(e,n,o){t.undoManager.transact(function(){t.formatter.apply("forecolor",{value:o}),t.nodeChanged()})},getInitialValue:function(){return-1}};return u.button(e,"color",function(){return s(n)})}}}),o("tinymce.themes.mobile.ui.SizeSlider",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.api.behaviour.Receiving","ephox.alloy.api.behaviour.Toggling","ephox.alloy.api.ui.Slider","ephox.boulder.api.FieldSchema","ephox.boulder.api.ValueSchema","tinymce.themes.mobile.channels.Receivers","tinymce.themes.mobile.style.Styles","tinymce.themes.mobile.util.UiDomFactory"],function(e,t,n,o,r,i,a,u,c){var s=i.objOfOnly([r.strict("getInitialValue"),r.strict("onChange"),r.strict("category"),r.strict("sizes")]);return{sketch:function(t){var r=i.asRawOrDie("SizeSlider",s,t);return o.sketch({dom:{tag:"div",classes:[u.resolve("slider-"+r.category+"-size-container"),u.resolve("slider"),u.resolve("slider-size-container")]},onChange:function(e,t,n){(o=n)>=0&&o<r.sizes.length&&r.onChange(n);var o},onDragStart:function(e,t){n.on(t)},onDragEnd:function(e,t){n.off(t)},min:0,max:r.sizes.length-1,stepSize:1,getInitialValue:r.getInitialValue,snapToGrid:!0,sliderBehaviours:e.derive([a.orientation(o.refresh)]),components:[o.parts().spectrum({dom:c.dom('<div class="${prefix}-slider-size-container"></div>'),components:[c.spec('<div class="${prefix}-slider-size-line"></div>')]}),o.parts().thumb({dom:c.dom('<div class="${prefix}-slider-thumb"></div>'),behaviours:e.derive([n.config({toggleClass:u.resolve("thumb-active")})])})]})}}}),o("ephox.sugar.api.search.TransformFind",["ephox.katamari.api.Type","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.sugar.api.node.Element"],function(e,t,n,o){var r=function(r,i,a){for(var u=r.dom(),c=e.isFunction(a)?a:t.constant(!1);u.parentNode;){u=u.parentNode;var s=o.fromDom(u),l=i(s);if(l.isSome())return l;if(c(s))break}return n.none()};return{ancestor:r,closest:function(e,t,o){return t(e).orThunk(function(){return o(e)?n.none():r(e,t,o)})}}}),o("tinymce.themes.mobile.util.FontSizes",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.sugar.api.dom.Compare","ephox.sugar.api.node.Element","ephox.sugar.api.node.Node","ephox.sugar.api.properties.Css","ephox.sugar.api.search.TransformFind","ephox.sugar.api.search.Traverse"],function(e,t,n,o,r,i,a,u,c){var s=["9px","10px","11px","12px","14px","16px","18px","20px","24px","32px","36px"],l=function(t){var l,p,f=t.selection.getStart(),m=r.fromDom(f),d=r.fromDom(t.getBody()),h=(l=function(e){return o.eq(d,e)},p=m,(i.isElement(p)?n.some(p):c.parent(p)).map(function(e){return u.closest(e,function(e){return a.getRaw(e,"font-size")},l).getOrThunk(function(){return a.get(e,"font-size")})}).getOr(""));return e.find(s,function(e){return h===e}).getOr("medium")};return{candidates:t.constant(s),get:function(t){var n=l(t);return(o=n,e.findIndex(s,function(e){return e===o})).getOr(2);var o},apply:function(e,t){(o=t,n.from(s[o])).each(function(t){o=t,l(n=e)!==o&&n.execCommand("fontSize",!1,o);var n,o});var o}}}),o("tinymce.themes.mobile.ui.FontSizeSlider",["tinymce.themes.mobile.ui.SizeSlider","tinymce.themes.mobile.ui.ToolbarWidgets","tinymce.themes.mobile.util.FontSizes","tinymce.themes.mobile.util.UiDomFactory"],function(e,t,n,o){var r=n.candidates(),i=function(t){return[o.spec('<span class="${prefix}-toolbar-button ${prefix}-icon-small-font ${prefix}-icon"></span>'),(n=t,e.sketch({onChange:n.onChange,sizes:r,category:"font",getInitialValue:n.getInitialValue})),o.spec('<span class="${prefix}-toolbar-button ${prefix}-icon-large-font ${prefix}-icon"></span>')];var n};return{makeItems:i,sketch:function(e,o){var r={onChange:function(e){n.apply(o,e)},getInitialValue:function(){return n.get(o)}};return t.button(e,"font-size",function(){return i(r)})}}}),o("ephox.imagetools.util.Canvas",[],function(){function e(e,t){return n(document.createElement("canvas"),e,t)}function t(e){return e.getContext("2d")}function n(e,t,n){return e.width=t,e.height=n,e}return{create:e,clone:function(n){var o;return t(o=e(n.width,n.height)).drawImage(n,0,0),o},resize:n,get2dContext:t,get3dContext:function(e){var t=null;try{t=e.getContext("webgl")||e.getContext("experimental-webgl")}catch(e){}return t||(t=null),t}}}),o("ephox.imagetools.util.ImageSize",[],function(){return{getWidth:function(e){return e.naturalWidth||e.width},getHeight:function(e){return e.naturalHeight||e.height}}}),o("ephox.imagetools.util.Promise",[],function(){if(window.Promise)return window.Promise;var e=o.immediateFn||"function"==typeof setImmediate&&setImmediate||function(e){setTimeout(e,1)};function t(e,t){return function(){e.apply(t,arguments)}}var n=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function o(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],c(e,t(i,this),t(a,this))}function r(t){var n=this;null!==this._state?e(function(){var e=n._state?t.onFulfilled:t.onRejected;if(null!==e){var o;try{o=e(n._value)}catch(e){return void t.reject(e)}t.resolve(o)}else(n._state?t.resolve:t.reject)(n._value)}):this._deferreds.push(t)}function i(e){try{if(e===this)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void c(t(n,e),t(i,this),t(a,this))}this._state=!0,this._value=e,u.call(this)}catch(e){a.call(this,e)}}function a(e){this._state=!1,this._value=e,u.call(this)}function u(){for(var e=0,t=this._deferreds.length;e<t;e++)r.call(this,this._deferreds[e]);this._deferreds=null}function c(e,t,n){var o=!1;try{e(function(e){o||(o=!0,t(e))},function(e){o||(o=!0,n(e))})}catch(e){if(o)return;o=!0,n(e)}}return o.prototype.catch=function(e){return this.then(null,e)},o.prototype.then=function(e,t){var n=this;return new o(function(o,i){r.call(n,new function(e,t,n,o){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=o}(e,t,o,i))})},o.all=function(){var e=Array.prototype.slice.call(1===arguments.length&&n(arguments[0])?arguments[0]:arguments);return new o(function(t,n){if(0===e.length)return t([]);var o=e.length;function r(i,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var u=a.then;if("function"==typeof u)return void u.call(a,function(e){r(i,e)},n)}e[i]=a,0==--o&&t(e)}catch(e){n(e)}}for(var i=0;i<e.length;i++)r(i,e[i])})},o.resolve=function(e){return e&&"object"==typeof e&&e.constructor===o?e:new o(function(t){t(e)})},o.reject=function(e){return new o(function(t,n){n(e)})},o.race=function(e){return new o(function(t,n){for(var o=0,r=e.length;o<r;o++)e[o].then(t,n)})},o}),o("ephox.sand.api.Blob",["ephox.sand.util.Global"],function(e){return function(t,n){return new(e.getOrDie("Blob"))(t,n)}}),o("ephox.sand.api.FileReader",["ephox.sand.util.Global"],function(e){return function(){return new(e.getOrDie("FileReader"))}}),o("ephox.sand.api.Uint8Array",["ephox.sand.util.Global"],function(e){return function(t){return new(e.getOrDie("Uint8Array"))(t)}}),o("ephox.sand.api.Window",["ephox.sand.util.Global"],function(e){return{atob:function(t){return e.getOrDie("atob")(t)},requestAnimationFrame:function(t){e.getOrDie("requestAnimationFrame")(t)}}}),o("ephox.imagetools.util.Conversions",["ephox.imagetools.util.Canvas","ephox.imagetools.util.ImageSize","ephox.imagetools.util.Promise","ephox.katamari.api.Option","ephox.sand.api.Blob","ephox.sand.api.FileReader","ephox.sand.api.Uint8Array","ephox.sand.api.Window","global!Array","global!Math"],function(e,t,n,o,r,i,a,u,c,s){function l(e){return new n(function(t,n){var o=URL.createObjectURL(e),r=new Image,i=function(){r.removeEventListener("load",a),r.removeEventListener("error",u)};function a(){i(),t(r)}function u(){i(),n("Unable to load data of type "+e.type+": "+o)}r.addEventListener("load",a),r.addEventListener("error",u),r.src=o,r.complete&&a()})}function p(e){return new n(function(t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=function(){200==this.status&&t(this.response)},n.send()})}function f(e){var t=e.split(","),n=/data:([^;]+)/.exec(t[0]);if(!n)return o.none();for(var i=n[1],l=t[1],p=u.atob(l),f=p.length,m=s.ceil(f/1024),d=new c(m),h=0;h<m;++h){for(var g=1024*h,v=s.min(g+1024,f),x=new c(v-g),y=g,b=0;y<v;++b,++y)x[b]=p[y].charCodeAt(0);d[h]=a(x)}return o.some(r(d,{type:i}))}function m(e){return new n(function(t,n){f(e).fold(function(){n("uri is not base64: "+e)},t)})}function d(e){return new n(function(t){var n=new i;n.onloadend=function(){t(n.result)},n.readAsDataURL(e)})}return{blobToImage:l,imageToBlob:function(e){return(t=e,new n(function(e){function n(){t.removeEventListener("load",n),e(t)}t.complete?e(t):t.addEventListener("load",n)})).then(function(e){var t=e.src;return 0===t.indexOf("blob:")?p(t):0===t.indexOf("data:")?m(t):p(t)});var t},blobToDataUri:d,blobToBase64:function(e){return d(e).then(function(e){return e.split(",")[1]})},dataUriToBlobSync:f,canvasToBlob:function(e,t,o){return t=t||"image/png",HTMLCanvasElement.prototype.toBlob?new n(function(n){e.toBlob(function(e){n(e)},t,o)}):m(e.toDataURL(t,o))},canvasToDataURL:function(e,t,n){return t=t||"image/png",e.then(function(e){return e.toDataURL(t,n)})},blobToCanvas:function(n){return l(n).then(function(n){o=n,URL.revokeObjectURL(o.src);var o,r;return r=e.create(t.getWidth(n),t.getHeight(n)),e.get2dContext(r).drawImage(n,0,0),r})},uriToBlob:function(e){return 0===e.indexOf("blob:")?p(e):0===e.indexOf("data:")?m(e):null}}}),o("ephox.imagetools.api.BlobConversions",["ephox.imagetools.util.Conversions","ephox.katamari.api.Option"],function(e,t){return{blobToImage:function(t){return e.blobToImage(t)},imageToBlob:function(t){return e.imageToBlob(t)},blobToDataUri:function(t){return e.blobToDataUri(t)},blobToBase64:function(t){return e.blobToBase64(t)},dataUriToBlobSync:function(t){return e.dataUriToBlobSync(t)},uriToBlob:function(n){return t.from(e.uriToBlob(n))}}}),o("tinymce.themes.mobile.ui.ImagePicker",["ephox.alloy.api.component.Memento","ephox.alloy.api.events.AlloyEvents","ephox.alloy.api.events.NativeEvents","ephox.alloy.api.ui.Button","ephox.imagetools.api.BlobConversions","ephox.katamari.api.Id","ephox.katamari.api.Option","tinymce.themes.mobile.util.UiDomFactory"],function(e,t,n,o,r,i,a,u){return{sketch:function(c){var s=e.record({dom:{tag:"input",attributes:{accept:"image/*",type:"file",title:""},styles:{visibility:"hidden",position:"absolute"}},events:t.derive([t.cutter(n.click()),t.run(n.change(),function(e,t){(function(e){var t=e.event(),n=t.raw().target.files||t.raw().dataTransfer.files;return a.from(n[0])})(t).each(function(e){t=c,n=e,r.blobToBase64(n).then(function(e){t.undoManager.transact(function(){var o=t.editorUpload.blobCache,r=o.create(i.generate("mceu"),n,e);o.add(r);var a=t.dom.createHTML("img",{src:r.blobUri()});t.insertContent(a)})});var t,n})})])});return o.sketch({dom:u.dom('<span class="${prefix}-toolbar-button ${prefix}-icon-image ${prefix}-icon"></span>'),components:[s.asSpec()],action:function(e){s.get(e).element().dom().click()}})}}}),o("ephox.sugar.api.properties.TextContent",[],function(){return{get:function(e){return e.dom().textContent},set:function(e,t){e.dom().textContent=t}}}),o("tinymce.themes.mobile.bridge.LinkBridge",["ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.sugar.api.node.Element","ephox.sugar.api.properties.Attr","ephox.sugar.api.properties.TextContent","ephox.sugar.api.search.SelectorFind"],function(e,t,n,o,r,i){var a=function(e){return e.length>0},u=function(e){return void 0===e||null===e?"":e},c=function(e,n,i){return i.text.filter(a).fold(function(){return i=e,o.get(i,"href")===r.get(i)?t.some(n):t.none();var i},t.some)},s=function(e){var t=n.fromDom(e.selection.getStart());return i.closest(t,"a")};return{getInfo:function(e){return s(e).fold(function(){return{url:"",text:e.selection.getContent({format:"text"}),title:"",target:"",link:t.none()}},function(e){return function(e){var n=r.get(e),i=o.get(e,"href"),a=o.get(e,"title"),c=o.get(e,"target");return{url:u(i),text:n!==i?u(n):"",title:u(a),target:u(c),link:t.some(e)}}(e)})},applyInfo:function(t,n){n.url.filter(a).fold(function(){o=t,n.link.bind(e.identity).each(function(e){o.execCommand("unlink")});var o},function(i){var u=function(e,t){var n={};return n.href=e,t.title.filter(a).each(function(e){n.title=e}),t.target.filter(a).each(function(e){n.target=e}),n}(i,n);n.link.bind(e.identity).fold(function(){var e=n.text.filter(a).getOr(i);t.insertContent(t.dom.createHTML("a",u,t.dom.encode(e)))},function(e){var t=c(e,i,n);o.setAll(e,u),t.each(function(t){r.set(e,t)})})})},query:s}}),o("ephox.alloy.api.behaviour.AddEventsBehaviour",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.api.events.AlloyEvents","ephox.boulder.api.FieldSchema","ephox.katamari.api.Fun"],function(e,t,n,o){var r=function(r,i){var a=t.derive(i);return e.create({fields:[n.strict("enabled")],name:r,active:{events:o.constant(a)}})};return{events:r,config:function(t,n){return{key:t,value:{config:{},me:r(t,n),configAsRaw:o.constant({}),initialConfig:{},state:e.noState()}}}}}),o("ephox.alloy.behaviour.composing.ComposeApis",[],function(){return{getCurrent:function(e,t,n){return t.find()(e)}}}),o("ephox.alloy.behaviour.composing.ComposeSchema",["ephox.boulder.api.FieldSchema"],function(e){return[e.strict("find")]}),o("ephox.alloy.api.behaviour.Composing",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.behaviour.composing.ComposeApis","ephox.alloy.behaviour.composing.ComposeSchema"],function(e,t,n){return e.create({fields:n,name:"composing",apis:t})}),o("ephox.alloy.api.ui.Container",["ephox.alloy.api.ui.Sketcher","ephox.boulder.api.FieldSchema","ephox.katamari.api.Merger"],function(e,t,n){return e.single({name:"Container",factory:function(e,t){return{uid:e.uid(),dom:n.deepMerge({tag:"div",attributes:{role:"presentation"}},e.dom()),components:e.components(),behaviours:e.containerBehaviours(),events:e.events(),domModification:e.domModification(),eventOrder:e.eventOrder()}},configFields:[t.defaulted("components",[]),t.defaulted("containerBehaviours",{}),t.defaulted("events",{}),t.defaulted("domModification",{}),t.defaulted("eventOrder",{})]})}),o("ephox.alloy.api.ui.DataField",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.api.behaviour.Composing","ephox.alloy.api.behaviour.Representing","ephox.alloy.api.events.AlloyEvents","ephox.alloy.api.ui.Sketcher","ephox.boulder.api.FieldSchema","ephox.katamari.api.Option"],function(e,t,n,o,r,i,a){return r.single({name:"DataField",factory:function(r,i){return{uid:r.uid(),dom:r.dom(),behaviours:e.derive([n.config({store:{mode:"memory",initialValue:r.getInitialValue()()}}),t.config({find:a.some})]),events:o.derive([o.runOnAttached(function(e,t){n.setValue(e,r.getInitialValue()())})])}},configFields:[i.strict("uid"),i.strict("dom"),i.strict("getInitialValue")]})}),o("ephox.alloy.behaviour.tabstopping.ActiveTabstopping",["ephox.alloy.dom.DomModification","ephox.boulder.api.Objects"],function(e,t){return{exhibit:function(n,o){return e.nu({attributes:t.wrapAll([{key:o.tabAttr(),value:"true"}])})}}}),o("ephox.alloy.behaviour.tabstopping.TabstopSchema",["ephox.boulder.api.FieldSchema"],function(e){return[e.defaulted("tabAttr","data-alloy-tabstop")]}),o("ephox.alloy.api.behaviour.Tabstopping",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.behaviour.tabstopping.ActiveTabstopping","ephox.alloy.behaviour.tabstopping.TabstopSchema"],function(e,t,n){return e.create({fields:n,name:"tabstopping",active:t})}),o("ephox.sugar.api.properties.Value",["global!Error"],function(e){return{set:function(t,n){if(void 0===n)throw new e("Value.set was undefined");t.dom().value=n},get:function(e){return e.dom().value}}}),o("ephox.alloy.ui.common.InputBase",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.api.behaviour.Focusing","ephox.alloy.api.behaviour.Representing","ephox.alloy.api.behaviour.Tabstopping","ephox.alloy.data.Fields","ephox.boulder.api.FieldSchema","ephox.boulder.api.Objects","ephox.katamari.api.Fun","ephox.katamari.api.Merger","ephox.sugar.api.properties.Value"],function(e,t,n,o,r,i,a,u,c,s){var l=[i.option("data"),i.defaulted("inputAttributes",{}),i.defaulted("inputStyles",{}),i.defaulted("type","input"),i.defaulted("tag","input"),r.onHandler("onSetValue"),i.defaulted("styles",{}),i.option("placeholder"),i.defaulted("eventOrder",{}),i.defaulted("hasTabstop",!0),i.defaulted("inputBehaviours",{}),i.defaulted("selectOnFocus",!0)];return{schema:u.constant(l),behaviours:function(r){return c.deepMerge(e.derive([n.config({store:{mode:"manual",initialValue:r.data().getOr(void 0),getValue:function(e){return s.get(e.element())},setValue:function(e,t){s.get(e.element())!==t&&s.set(e.element(),t)}},onSetValue:r.onSetValue()}),t.config({onFocus:!1===r.selectOnFocus()?u.noop:function(e){var t=e.element(),n=s.get(t);t.dom().setSelectionRange(0,n.length)}}),r.hasTabstop()?o.config({}):o.revoke()]),r.inputBehaviours())},dom:function(e){return{tag:e.tag(),attributes:c.deepMerge(a.wrapAll([{key:"type",value:e.type()}].concat(e.placeholder().map(function(e){return{key:"placeholder",value:e}}).toArray())),e.inputAttributes()),styles:e.inputStyles()}}}}),o("ephox.alloy.api.ui.Input",["ephox.alloy.api.ui.Sketcher","ephox.alloy.ui.common.InputBase"],function(e,t){return e.single({name:"Input",configFields:t.schema(),factory:function(e,n){return{uid:e.uid(),dom:t.dom(e),components:[],behaviours:t.behaviours(e),eventOrder:e.eventOrder()}}})}),o("tinymce.themes.mobile.ui.Inputs",["ephox.alloy.api.behaviour.AddEventsBehaviour","ephox.alloy.api.behaviour.Behaviour","ephox.alloy.api.behaviour.Composing","ephox.alloy.api.behaviour.Representing","ephox.alloy.api.behaviour.Toggling","ephox.alloy.api.component.Memento","ephox.alloy.api.events.AlloyEvents","ephox.alloy.api.events.AlloyTriggers","ephox.alloy.api.events.NativeEvents","ephox.alloy.api.ui.Button","ephox.alloy.api.ui.Container","ephox.alloy.api.ui.DataField","ephox.alloy.api.ui.Input","ephox.katamari.api.Option","tinymce.themes.mobile.style.Styles","tinymce.themes.mobile.util.UiDomFactory"],function(e,t,n,o,r,i,a,u,c,s,l,p,f,m,d,h){return{field:function(p,g){var v=i.record(f.sketch({placeholder:g,onSetValue:function(e,t){u.emit(e,c.input())},inputBehaviours:t.derive([n.config({find:m.some})]),selectOnFocus:!1})),x=i.record(s.sketch({dom:h.dom('<button class="${prefix}-input-container-x ${prefix}-icon-cancel-circle ${prefix}-icon"></button>'),action:function(e){var t=v.get(e);o.setValue(t,"")}}));return{name:p,spec:l.sketch({dom:h.dom('<div class="${prefix}-input-container"></div>'),components:[v.asSpec(),x.asSpec()],containerBehaviours:t.derive([r.config({toggleClass:d.resolve("input-container-empty")}),n.config({find:function(e){return m.some(v.get(e))}}),e.config("input-clearing",[a.run(c.input(),function(e){var t=v.get(e);(o.getValue(t).length>0?r.off:r.on)(e)})])])})}},hidden:function(e){return{name:e,spec:p.sketch({dom:{tag:"span",styles:{display:"none"}},getInitialValue:function(){return m.none()}})}}}}),o("ephox.alloy.behaviour.disabling.DisableApis",["ephox.katamari.api.Arr","ephox.sugar.api.properties.Attr","ephox.sugar.api.properties.Class","ephox.sugar.api.node.Node"],function(e,t,n,o){var r=["input","button","textarea"],i=function(t){return e.contains(r,o.name(t.element()))},a=function(e){t.set(e.element(),"disabled","disabled")},u=function(e){t.remove(e.element(),"disabled")},c=function(e){t.set(e.element(),"aria-disabled","true")},s=function(e){t.set(e.element(),"aria-disabled","false")},l=function(e,t,o){t.disableClass().each(function(t){n.add(e.element(),t)});(i(e)?a:c)(e)};return{enable:function(e,t,o){t.disableClass().each(function(t){n.remove(e.element(),t)});(i(e)?u:s)(e)},disable:l,isDisabled:function(e){return i(e)?(o=e,t.has(o.element(),"disabled")):(n=e,"true"===t.get(n.element(),"aria-disabled"));var n,o},onLoad:function(e,t,n){t.disabled()&&l(e,t,n)}}}),o("ephox.alloy.behaviour.disabling.ActiveDisable",["ephox.alloy.api.events.AlloyEvents","ephox.alloy.api.events.SystemEvents","ephox.alloy.behaviour.common.Behaviour","ephox.alloy.behaviour.disabling.DisableApis","ephox.alloy.dom.DomModification","ephox.katamari.api.Arr"],function(e,t,n,o,r,i){return{exhibit:function(e,t,n){return r.nu({classes:t.disabled()?t.disableClass().map(i.pure).getOr([]):[]})},events:function(r,i){return e.derive([e.abort(t.execute(),function(e,t){return o.isDisabled(e,r,i)}),n.loadEvent(r,i,o.onLoad)])}}}),o("ephox.alloy.behaviour.disabling.DisableSchema",["ephox.boulder.api.FieldSchema"],function(e){return[e.defaulted("disabled",!1),e.option("disableClass")]}),o("ephox.alloy.api.behaviour.Disabling",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.behaviour.disabling.ActiveDisable","ephox.alloy.behaviour.disabling.DisableApis","ephox.alloy.behaviour.disabling.DisableSchema"],function(e,t,n,o){return e.create({fields:o,name:"disabling",active:t,apis:n})}),o("ephox.alloy.api.ui.Form",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.api.behaviour.Composing","ephox.alloy.api.behaviour.Representing","ephox.alloy.api.ui.UiSketcher","ephox.alloy.parts.AlloyParts","ephox.alloy.parts.PartType","ephox.boulder.api.FieldSchema","ephox.katamari.api.Arr","ephox.katamari.api.Merger","ephox.katamari.api.Obj"],function(e,t,n,o,r,i,a,u,c,s){var l=[a.defaulted("formBehaviours",{})],p=function(e){return"<alloy.field."+e+">"},f=function(o,i,a){return c.deepMerge({"debug.sketcher":{Form:a},uid:o.uid(),dom:o.dom(),components:i,behaviours:c.deepMerge(e.derive([n.config({store:{mode:"manual",getValue:function(e){var i=r.getAllParts(e,o);return s.map(i,function(e,o){return e().bind(t.getCurrent).map(n.getValue)})},setValue:function(e,i){s.each(i,function(i,a){r.getPart(e,o,a).each(function(e){t.getCurrent(e).each(function(e){n.setValue(e,i)})})})}}})]),o.formBehaviours())})};return{sketch:function(e){var t=function(){var e=[];return{field:function(t,n){return e.push(t),r.generateOne("form",p(t),n)},record:function(){return e}}}(),n=e(t),a=t.record(),c=u.map(a,function(e){return i.required({name:e,pname:p(e)})});return o.composite("form",l,c,f,n)}}}),o("ephox.katamari.api.Singleton",["ephox.katamari.api.Option","ephox.katamari.api.Cell"],function(e,t){var n=function(n){var o=t(e.none()),r=function(){o.get().each(n)};return{clear:function(){r(),o.set(e.none())},isSet:function(){return o.get().isSome()},set:function(t){r(),o.set(e.some(t))}}};return{destroyable:function(){return n(function(e){e.destroy()})},unbindable:function(){return n(function(e){e.unbind()})},api:function(){var n=t(e.none()),o=function(){n.get().each(function(e){e.destroy()})};return{clear:function(){o(),n.set(e.none())},isSet:function(){return n.get().isSome()},set:function(t){o(),n.set(e.some(t))},run:function(e){n.get().each(e)}}},value:function(){var n=t(e.none());return{clear:function(){n.set(e.none())},set:function(t){n.set(e.some(t))},isSet:function(){return n.get().isSome()},on:function(e){n.get().each(e)}}}}}),o("tinymce.themes.mobile.model.SwipingModel",[],function(){return{init:function(e){return{xValue:e,points:[]}},move:function(e,t){if(t===e.xValue)return e;var n=t-e.xValue>0?1:-1,o={direction:n,xValue:t};return{xValue:t,points:(0===e.points.length?[]:e.points[e.points.length-1].direction===n?e.points.slice(0,e.points.length-1):e.points).concat([o])}},complete:function(e){if(0===e.points.length)return 0;var t=e.points[0].direction,n=e.points[e.points.length-1].direction;return-1===t&&-1===n?-1:1===t&&1==n?1:0}}}),o("tinymce.themes.mobile.ui.SerialisedDialog",["ephox.alloy.api.behaviour.AddEventsBehaviour","ephox.alloy.api.behaviour.Behaviour","ephox.alloy.api.behaviour.Disabling","ephox.alloy.api.behaviour.Highlighting","ephox.alloy.api.behaviour.Keying","ephox.alloy.api.behaviour.Receiving","ephox.alloy.api.behaviour.Representing","ephox.alloy.api.component.Memento","ephox.alloy.api.events.AlloyEvents","ephox.alloy.api.events.AlloyTriggers","ephox.alloy.api.events.NativeEvents","ephox.alloy.api.ui.Button","ephox.alloy.api.ui.Container","ephox.alloy.api.ui.Form","ephox.boulder.api.FieldSchema","ephox.boulder.api.ValueSchema","ephox.katamari.api.Arr","ephox.katamari.api.Cell","ephox.katamari.api.Option","ephox.katamari.api.Singleton","ephox.sugar.api.properties.Css","ephox.sugar.api.search.SelectorFilter","ephox.sugar.api.search.SelectorFind","ephox.sugar.api.view.Width","tinymce.themes.mobile.channels.Receivers","tinymce.themes.mobile.model.SwipingModel","tinymce.themes.mobile.style.Styles","tinymce.themes.mobile.util.UiDomFactory"],function(e,t,n,o,r,i,a,u,c,s,l,p,f,m,d,h,g,v,x,y,b,k,S,O,T,w,E,A){return{sketch:function(i){var C=h.objOf([d.strict("fields"),d.defaulted("maxFieldIndex",i.fields.length-1),d.strict("onExecute"),d.strict("getInitialValue"),d.state("state",function(){return{dialogSwipeState:y.value(),currentScreen:v(0)}})]),F=h.asRawOrDie("SerialisedDialog",C,i),D=function(e,o,r){return p.sketch({dom:A.dom('<span class="${prefix}-icon-'+o+' ${prefix}-icon"></span>'),action:function(t){s.emitWith(t,"navigateEvent",{direction:e})},buttonBehaviours:t.derive([n.config({disableClass:E.resolve("toolbar-navigation-disabled"),disabled:!r})])})},R=function(e,t){var n=k.descendants(e.element(),"."+E.resolve("serialised-dialog-screen"));S.descendant(e.element(),"."+E.resolve("serialised-dialog-chain")).each(function(e){F.state.currentScreen.get()+t>=0&&F.state.currentScreen.get()+t<n.length&&(b.getRaw(e,"left").each(function(o){var r=parseInt(o,10),i=O.get(n[0]);b.set(e,"left",r-t*i+"px")}),F.state.currentScreen.set(F.state.currentScreen.get()+t))})},M=function(e){var t=k.descendants(e.element(),"input");x.from(t[F.state.currentScreen.get()]).each(function(t){e.getSystem().getByDom(t).each(function(t){s.dispatchFocus(e,t.element())})});var n=I.get(e);o.highlightAt(n,F.state.currentScreen.get())},B=u.record(m.sketch(function(n){return{dom:A.dom('<div class="${prefix}-serialised-dialog"></div>'),components:[f.sketch({dom:A.dom('<div class="${prefix}-serialised-dialog-chain" style="left: 0px; position: absolute;"></div>'),components:g.map(F.fields,function(e,t){return t<=F.maxFieldIndex?f.sketch({dom:A.dom('<div class="${prefix}-serialised-dialog-screen"></div>'),components:g.flatten([[D(-1,"previous",t>0)],[n.field(e.name,e.spec)],[D(1,"next",t<F.maxFieldIndex)]])}):n.field(e.name,e.spec)})})],formBehaviours:t.derive([T.orientation(function(e,t){n=e,o=t,S.descendant(n.element(),"."+E.resolve("serialised-dialog-chain")).each(function(e){b.set(e,"left",-F.state.currentScreen.get()*o.width+"px")});var n,o}),r.config({mode:"special",focusIn:function(e){M(e)},onTab:function(e){return R(e,1),x.some(!0)},onShiftTab:function(e){return R(e,-1),x.some(!0)}}),e.config("form-events",[c.runOnAttached(function(e,t){F.state.currentScreen.set(0),F.state.dialogSwipeState.clear();var n=I.get(e);o.highlightFirst(n),F.getInitialValue(e).each(function(t){a.setValue(e,t)})}),c.runOnExecute(F.onExecute),c.run(l.transitionend(),function(e,t){"left"===t.event().raw().propertyName&&M(e)}),c.run("navigateEvent",function(e,t){var n=t.event().direction();R(e,n)})])])}})),I=u.record({dom:A.dom('<div class="${prefix}-dot-container"></div>'),behaviours:t.derive([o.config({highlightClass:E.resolve("dot-active"),itemClass:E.resolve("dot-item")})]),components:g.bind(F.fields,function(e,t){return t<=F.maxFieldIndex?[A.spec('<div class="${prefix}-dot-item ${prefix}-icon-full-dot ${prefix}-icon"></div>')]:[]})});return{dom:A.dom('<div class="${prefix}-serializer-wrapper"></div>'),components:[B.asSpec(),I.asSpec()],behaviours:t.derive([r.config({mode:"special",focusIn:function(e){var t=B.get(e);r.focusIn(t)}}),e.config("serializer-wrapper-events",[c.run(l.touchstart(),function(e,t){F.state.dialogSwipeState.set(w.init(t.event().raw().touches[0].clientX))}),c.run(l.touchmove(),function(e,t){F.state.dialogSwipeState.on(function(e){t.event().prevent(),F.state.dialogSwipeState.set(w.move(e,t.event().raw().touches[0].clientX))})}),c.run(l.touchend(),function(e){F.state.dialogSwipeState.on(function(t){var n=B.get(e),o=-1*w.complete(t);R(n,o)})})])])}}}}),o("tinymce.themes.mobile.util.RangePreserver",["ephox.katamari.api.Fun","ephox.sand.api.PlatformDetection"],function(e,t){var n=t.detect(),o=function(e,t){var n=t.selection.getRng();e(),t.selection.setRng(n)};return{forAndroid:function(t,r){(n.os.isAndroid()?o:e.apply)(r,t)}}}),o("tinymce.themes.mobile.ui.LinkButton",["ephox.alloy.api.behaviour.Representing","ephox.katamari.api.Option","ephox.katamari.api.Thunk","tinymce.themes.mobile.bridge.LinkBridge","tinymce.themes.mobile.ui.Buttons","tinymce.themes.mobile.ui.Inputs","tinymce.themes.mobile.ui.SerialisedDialog","tinymce.themes.mobile.util.RangePreserver"],function(e,t,n,o,r,i,a,u){var c=n.cached(function(n,r){return[{label:"the link group",items:[a.sketch({fields:[i.field("url","Type or paste URL"),i.field("text","Link text"),i.field("title","Link title"),i.field("target","Link target"),i.hidden("link")],maxFieldIndex:["url","text","title","target"].length-1,getInitialValue:function(){return t.some(o.getInfo(r))},onExecute:function(t){var i=e.getValue(t);o.applyInfo(r,i),n.restoreToolbar(),r.focus()}})]}]});return{sketch:function(e,t){return r.forToolbarStateAction(t,"link","link",function(){var n=c(e,t);e.setContextToolbar(n),u.forAndroid(t,function(){e.focusToolbar()}),o.query(t).each(function(e){t.selection.select(e.dom())})})}}}),o("tinymce.themes.mobile.features.DefaultStyleFormats",[],function(){return[{title:"Headings",items:[{title:"Heading 1",format:"h1"},{title:"Heading 2",format:"h2"},{title:"Heading 3",format:"h3"},{title:"Heading 4",format:"h4"},{title:"Heading 5",format:"h5"},{title:"Heading 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},{title:"Underline",icon:"underline",format:"underline"},{title:"Strikethrough",icon:"strikethrough",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"},{title:"Code",icon:"code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Alignment",items:[{title:"Left",icon:"alignleft",format:"alignleft"},{title:"Center",icon:"aligncenter",format:"aligncenter"},{title:"Right",icon:"alignright",format:"alignright"},{title:"Justify",icon:"alignjustify",format:"alignjustify"}]}]}),o("ephox.alloy.behaviour.transitioning.TransitionApis",["ephox.boulder.api.Objects","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.sugar.api.properties.Attr","ephox.sugar.api.properties.Class"],function(e,t,n,o,r){var i=function(n,o,r,i){return e.readOptFrom(o.routes(),i.start()).map(t.apply).bind(function(n){return e.readOptFrom(n,i.destination()).map(t.apply)})},a=function(e,n,o,r){return i(0,n,0,r).bind(function(e){return e.transition().map(function(n){return{transition:t.constant(n),route:t.constant(e)}})})},u=function(e,t,n){(i=e,u=t,s=n,c(i,u,s).bind(function(e){return a(i,u,s,e)})).each(function(n){var i=n.transition();r.remove(e.element(),i.transitionClass()),o.remove(e.element(),t.destinationAttr())});var i,u,s},c=function(e,r,i){var a=e.element();return o.has(a,r.destinationAttr())?n.some({start:t.constant(o.get(e.element(),r.stateAttr())),destination:t.constant(o.get(e.element(),r.destinationAttr()))}):n.none()},s=function(e,t,n,r){u(e,t,n),o.has(e.element(),t.stateAttr())&&o.get(e.element(),t.stateAttr())!==r&&t.onFinish()(e,r),o.set(e.element(),t.stateAttr(),r)};return{findRoute:i,disableTransition:u,getCurrentRoute:c,jumpTo:s,progressTo:function(e,n,i,c){l=e,p=n,o.has(l.element(),p.destinationAttr())&&(o.set(l.element(),p.stateAttr(),o.get(l.element(),p.destinationAttr())),o.remove(l.element(),p.destinationAttr()));var l,p,f,m,d,h=(f=e,m=n,d=c,{start:t.constant(o.get(f.element(),m.stateAttr())),destination:t.constant(d)});a(e,n,i,h).fold(function(){s(e,n,i,c)},function(t){u(e,n,i);var a=t.transition();r.add(e.element(),a.transitionClass()),o.set(e.element(),n.destinationAttr(),c)})},getState:function(e,t,r){var i=e.element();return o.has(i,t.stateAttr())?n.some(o.get(i,t.stateAttr())):n.none()}}}),o("ephox.alloy.behaviour.transitioning.ActiveTransitioning",["ephox.alloy.api.events.AlloyEvents","ephox.alloy.api.events.NativeEvents","ephox.alloy.behaviour.transitioning.TransitionApis"],function(e,t,n){return{events:function(o,r){return e.derive([e.run(t.transitionend(),function(e,t){var i=t.event().raw();n.getCurrentRoute(e,o,r).each(function(t){n.findRoute(e,o,r,t).each(function(a){a.transition().each(function(a){i.propertyName===a.property()&&(n.jumpTo(e,o,r,t.destination()),o.onTransition()(e,t))})})})}),e.runOnAttached(function(e,t){n.jumpTo(e,o,r,o.initialState())})])}}}),o("ephox.alloy.behaviour.transitioning.TransitionSchema",["ephox.alloy.data.Fields","ephox.boulder.api.FieldSchema","ephox.boulder.api.ValueSchema","ephox.katamari.api.Result"],function(e,t,n,o){return[t.defaulted("destinationAttr","data-transitioning-destination"),t.defaulted("stateAttr","data-transitioning-state"),t.strict("initialState"),e.onHandler("onTransition"),e.onHandler("onFinish"),t.strictOf("routes",n.setOf(o.value,n.setOf(o.value,n.objOfOnly([t.optionObjOfOnly("transition",[t.strict("property"),t.strict("transitionClass")])]))))]}),o("ephox.alloy.api.behaviour.Transitioning",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.behaviour.transitioning.ActiveTransitioning","ephox.alloy.behaviour.transitioning.TransitionApis","ephox.alloy.behaviour.transitioning.TransitionSchema","ephox.boulder.api.Objects","ephox.katamari.api.Obj"],function(e,t,n,o,r,i){return e.create({fields:o,name:"transitioning",active:t,apis:n,extra:{createRoutes:function(e){var t={};return i.each(e,function(e,n){var o=n.split("<->");t[o[0]]=r.wrap(o[1],e),t[o[1]]=r.wrap(o[0],e)}),t},createBistate:function(e,t,n){return r.wrapAll([{key:e,value:r.wrap(t,n)},{key:t,value:r.wrap(e,n)}])},createTristate:function(e,t,n,o){return r.wrapAll([{key:e,value:r.wrapAll([{key:t,value:o},{key:n,value:o}])},{key:t,value:r.wrapAll([{key:e,value:o},{key:n,value:o}])},{key:n,value:r.wrapAll([{key:e,value:o},{key:t,value:o}])}])}}})}),o("ephox.alloy.behaviour.common.BehaviourBlob",["ephox.alloy.behaviour.common.NoState","ephox.boulder.api.FieldPresence","ephox.boulder.api.FieldSchema","ephox.boulder.api.ValueSchema","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Obj","ephox.sand.api.JSON","global!Error"],function(e,t,n,o,r,i,a,u,c){return{generateFrom:function(s,l){var p=r.map(l,function(r){return n.field(r.name(),r.name(),t.asOption(),o.objOf([n.strict("config"),n.defaulted("state",e)]))}),f=o.asStruct("component.behaviours",o.objOf(p),s.behaviours).fold(function(e){throw new c(o.formatError(e)+"\nComplete spec:\n"+u.stringify(s,null,2))},i.identity);return{list:l,data:a.map(f,function(e){var t=e();return i.constant(t.map(function(e){return{config:e.config(),state:e.state().init(e.config())}}))})}},getBehaviours:function(e){return e.list},getData:function(e){return e.data}}}),o("ephox.alloy.api.component.CompBehaviours",["ephox.alloy.behaviour.common.BehaviourBlob","ephox.boulder.api.Objects","ephox.katamari.api.Arr","ephox.katamari.api.Obj","global!Error"],function(e,t,n,o,r){var i=function(t,n){return e.generateFrom(t,n)};return{generate:function(e){var r=function(e){var r=t.readOptFrom(e,"behaviours").getOr({}),i=n.filter(o.keys(r),function(e){return void 0!==r[e]});return n.map(i,function(t){return e.behaviours[t].me})}(e);return i(e,r)},generateFrom:i}}),o("ephox.alloy.api.component.ComponentApi",["ephox.katamari.api.Contracts"],function(e){return e.exactly(["getSystem","config","spec","connect","disconnect","element","syncComponents","readState","components","events"])}),o("ephox.alloy.api.system.SystemApi",["ephox.katamari.api.Contracts"],function(e){return e.exactly(["debugInfo","triggerFocus","triggerEvent","triggerEscape","addToWorld","removeFromWorld","addToGui","removeFromGui","build","getByUid","getByDom","broadcast","broadcastOn"])}),o("ephox.alloy.api.system.NoContextApi",["ephox.alloy.api.system.SystemApi","ephox.alloy.log.AlloyLogger","ephox.katamari.api.Fun","global!Error"],function(e,t,n,o){return function(r){var i=function(e){return function(){throw new o("The component must be in a context to send: "+e+"\n"+t.element(r().element())+" is not in context.")}};return e({debugInfo:n.constant("fake"),triggerEvent:i("triggerEvent"),triggerFocus:i("triggerFocus"),triggerEscape:i("triggerEscape"),build:i("build"),addToWorld:i("addToWorld"),removeFromWorld:i("removeFromWorld"),addToGui:i("addToGui"),removeFromGui:i("removeFromGui"),getByUid:i("getByUid"),getByDom:i("getByDom"),broadcast:i("broadcast"),broadcastOn:i("broadcastOn")})}}),o("ephox.alloy.alien.ObjIndex",["ephox.boulder.api.Objects","ephox.katamari.api.Obj"],function(e,t){return{byInnerKey:function(n,o){var r={};return t.each(n,function(n,i){t.each(n,function(t,n){var a=e.readOr(n,[])(r);r[n]=a.concat([o(i,t)])})}),r}}}),o("ephox.alloy.construct.ComponentDom",["ephox.alloy.alien.ObjIndex","ephox.alloy.dom.DomModification","ephox.boulder.api.Objects","ephox.katamari.api.Arr","ephox.katamari.api.Obj","ephox.katamari.api.Merger","ephox.sand.api.JSON","ephox.katamari.api.Fun","ephox.katamari.api.Result"],function(e,t,n,o,r,i,a,u,c){var s=function(e,t){return{name:u.constant(e),modification:t}},l=function(e,t,r){return e.length>1?c.error('Multiple behaviours have tried to change DOM "'+t+'". The guilty behaviours are: '+a.stringify(o.map(e,function(e){return e.name()}))+". At this stage, this is not supported. Future releases might provide strategies for resolving this."):0===e.length?c.value({}):c.value(e[0].modification().fold(function(){return{}},function(e){return n.wrap(t,e)}))},p=function(e,t){return o.foldl(e,function(i,u){var s=u.modification().getOr({});return i.bind(function(i){var u=r.mapToArray(s,function(r,u){return void 0!==i[u]?(s=t,l=u,p=e,c.error("Mulitple behaviours have tried to change the _"+l+'_ "'+s+'". The guilty behaviours are: '+a.stringify(o.bind(p,function(e){return void 0!==e.modification().getOr({})[l]?[e.name()]:[]}),null,2)+". This is not currently supported.")):c.value(n.wrap(u,r));var s,l,p});return n.consolidate(u,i)})},c.value({})).map(function(e){return n.wrap(t,e)})},f={classes:function(e,t){var r=o.bind(e,function(e){return e.modification().getOr([])});return c.value(n.wrap(t,r))},attributes:p,styles:p,domChildren:l,defChildren:l,innerHtml:l,value:l};return{combine:function(a,u,l,p){var m=i.deepMerge({},u);o.each(l,function(e){m[e.name()]=e.exhibit(a,p)});var d=e.byInnerKey(m,s),h=r.map(d,function(e,t){return o.bind(e,function(e){return e.modification().fold(function(){return[]},function(t){return[e]})})}),g=r.mapToArray(h,function(e,t){return n.readOptFrom(f,t).fold(function(){return c.error("Unknown field type: "+t)},function(n){return n(e,t)})});return n.consolidate(g,{}).map(t.nu)}}}),o("ephox.alloy.alien.PrioritySort",["ephox.sand.api.JSON","ephox.katamari.api.Result","global!Error"],function(e,t,n){return{sortKeys:function(o,r,i,a){var u=i.slice(0);try{var c=u.sort(function(t,i){var u=t[r](),c=i[r](),s=a.indexOf(u),l=a.indexOf(c);if(-1===s)throw new n("The ordering for "+o+" does not have an entry for "+u+".\nOrder specified: "+e.stringify(a,null,2));if(-1===l)throw new n("The ordering for "+o+" does not have an entry for "+c+".\nOrder specified: "+e.stringify(a,null,2));return s<l?-1:l<s?1:0});return t.value(c)}catch(e){return t.error([e])}}}}),o("ephox.alloy.events.DescribedHandler",["ephox.katamari.api.Fun"],function(e){return{nu:function(t,n){return{handler:t,purpose:e.constant(n)}},curryArgs:function(t,n){return{handler:e.curry.apply(void 0,[t.handler].concat(n)),purpose:t.purpose}},getHandler:function(e){return e.handler}}}),o("ephox.alloy.construct.ComponentEvents",["ephox.alloy.alien.ObjIndex","ephox.alloy.alien.PrioritySort","ephox.alloy.construct.EventHandler","ephox.alloy.events.DescribedHandler","ephox.boulder.api.Objects","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Merger","ephox.katamari.api.Obj","ephox.katamari.api.Result","ephox.sand.api.JSON","global!Array","global!Error"],function(e,t,n,o,r,i,a,u,c,s,l,p,f){var m=function(e,t){return{name:a.constant(e),handler:a.constant(t)}},d=function(t,n,o){var r=u.deepMerge(o,function(e,t){var n={};return i.each(e,function(e){n[e.name()]=e.handlers(t)}),n}(n,t));return e.byInnerKey(r,m)},h=function(e,o,r){var a=o[r];return a?t.sortKeys("Event: "+r,"name",e,a).map(function(e){var t=i.map(e,function(e){return e.handler()});return n.fuse(t)}):(u=r,c=e,new s.error(["The event ("+u+') has more than one behaviour that listens to it.\nWhen this occurs, you must specify an event ordering for the behaviours in your spec (e.g. [ "listing", "toggling" ]).\nThe behaviours that can trigger it are: '+l.stringify(i.map(c,function(e){return e.name()}),null,2)]));var u,c},g=function(e,t){var a=c.mapToArray(e,function(e,a){return(1===e.length?s.value(e[0].handler()):h(e,t,a)).map(function(u){var c=function(e){var t=n.read(e);return function(e,n){var o=p.prototype.slice.call(arguments,0);t.abort.apply(void 0,o)?n.stop():t.can.apply(void 0,o)&&t.run.apply(void 0,o)}}(u),s=e.length>1?i.filter(t,function(t){return i.contains(e,function(e){return e.name()===t})}).join(" > "):e[0].name();return r.wrap(a,o.nu(c,s))})});return r.consolidate(a,{})};return{combine:function(e,t,n,o){var r=d(e,n,o);return g(r,t)}}}),o("ephox.alloy.construct.CustomDefinition",["ephox.alloy.data.Fields","ephox.alloy.dom.DomDefinition","ephox.alloy.dom.DomModification","ephox.alloy.ephemera.AlloyTags","ephox.boulder.api.FieldPresence","ephox.boulder.api.FieldSchema","ephox.boulder.api.Objects","ephox.boulder.api.ValueSchema","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Merger","global!Error"],function(e,t,n,o,r,i,a,u,c,s,l,p){return{toInfo:function(t){return u.asStruct("custom.definition",u.objOfOnly([i.field("dom","dom",r.strict(),u.objOfOnly([i.strict("tag"),i.defaulted("styles",{}),i.defaulted("classes",[]),i.defaulted("attributes",{}),i.option("value"),i.option("innerHtml")])),i.strict("components"),i.strict("uid"),i.defaulted("events",{}),i.defaulted("apis",s.constant({})),i.field("eventOrder","eventOrder",r.mergeWith({"alloy.execute":["disabling","alloy.base.behaviour","toggling"],"alloy.focus":["alloy.base.behaviour","keying","focusing"],"alloy.system.init":["alloy.base.behaviour","disabling","toggling","representing"],input:["alloy.base.behaviour","representing","streaming","invalidating"],"alloy.system.detached":["alloy.base.behaviour","representing"]}),u.anyValue()),i.option("domModification"),e.snapshot("originalSpec"),i.defaulted("debug.sketcher","unknown")]),t)},toDefinition:function(e){var n,r={tag:e.dom().tag(),classes:e.dom().classes(),attributes:l.deepMerge((n=e,a.wrap(o.idAttr(),n.uid())),e.dom().attributes()),styles:e.dom().styles(),domChildren:c.map(e.components(),function(e){return e.element()})};return t.nu(l.deepMerge(r,e.dom().innerHtml().map(function(e){return a.wrap("innerHtml",e)}).getOr({}),e.dom().value().map(function(e){return a.wrap("value",e)}).getOr({})))},toModification:function(e){return e.domModification().fold(function(){return n.nu({})},n.nu)},toApis:function(e){return e.apis()},toEvents:function(e){return e.events()}}}),o("ephox.sugar.api.properties.Classes",["ephox.katamari.api.Arr","ephox.sugar.api.properties.Class","ephox.sugar.impl.ClassList","global!Array"],function(e,t,n,o){return{add:function(n,o){e.each(o,function(e){t.add(n,e)})},remove:function(n,o){e.each(o,function(e){t.remove(n,e)})},toggle:function(n,o){e.each(o,function(e){t.toggle(n,e)})},hasAll:function(n,o){return e.forall(o,function(e){return t.has(n,e)})},hasAny:function(n,o){return e.exists(o,function(e){return t.has(n,e)})},get:function(e){return n.supports(e)?function(e){for(var t=e.dom().classList,n=new o(t.length),r=0;r<t.length;r++)n[r]=t.item(r);return n}(e):n.get(e)}}}),o("ephox.alloy.dom.DomRender",["ephox.alloy.dom.DomDefinition","ephox.katamari.api.Arr","ephox.sugar.api.properties.Attr","ephox.sugar.api.properties.Classes","ephox.sugar.api.properties.Css","ephox.sugar.api.node.Element","ephox.sugar.api.properties.Html","ephox.sugar.api.dom.InsertAll","ephox.sugar.api.properties.Value","global!Error"],function(e,t,n,o,r,i,a,u,c,s){var l=function(l){var f=i.fromTag(l.tag());n.setAll(f,l.attributes().getOr({})),o.add(f,l.classes().getOr([])),r.setAll(f,l.styles().getOr({})),a.set(f,l.innerHtml().getOr(""));var m=function(n){if(n.domChildren().isSome()&&n.defChildren().isSome())throw new s("Cannot specify children and child specs! Must be one or the other.\nDef: "+e.defToStr(n));return n.domChildren().fold(function(){var e=n.defChildren().getOr([]);return t.map(e,p)},function(e){return e})}(l);return u.append(f,m),l.value().each(function(e){c.set(f,e)}),f},p=function(t){var n=e.nu(t);return l(n)};return{renderToDom:l}}),o("ephox.alloy.api.component.Component",["ephox.alloy.api.component.CompBehaviours","ephox.alloy.api.component.ComponentApi","ephox.alloy.api.system.NoContextApi","ephox.alloy.api.ui.GuiTypes","ephox.alloy.behaviour.common.BehaviourBlob","ephox.alloy.construct.ComponentDom","ephox.alloy.construct.ComponentEvents","ephox.alloy.construct.CustomDefinition","ephox.alloy.dom.DomModification","ephox.alloy.dom.DomRender","ephox.boulder.api.ValueSchema","ephox.katamari.api.Arr","ephox.katamari.api.Cell","ephox.katamari.api.Fun","ephox.katamari.api.Merger","ephox.katamari.api.Type","ephox.sand.api.JSON","ephox.sugar.api.search.Traverse","global!Error"],function(e,t,n,o,r,i,a,u,c,s,l,p,f,m,d,h,g,v,x){return{build:function(y){var b=function(){return I},k=f(n(b)),S=l.getOrDie(u.toInfo(d.deepMerge(y,{behaviours:void 0}))),O=e.generate(y),T=r.getBehaviours(O),w=r.getData(O),E=u.toDefinition(S),A={"alloy.base.modification":u.toModification(S)},C=i.combine(w,A,T,E).getOrDie(),F=c.merge(E,C),D=s.renderToDom(F),R={"alloy.base.behaviour":u.toEvents(S)},M=a.combine(w,S.eventOrder(),T,R).getOrDie(),B=f(S.components()),I=t({getSystem:k.get,config:function(e){if(e===o.apiConfig())return S.apis();var t=w;return(h.isFunction(t[e.name()])?t[e.name()]:function(){throw new x("Could not find "+e.name()+" in "+g.stringify(y,null,2))})()},spec:m.constant(y),readState:function(e){return w[e]().map(function(e){return e.state.readState()}).getOr("not enabled")},connect:function(e){k.set(e)},disconnect:function(){k.set(n(b))},element:m.constant(D),syncComponents:function(){var e=v.children(D),t=p.bind(e,function(e){return k.get().getByDom(e).fold(function(){return[]},function(e){return[e]})});B.set(t)},components:B.get,events:m.constant(M)});return I}}}),o("ephox.alloy.events.DefaultEvents",["ephox.alloy.api.events.AlloyEvents","ephox.alloy.api.events.SystemEvents","ephox.alloy.log.AlloyLogger","ephox.sugar.api.dom.Compare","global!console"],function(e,t,n,o,r){return{events:e.derive([e.can(t.focus(),function(e,i){var a=i.event().originator(),u=i.event().target();return c=e,s=a,l=u,!(o.eq(s,c.element())&&!o.eq(s,l))||(r.warn(t.focus()+" did not get interpreted by the desired target. \nOriginator: "+n.element(a)+"\nTarget: "+n.element(u)+"\nCheck the "+t.focus()+" event handlers"),!1);var c,s,l})])}}),o("ephox.alloy.spec.CustomSpec",[],function(){return{make:function(e){return e}}}),o("ephox.alloy.api.component.GuiFactory",["ephox.alloy.api.component.Component","ephox.alloy.api.component.ComponentApi","ephox.alloy.api.system.NoContextApi","ephox.alloy.api.ui.GuiTypes","ephox.alloy.events.DefaultEvents","ephox.alloy.registry.Tagger","ephox.alloy.spec.CustomSpec","ephox.boulder.api.FieldSchema","ephox.boulder.api.Objects","ephox.boulder.api.ValueSchema","ephox.katamari.api.Arr","ephox.katamari.api.Cell","ephox.katamari.api.Fun","ephox.katamari.api.Merger","ephox.katamari.api.Option","ephox.katamari.api.Result","ephox.sugar.api.node.Element","global!Error"],function(e,t,n,o,r,i,a,u,c,s,l,p,f,m,d,h,g,v){var x=function(t){var n=a.make(t),o=function(e){var t=c.readOr("components",[])(e);return l.map(t,b)}(n),i=m.deepMerge(r,n,c.wrap("components",o));return h.value(e.build(i))},y=function(e){var r=s.asStructOrDie("external.component",s.objOfOnly([u.strict("element"),u.option("uid")]),e),a=p(n());r.uid().each(function(e){i.writeOnly(r.element(),e)});var c=t({getSystem:a.get,config:d.none,connect:function(e){a.set(e)},disconnect:function(){a.set(n(function(){return c}))},element:f.constant(r.element()),spec:f.constant(e),readState:f.constant("No state"),syncComponents:f.noop,components:f.constant([]),events:f.constant({})});return o.premade(c)},b=function(e){return o.getPremade(e).fold(function(){var t=m.deepMerge({uid:i.generate("")},e);return x(t).getOrDie()},function(e){return e})};return{build:b,premade:o.premade,external:y,text:function(e){var t=g.fromText(e);return y({element:t})}}}),o("ephox.alloy.menu.util.ItemEvents",["ephox.alloy.api.behaviour.Focusing","ephox.alloy.api.events.AlloyTriggers","ephox.katamari.api.Fun","ephox.sugar.api.dom.Focus"],function(e,t,n,o){return{hover:n.constant("alloy.item-hover"),focus:n.constant("alloy.item-focus"),onHover:function(n){(o.search(n.element()).isNone()||e.isFocused(n))&&(e.isFocused(n)||e.focus(n),t.emitWith(n,"alloy.item-hover",{item:n}))},onFocus:function(e){t.emitWith(e,"alloy.item-focus",{item:e})}}}),o("ephox.alloy.menu.build.ItemType",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.api.behaviour.Focusing","ephox.alloy.api.behaviour.Keying","ephox.alloy.api.behaviour.Representing","ephox.alloy.api.behaviour.Toggling","ephox.alloy.api.events.AlloyEvents","ephox.alloy.api.events.AlloyTriggers","ephox.alloy.api.events.NativeEvents","ephox.alloy.api.events.SystemEvents","ephox.alloy.data.Fields","ephox.alloy.menu.util.ItemEvents","ephox.boulder.api.FieldSchema","ephox.katamari.api.Merger"],function(e,t,n,o,r,i,a,u,c,s,l,p,f){return[p.strict("data"),p.strict("components"),p.strict("dom"),p.option("toggling"),p.defaulted("itemBehaviours",{}),p.defaulted("ignoreFocus",!1),p.defaulted("domModification",{}),s.output("builder",function(s){return{dom:f.deepMerge(s.dom(),{attributes:{role:s.toggling().isSome()?"menuitemcheckbox":"menuitem"}}),behaviours:f.deepMerge(e.derive([s.toggling().fold(r.revoke,function(e){return r.config(f.deepMerge({aria:{mode:"checked"}},e))}),t.config({ignore:s.ignoreFocus(),onFocus:function(e){l.onFocus(e)}}),n.config({mode:"execution"}),o.config({store:{mode:"memory",initialValue:s.data()}})]),s.itemBehaviours()),events:i.derive([i.runWithTarget(c.tapOrClick(),a.emitExecute),i.cutter(u.mousedown()),i.run(u.mouseover(),l.onHover),i.run(c.focusItem(),t.focus)]),components:s.components(),domModification:s.domModification()}})]}),o("ephox.alloy.menu.build.SeparatorType",["ephox.alloy.api.events.AlloyEvents","ephox.alloy.api.events.SystemEvents","ephox.alloy.data.Fields","ephox.boulder.api.FieldSchema"],function(e,t,n,o){return[o.strict("dom"),o.strict("components"),n.output("builder",function(n){return{dom:n.dom(),components:n.components(),events:e.derive([e.stopper(t.focusItem())])}})]}),o("ephox.alloy.menu.build.WidgetParts",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.api.behaviour.Representing","ephox.alloy.parts.PartType","ephox.katamari.api.Fun"],function(e,t,n,o){var r=[n.required({name:"widget",overrides:function(n){return{behaviours:e.derive([t.config({store:{mode:"manual",getValue:function(e){return n.data()},setValue:function(){}}})])}}})];return{owner:o.constant("item-widget"),parts:o.constant(r)}}),o("ephox.alloy.menu.build.WidgetType",["ephox.alloy.alien.EditableFields","ephox.alloy.api.behaviour.Behaviour","ephox.alloy.api.behaviour.Focusing","ephox.alloy.api.behaviour.Keying","ephox.alloy.api.behaviour.Representing","ephox.alloy.api.events.AlloyEvents","ephox.alloy.api.events.NativeEvents","ephox.alloy.api.events.SystemEvents","ephox.alloy.data.Fields","ephox.alloy.menu.build.WidgetParts","ephox.alloy.menu.util.ItemEvents","ephox.alloy.parts.AlloyParts","ephox.boulder.api.FieldSchema","ephox.katamari.api.Merger","ephox.katamari.api.Option"],function(e,t,n,o,r,i,a,u,c,s,l,p,f,m,d){return[f.strict("uid"),f.strict("data"),f.strict("components"),f.strict("dom"),f.defaulted("autofocus",!1),f.defaulted("domModification",{}),p.defaultUidsSchema(s.parts()),c.output("builder",function(c){var f=p.substitutes(s.owner(),c,s.parts()),h=p.components(s.owner(),c,f.internals()),g=function(e){return p.getPart(e,c,"widget").map(function(e){return o.focusIn(e),e})},v=function(t,n){return e.inside(n.event().target())?d.none():c.autofocus()?(n.setSource(t.element()),d.none()):d.none()};return m.deepMerge({dom:c.dom(),components:h,domModification:c.domModification(),events:i.derive([i.runOnExecute(function(e,t){g(e).each(function(e){t.stop()})}),i.run(a.mouseover(),l.onHover),i.run(u.focusItem(),function(e,t){c.autofocus()?g(e):n.focus(e)})]),behaviours:t.derive([r.config({store:{mode:"memory",initialValue:c.data()}}),n.config({onFocus:function(e){l.onFocus(e)}}),o.config({mode:"special",onLeft:v,onRight:v,onEscape:function(e,t){return n.isFocused(e)||c.autofocus()?c.autofocus()?(t.setSource(e.element()),d.none()):d.none():(n.focus(e),d.some(!0))}})])})})]}),o("ephox.alloy.ui.schema.MenuSchema",["ephox.alloy.api.focus.FocusManagers","ephox.alloy.data.Fields","ephox.alloy.menu.build.ItemType","ephox.alloy.menu.build.SeparatorType","ephox.alloy.menu.build.WidgetType","ephox.alloy.parts.PartType","ephox.alloy.registry.Tagger","ephox.boulder.api.FieldSchema","ephox.boulder.api.ValueSchema","ephox.katamari.api.Fun","ephox.katamari.api.Merger"],function(e,t,n,o,r,i,a,u,c,s,l){var p=c.choose("type",{widget:r,item:n,separator:o}),f=[i.group({factory:{sketch:function(e){var t=c.asStructOrDie("menu.spec item",p,e);return t.builder()(t)}},name:"items",unit:"item",defaults:function(e,t){var n=a.generate("");return l.deepMerge({uid:n},t)},overrides:function(e,t){return{type:t.type,ignoreFocus:e.fakeFocus(),domModification:{classes:[e.markers().item()]}}}})],m=[u.strict("value"),u.strict("items"),u.strict("dom"),u.strict("components"),u.defaulted("eventOrder",{}),u.defaulted("menuBehaviours",{}),u.defaultedOf("movement",{mode:"menu",moveOnTab:!0},c.choose("mode",{grid:[t.initSize(),t.output("config",function(e,t){return{mode:"flatgrid",selector:"."+e.markers().item(),initSize:{numColumns:t.initSize().numColumns(),numRows:t.initSize().numRows()},focusManager:e.focusManager()}})],menu:[u.defaulted("moveOnTab",!0),t.output("config",function(e,t){return{mode:"menu",selector:"."+e.markers().item(),moveOnTab:t.moveOnTab(),focusManager:e.focusManager()}})]})),t.itemMarkers(),u.defaulted("fakeFocus",!1),u.defaulted("focusManager",e.dom()),t.onHandler("onHighlight")];return{name:s.constant("Menu"),schema:s.constant(m),parts:s.constant(f)}}),o("ephox.alloy.menu.util.MenuEvents",["ephox.katamari.api.Fun"],function(e){return{focus:e.constant("alloy.menu-focus")}}),o("ephox.alloy.ui.single.MenuSpec",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.api.behaviour.Composing","ephox.alloy.api.behaviour.Highlighting","ephox.alloy.api.behaviour.Keying","ephox.alloy.api.behaviour.Representing","ephox.alloy.api.events.AlloyEvents","ephox.alloy.api.events.AlloyTriggers","ephox.alloy.menu.util.ItemEvents","ephox.alloy.menu.util.MenuEvents","ephox.katamari.api.Fun","ephox.katamari.api.Merger","global!Error"],function(e,t,n,o,r,i,a,u,c,s,l,p){return{make:function(p,f,m,d){return l.deepMerge({dom:l.deepMerge(p.dom(),{attributes:{role:"menu"}}),uid:p.uid(),behaviours:l.deepMerge(e.derive([n.config({highlightClass:p.markers().selectedItem(),itemClass:p.markers().item(),onHighlight:p.onHighlight()}),r.config({store:{mode:"memory",initialValue:p.value()}}),t.config({find:s.identity}),o.config(p.movement().config()(p,p.movement()))]),p.menuBehaviours()),events:i.derive([i.run(u.focus(),function(e,t){var o=t.event();e.getSystem().getByDom(o.target()).each(function(o){n.highlight(e,o),t.stop(),a.emitWith(e,c.focus(),{menu:e,item:o})})}),i.run(u.hover(),function(e,t){var o=t.event().item();n.highlight(e,o)})]),components:f,eventOrder:p.eventOrder()})}}}),o("ephox.alloy.api.ui.Menu",["ephox.alloy.api.ui.Sketcher","ephox.alloy.ui.schema.MenuSchema","ephox.alloy.ui.single.MenuSpec"],function(e,t,n){return e.composite({name:"Menu",configFields:t.schema(),partFields:t.parts(),factory:n.make})}),o("ephox.alloy.alien.AriaFocus",["ephox.katamari.api.Option","ephox.sugar.api.dom.Compare","ephox.sugar.api.dom.Focus","ephox.sugar.api.search.PredicateFind","ephox.sugar.api.search.Traverse"],function(e,t,n,o,r){return{preserve:function(i,a){var u=r.owner(a),c=n.active(u).bind(function(n){var r=function(e){return t.eq(n,e)};return r(a)?e.some(a):o.descendant(a,r)}),s=i(a);return c.each(function(e){n.active(u).filter(function(n){return t.eq(n,e)}).orThunk(function(){n.focus(e)})}),s}}}),o("ephox.alloy.behaviour.replacing.ReplaceApis",["ephox.alloy.alien.AriaFocus","ephox.alloy.api.system.Attachment","ephox.katamari.api.Arr","ephox.sugar.api.dom.Compare","ephox.sugar.api.dom.Insert"],function(e,t,n,o,r){var i=function(e,n,o,r){var i=e.getSystem().build(r);t.attachWith(e,i,o)},a=function(e,t){return e.components()};return{append:function(e,t,n,o){i(e,0,r.append,o)},prepend:function(e,t,n,o){i(e,0,r.prepend,o)},remove:function(e,r,i,u){var c=a(e,r);n.find(c,function(e){return o.eq(u.element(),e.element())}).each(t.detach)},set:function(o,r,i,a){t.detachChildren(o),e.preserve(function(){var e=n.map(a,o.getSystem().build);n.each(e,function(e){t.attach(o,e)})},o.element())},contents:a}}),o("ephox.alloy.api.behaviour.Replacing",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.behaviour.replacing.ReplaceApis"],function(e,t){return e.create({fields:[],name:"replacing",apis:t})}),o("ephox.alloy.menu.layered.MenuPathing",["ephox.boulder.api.Objects","ephox.katamari.api.Arr","ephox.katamari.api.Obj","ephox.katamari.api.Option"],function(e,t,n,o){var r=function(t,n,i,a){return e.readOptFrom(i,a).bind(function(a){return e.readOptFrom(t,a).bind(function(e){var a=r(t,n,i,e);return o.some([e].concat(a))})}).getOr([])};return{generate:function(o,i){var a={};n.each(o,function(e,n){t.each(e,function(e){a[e]=n})});var u,c=i,s=(u=i,n.tupleMap(u,function(e,t){return{k:e,v:t}})),l=n.map(s,function(e,t){return[t].concat(r(a,c,s,t))});return n.map(a,function(t){return e.readOptFrom(l,t).getOr([t])})}}}),o("ephox.alloy.menu.layered.LayeredState",["ephox.alloy.menu.layered.MenuPathing","ephox.boulder.api.Objects","ephox.katamari.api.Arr","ephox.katamari.api.Obj","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.katamari.api.Cell"],function(e,t,n,o,r,i,a){return function(){var u=a({}),c=a({}),s=a({}),l=a(i.none()),p=a(r.constant([])),f=function(e){return t.readOptFrom(c.get(),e)};return{setContents:function(t,n,o,r){l.set(i.some(t)),u.set(o),c.set(n),p.set(r);var a=r(n),f=e.generate(a,o);s.set(f)},expand:function(e){return t.readOptFrom(u.get(),e).map(function(n){var o=t.readOptFrom(s.get(),e).getOr([]);return[n].concat(o)})},refresh:function(e){return t.readOptFrom(s.get(),e)},collapse:function(e){return t.readOptFrom(s.get(),e).bind(function(e){return e.length>1?i.some(e.slice(1)):i.none()})},lookupMenu:f,otherMenus:function(e){var t=p.get()(c.get());return n.difference(o.keys(t),e)},getPrimary:function(){return l.get().bind(f)},getMenus:function(){return c.get()},clear:function(){u.set({}),c.set({}),s.set({}),l.set(i.none())},isClear:function(){return l.get().isNone()}}}}),o("ephox.alloy.ui.single.TieredMenuSpec",["ephox.alloy.alien.EditableFields","ephox.alloy.api.behaviour.Behaviour","ephox.alloy.api.behaviour.Composing","ephox.alloy.api.behaviour.Highlighting","ephox.alloy.api.behaviour.Keying","ephox.alloy.api.behaviour.Replacing","ephox.alloy.api.behaviour.Representing","ephox.alloy.api.component.GuiFactory","ephox.alloy.api.events.AlloyEvents","ephox.alloy.api.events.AlloyTriggers","ephox.alloy.api.events.SystemEvents","ephox.alloy.api.focus.FocusManagers","ephox.alloy.api.ui.Menu","ephox.alloy.menu.layered.LayeredState","ephox.alloy.menu.util.ItemEvents","ephox.alloy.menu.util.MenuEvents","ephox.boulder.api.Objects","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Merger","ephox.katamari.api.Obj","ephox.katamari.api.Option","ephox.katamari.api.Options","ephox.sugar.api.node.Body","ephox.sugar.api.properties.Class","ephox.sugar.api.properties.Classes","ephox.sugar.api.search.SelectorFind"],function(e,t,n,o,r,i,a,u,c,s,l,p,f,m,d,h,g,v,x,y,b,k,S,O,T,w,E){return{make:function(x,A){var C=m(),F=function(e){var t,n,o=(t=e,n=x.data().menus(),b.map(n,function(e,n){var o=f.sketch(y.deepMerge(e,{value:n,items:e.items,markers:g.narrow(A.markers,["item","selectedItem"]),fakeFocus:x.fakeFocus(),onHighlight:x.onHighlight(),focusManager:x.fakeFocus()?p.highlights():p.dom()}));return t.getSystem().build(o)}));return C.setContents(x.data().primary(),o,x.data().expansions(),function(t){return R(e,t)}),C.getPrimary()},D=function(e){return a.getValue(e).value},R=function(e,t){return b.map(x.data().menus(),function(e,t){return v.bind(e.items,function(e){return"separator"===e.type?[]:[e.data.value]})})},M=function(e,t){o.highlight(e,t),o.getHighlighted(t).orThunk(function(){return o.getFirst(t)}).each(function(t){s.dispatch(e,t.element(),l.focusItem())})},B=function(e,t){return S.cat(v.map(t,e.lookupMenu))},I=function(e,t,n){return k.from(n[0]).bind(t.lookupMenu).map(function(o){var r=B(t,n.slice(1));v.each(r,function(e){T.add(e.element(),x.markers().backgroundMenu())}),O.inBody(o.element())||i.append(e,u.premade(o)),w.remove(o.element(),[x.markers().backgroundMenu()]),M(e,o);var a=B(t,t.otherMenus(n));return v.each(a,function(t){w.remove(t.element(),[x.markers().backgroundMenu()]),x.stayInDom()||i.remove(e,t)}),o})},N=function(e,t){var n=D(t);return C.expand(n).bind(function(n){return k.from(n[0]).bind(C.lookupMenu).each(function(n){O.inBody(n.element())||i.append(e,u.premade(n)),x.onOpenSubmenu()(e,t,n),o.highlightFirst(n)}),I(e,C,n)})},P=function(e,t){var n=D(t);return C.collapse(n).bind(function(n){return I(e,C,n).map(function(n){return x.onCollapseMenu()(e,t,n),n})})},j=function(e){return function(t,n){return E.closest(n.getSource(),"."+x.markers().item()).bind(function(n){return t.getSystem().getByDom(n).bind(function(n){return e(t,n)})})}},V=c.derive([c.run(h.focus(),function(e,t){var n=t.event().menu();o.highlight(e,n)}),c.runOnExecute(function(e,t){var n=t.event().target();return e.getSystem().getByDom(n).bind(function(t){return 0===D(t).indexOf("collapse-item")?P(e,t):N(e,t).orThunk(function(){return x.onExecute()(e,t)})})}),c.runOnAttached(function(e,t){F(e).each(function(t){i.append(e,u.premade(t)),x.openImmediately()&&(M(e,t),x.onOpenMenu()(e,t))})})].concat(x.navigateOnHover()?[c.run(d.hover(),function(e,t){var n=t.event().item();!function(e,t){var n=D(t);C.refresh(n).bind(function(t){return I(e,C,t)})}(e,n),N(e,n),x.onHover()(e,n)})]:[]));return{uid:x.uid(),dom:x.dom(),behaviours:y.deepMerge(t.derive([r.config({mode:"special",onRight:j(function(t,n){return e.inside(n.element())?k.none():N(t,n)}),onLeft:j(function(t,n){return e.inside(n.element())?k.none():P(t,n)}),onEscape:j(function(e,t){return P(e,t).orThunk(function(){return x.onEscape()(e,t)})}),focusIn:function(e,t){C.getPrimary().each(function(t){s.dispatch(e,t.element(),l.focusItem())})}}),o.config({highlightClass:x.markers().selectedMenu(),itemClass:x.markers().menu()}),n.config({find:function(e){return o.getHighlighted(e)}}),i.config({})]),x.tmenuBehaviours()),eventOrder:x.eventOrder(),apis:{collapseMenu:function(e){o.getHighlighted(e).each(function(t){o.getHighlighted(t).each(function(t){P(e,t)})})}},events:V}},collapseItem:x.constant("collapse-item")}}),o("ephox.alloy.api.ui.TieredMenu",["ephox.alloy.api.ui.Sketcher","ephox.alloy.data.Fields","ephox.alloy.ui.single.TieredMenuSpec","ephox.boulder.api.FieldSchema","ephox.boulder.api.Objects","ephox.katamari.api.Id"],function(e,t,n,o,r,i){return e.single({name:"TieredMenu",configFields:[t.onStrictKeyboardHandler("onExecute"),t.onStrictKeyboardHandler("onEscape"),t.onStrictHandler("onOpenMenu"),t.onStrictHandler("onOpenSubmenu"),t.onHandler("onCollapseMenu"),o.defaulted("openImmediately",!0),o.strictObjOf("data",[o.strict("primary"),o.strict("menus"),o.strict("expansions")]),o.defaulted("fakeFocus",!1),t.onHandler("onHighlight"),t.onHandler("onHover"),t.tieredMenuMarkers(),o.strict("dom"),o.defaulted("navigateOnHover",!0),o.defaulted("stayInDom",!1),o.defaulted("tmenuBehaviours",{}),o.defaulted("eventOrder",{})],apis:{collapseMenu:function(e,t){e.collapseMenu(t)}},factory:n.make,extraApis:{tieredData:function(e,t,n){return{primary:e,menus:t,expansions:n}},singleData:function(e,t){return{primary:e,menus:r.wrap(e,t),expansions:{}}},collapseItem:function(e){return{value:i.generate(n.collapseItem()),text:e}}}})}),o("tinymce.themes.mobile.touch.scroll.Scrollable",["ephox.katamari.api.Fun","ephox.sugar.api.properties.Class","tinymce.themes.mobile.style.Styles"],function(e,t,n){var o=n.resolve("scrollable");return{register:function(e){t.add(e,o)},deregister:function(e){t.remove(e,o)},scrollable:e.constant(o)}}),o("tinymce.themes.mobile.ui.StylesMenu",["ephox.alloy.api.behaviour.AddEventsBehaviour","ephox.alloy.api.behaviour.Behaviour","ephox.alloy.api.behaviour.Representing","ephox.alloy.api.behaviour.Toggling","ephox.alloy.api.behaviour.Transitioning","ephox.alloy.api.component.GuiFactory","ephox.alloy.api.component.Memento","ephox.alloy.api.events.AlloyEvents","ephox.alloy.api.ui.Button","ephox.alloy.api.ui.Menu","ephox.alloy.api.ui.TieredMenu","ephox.boulder.api.Objects","ephox.katamari.api.Arr","ephox.katamari.api.Merger","ephox.katamari.api.Obj","ephox.sugar.api.properties.Css","ephox.sugar.api.search.SelectorFind","ephox.sugar.api.view.Width","tinymce.themes.mobile.channels.Receivers","tinymce.themes.mobile.style.Styles","tinymce.themes.mobile.touch.scroll.Scrollable"],function(e,t,n,o,r,i,a,u,c,s,l,p,f,m,d,h,g,v,x,y,b){var k=function(e){return p.readOptFrom(e,"format").getOr(e.title)},S=function(e,n,r,i,a){return{data:{value:e,text:n},type:"item",dom:{tag:"div",classes:a?[y.resolve("styles-item-is-menu")]:[]},toggling:{toggleOnExecute:!1,toggleClass:y.resolve("format-matches"),selected:r},itemBehaviours:t.derive(a?[]:[x.format(e,function(e,t){(t?o.on:o.off)(e)})]),components:[{dom:{tag:"div",attributes:{style:i},innerHtml:n}}]}},O=function(n,o,a,p){return{value:n,dom:{tag:"div"},components:[c.sketch({dom:{tag:"div",classes:[y.resolve("styles-collapser")]},components:p?[{dom:{tag:"span",classes:[y.resolve("styles-collapse-icon")]}},i.text(n)]:[i.text(n)],action:function(e){if(p){var t=a().get(e);l.collapseMenu(t)}}}),{dom:{tag:"div",classes:[y.resolve("styles-menu-items-container")]},components:[s.parts().items({})],behaviours:t.derive([e.config("adhoc-scrollable-menu",[u.runOnAttached(function(e,t){h.set(e.element(),"overflow-y","auto"),h.set(e.element(),"-webkit-overflow-scrolling","touch"),b.register(e.element())}),u.runOnDetached(function(e){h.remove(e.element(),"overflow-y"),h.remove(e.element(),"-webkit-overflow-scrolling"),b.deregister(e.element())})])])}],items:o,menuBehaviours:t.derive([r.config({initialState:"after",routes:r.createTristate("before","current","after",{transition:{property:"transform",transitionClass:"transitioning"}})})])}};return{sketch:function(e){var t=function(e,t){var n=O("Styles",[].concat(f.map(e.items,function(t){return S(k(t),t.title,t.isSelected(),t.getPreview(),p.hasKey(e.expansions,k(t)))})),t,!1),o=d.map(e.menus,function(n,o){var r=f.map(n,function(t){return S(k(t),t.title,void 0!==t.isSelected&&t.isSelected(),void 0!==t.getPreview?t.getPreview():"",p.hasKey(e.expansions,k(t)))});return O(o,r,t,!0)}),r=m.deepMerge(o,p.wrap("styles",n));return{tmenu:l.tieredData("styles",r,e.expansions)}}(e.formats,function(){return o}),o=a.record(l.sketch({dom:{tag:"div",classes:[y.resolve("styles-menu")]},components:[],fakeFocus:!0,stayInDom:!0,onExecute:function(t,o){var r=n.getValue(o);e.handle(o,r.value)},onEscape:function(){},onOpenMenu:function(e,t){var n=v.get(e.element());v.set(t.element(),n),r.jumpTo(t,"current")},onOpenSubmenu:function(e,t,n){var o=v.get(e.element()),i=g.ancestor(t.element(),'[role="menu"]').getOrDie("hacky"),a=e.getSystem().getByDom(i).getOrDie();v.set(n.element(),o),r.progressTo(a,"before"),r.jumpTo(n,"after"),r.progressTo(n,"current")},onCollapseMenu:function(e,t,n){var o=g.ancestor(t.element(),'[role="menu"]').getOrDie("hacky"),i=e.getSystem().getByDom(o).getOrDie();r.progressTo(i,"after"),r.progressTo(n,"current")},navigateOnHover:!1,openImmediately:!0,data:t.tmenu,markers:{backgroundMenu:y.resolve("styles-background-menu"),menu:y.resolve("styles-menu"),selectedMenu:y.resolve("styles-selected-menu"),item:y.resolve("styles-item"),selectedItem:y.resolve("styles-selected-item")}}));return o.asSpec()}}}),o("tinymce.themes.mobile.util.StyleConversions",["ephox.boulder.api.Objects","ephox.katamari.api.Arr","ephox.katamari.api.Merger"],function(e,t,n){var o=function(t){return e.hasKey(t,"items")?function(t){var o=n.deepMerge(e.exclude(t,["items"]),{menu:!0}),i=r(t.items,t.title);return{item:o,menus:n.deepMerge(i.menus,e.wrap(t.title,i.items)),expansions:n.deepMerge(i.expansions,e.wrap(t.title,t.title))}}(t):{item:t,menus:{},expansions:{}}},r=function(e){return t.foldr(e,function(e,t){var r=o(t);return{menus:n.deepMerge(e.menus,r.menus),items:[r.item].concat(e.items),expansions:n.deepMerge(e.expansions,r.expansions)}},{menus:{},expansions:{},items:[]})};return{expand:r}}),o("tinymce.themes.mobile.util.StyleFormats",["ephox.alloy.api.behaviour.Toggling","ephox.boulder.api.Objects","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Id","ephox.katamari.api.Merger","tinymce.themes.mobile.features.DefaultStyleFormats","tinymce.themes.mobile.ui.StylesMenu","tinymce.themes.mobile.util.StyleConversions"],function(e,t,n,o,r,i,a,u,c){return{register:function(e,u){var c=function(t){return function(){return e.formatter.match(t)}},s=function(t){return function(){return e.formatter.getCssText(t)}},l=t.readOptFrom(u,"style_formats").getOr(a),p=function(a){return n.map(a,function(n){if(t.hasKey(n,"items")){var a=p(n.items);return i.deepMerge((l=n,i.deepMerge(l,{isSelected:o.constant(!1),getPreview:o.constant("")})),{items:a})}return t.hasKey(n,"format")?(u=n,i.deepMerge(u,{isSelected:c(u.format),getPreview:s(u.format)})):function(t){var n=r.generate(t.title),o=i.deepMerge(t,{format:n,isSelected:c(n),getPreview:s(n)});return e.formatter.register(n,o),o}(n);var u,l})};return p(l)},ui:function(o,r,i){var a=function(e,o){var r=function(o){return n.bind(o,function(n){return void 0!==n.items?r(n.items).length>0?[n]:[]:!t.hasKey(n,"format")||e.formatter.canApply(n.format)?[n]:[]})},i=r(o);return c.expand(i)}(o,r);return u.sketch({formats:a,handle:function(t,n){o.undoManager.transact(function(){e.isOn(t)?o.formatter.remove(n):o.formatter.apply(n)}),i()}})}}}),o("tinymce.themes.mobile.features.Features",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.api.behaviour.Receiving","ephox.alloy.api.behaviour.Toggling","ephox.alloy.api.component.Memento","ephox.boulder.api.Objects","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.katamari.api.Type","global!setTimeout","global!window","tinymce.themes.mobile.channels.Receivers","tinymce.themes.mobile.channels.TinyChannels","tinymce.themes.mobile.style.Styles","tinymce.themes.mobile.ui.Buttons","tinymce.themes.mobile.ui.ColorSlider","tinymce.themes.mobile.ui.FontSizeSlider","tinymce.themes.mobile.ui.ImagePicker","tinymce.themes.mobile.ui.LinkButton","tinymce.themes.mobile.util.StyleFormats"],function(e,t,n,o,r,i,a,u,c,s,l,p,f,m,d,h,g,v,x,y){var b=["undo","bold","italic","link","image","bullist","styleselect"],k=function(e){var t=e.replace(/\|/g," ").trim();return t.length>0?t.split(/\s+/):[]},S=function(e){return i.bind(e,function(e){return c.isArray(e)?S(e):k(e)})},O=function(e){var t=void 0!==e.toolbar?e.toolbar:b;return c.isArray(t)?S(t):k(t)};return{identify:O,setup:function(o,i){var a=function(e){return function(){return d.forToolbarCommand(i,e)}},c=function(e){return function(){return d.forToolbarStateCommand(i,e)}},s=function(e,t,n){return function(){return d.forToolbarStateAction(i,e,t,n)}},l=a("undo"),b=a("redo"),k=c("bold"),S=c("italic"),O=c("underline"),T=a("removeformat"),w=s("unlink","link",function(){i.execCommand("unlink",null,!1)}),E=s("unordered-list","ul",function(){i.execCommand("InsertUnorderedList",null,!1)}),A=s("ordered-list","ol",function(){i.execCommand("InsertOrderedList",null,!1)}),C=y.register(i,i.settings),F=function(){return y.ui(i,C,function(){i.fire("scrollIntoView")})},D=function(e,t){return{isSupported:function(){return e.forall(function(e){return r.hasKey(i.buttons,e)})},sketch:t}};return{undo:D(u.none(),l),redo:D(u.none(),b),bold:D(u.none(),k),italic:D(u.none(),S),underline:D(u.none(),O),removeformat:D(u.none(),T),link:D(u.none(),function(){return x.sketch(o,i)}),unlink:D(u.none(),w),image:D(u.none(),function(){return v.sketch(i)}),bullist:D(u.some("bullist"),E),numlist:D(u.some("numlist"),A),fontsizeselect:D(u.none(),function(){return g.sketch(o,i)}),forecolor:D(u.none(),function(){return h.sketch(o,i)}),styleselect:D(u.none(),function(){return d.forToolbar("style-formats",function(e){i.fire("toReading"),o.dropup().appear(F,n.on,e)},e.derive([n.config({toggleClass:m.resolve("toolbar-button-selected"),toggleOnExecute:!1,aria:{mode:"pressed"}}),t.config({channels:r.wrapAll([p.receive(f.orientationChanged(),n.off),p.receive(f.dropupDismissed(),n.off)])})]))})}},detect:function(e,t){var n=O(e),o={};return i.bind(n,function(e){var n=!r.hasKey(o,e)&&r.hasKey(t,e)&&t[e].isSupported()?[t[e].sketch()]:[];return o[e]=!0,n})}}}),o("ephox.sugar.impl.FilteredEvent",["ephox.katamari.api.Fun","ephox.sugar.api.node.Element"],function(e,t){var n=function(n,o){return function(r){if(n(r)){var i,a,u,c,s,l,p,f=t.fromDom(r.target),m=function(){r.stopPropagation()},d=function(){r.preventDefault()},h=e.compose(d,m),g=(i=f,a=r.clientX,u=r.clientY,c=m,s=d,l=h,p=r,{target:e.constant(i),x:e.constant(a),y:e.constant(u),stop:c,prevent:s,kill:l,raw:e.constant(p)});o(g)}}},o=function(t,o,i,a,u){var c=n(i,a);return t.dom().addEventListener(o,c,u),{unbind:e.curry(r,t,o,c,u)}},r=function(e,t,n,o){e.dom().removeEventListener(t,n,o)};return{bind:function(e,t,n,r){return o(e,t,n,r,!1)},capture:function(e,t,n,r){return o(e,t,n,r,!0)}}}),o("ephox.sugar.api.events.DomEvent",["ephox.katamari.api.Fun","ephox.sugar.impl.FilteredEvent"],function(e,t){var n=e.constant(!0);return{bind:function(e,o,r){return t.bind(e,o,n,r)},capture:function(e,o,r){return t.capture(e,o,n,r)}}}),r("global!clearInterval",clearInterval),r("global!setInterval",setInterval),o("tinymce.themes.mobile.touch.view.Orientation",["ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.sand.api.PlatformDetection","ephox.sugar.api.events.DomEvent","ephox.sugar.api.node.Element","global!clearInterval","global!Math","global!setInterval"],function(e,t,n,o,r,i,a,u){var c=function(t){var n=t.matchMedia("(orientation: portrait)").matches;return{isPortrait:e.constant(n)}};return{get:c,onChange:function(e,n){var a=r.fromDom(e),s=null,l=o.bind(a,"orientationchange",function(){i(s);var t=c(e);n.onChange(t),p(function(){n.onReady(t)})}),p=function(n){i(s);var o=e.innerHeight,r=0;s=u(function(){o!==e.innerHeight?(i(s),n(t.some(e.innerHeight))):r>20&&(i(s),n(t.none())),r++},50)};return{onAdjustment:p,destroy:function(){l.unbind()}}},getActualWidth:function(e){var t=n.detect().os.isiOS(),o=c(e).isPortrait();return t&&!o?e.screen.height:e.screen.width}}}),r("global!clearTimeout",clearTimeout),o("ephox.alloy.alien.DelayedFunction",["global!clearTimeout","global!setTimeout"],function(e,t){return function(n,o){var r=null;return{cancel:function(){null!==r&&(e(r),r=null)},schedule:function(){var e=arguments;r=t(function(){n.apply(null,e),r=null},o)}}}}),o("ephox.alloy.events.TapEvent",["ephox.alloy.alien.DelayedFunction","ephox.alloy.api.events.NativeEvents","ephox.alloy.api.events.SystemEvents","ephox.boulder.api.Objects","ephox.katamari.api.Cell","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.sugar.api.dom.Compare","global!Math"],function(e,t,n,o,r,i,a,u,c){var s=function(e){return void 0===e.raw().touches||1!==e.raw().touches.length?a.none():a.some(e.raw().touches[0])};return{monitor:function(l){var p=r(a.none()),f=e(function(e){p.set(a.none()),l.triggerEvent(n.longpress(),e)},400),m=o.wrapAll([{key:t.touchstart(),value:function(e){return s(e).each(function(t){f.cancel();var n={x:i.constant(t.clientX),y:i.constant(t.clientY),target:e.target};f.schedule(n),p.set(a.some(n))}),a.none()}},{key:t.touchmove(),value:function(e){return f.cancel(),s(e).each(function(e){p.get().each(function(t){(function(e,t){var n=c.abs(e.clientX-t.x()),o=c.abs(e.clientY-t.y());return n>5||o>5})(e,t)&&p.set(a.none())})}),a.none()}},{key:t.touchend(),value:function(e){return f.cancel(),p.get().filter(function(t){return u.eq(t.target(),e.target())}).map(function(t){return l.triggerEvent(n.tap(),e)})}}]);return{fireIfReady:function(e,t){return o.readOptFrom(m,t).bind(function(t){return t(e)})}}}}}),o("tinymce.themes.mobile.util.TappingEvent",["ephox.alloy.events.TapEvent","ephox.sugar.api.events.DomEvent"],function(e,t){return{monitor:function(n){var o=e.monitor({triggerEvent:function(e,t){n.onTapContent(t)}});return{fireTouchstart:function(e){o.fireIfReady(e,"touchstart")},onTouchend:function(){return t.bind(n.body(),"touchend",function(e){o.fireIfReady(e,"touchend")})},onTouchmove:function(){return t.bind(n.body(),"touchmove",function(e){o.fireIfReady(e,"touchmove")})}}}}}),o("tinymce.themes.mobile.android.core.AndroidEvents",["ephox.alloy.api.behaviour.Toggling","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.sand.api.PlatformDetection","ephox.sugar.api.dom.Compare","ephox.sugar.api.dom.Focus","ephox.sugar.api.events.DomEvent","ephox.sugar.api.node.Element","ephox.sugar.api.node.Node","ephox.sugar.api.search.Traverse","tinymce.themes.mobile.util.TappingEvent"],function(e,t,n,o,r,i,a,u,c,s,l){var p=o.detect().os.version.major>=6;return{initEvents:function(o,f,m){var d=l.monitor(o),h=s.owner(f),g=function(e){return!r.eq(e.start(),e.finish())||e.soffset()!==e.foffset()},v=function(){var t=o.doc().dom().hasFocus()&&o.getSelection().exists(g);m.getByDom(f).each(!0===(t||i.active(h).filter(function(e){return"input"===c.name(e)}).exists(function(e){return e.dom().selectionStart!==e.dom().selectionEnd}))?e.on:e.off)},x=[a.bind(o.body(),"touchstart",function(e){o.onTouchContent(),d.fireTouchstart(e)}),d.onTouchmove(),d.onTouchend(),a.bind(f,"touchstart",function(e){o.onTouchToolstrip()}),o.onToReading(function(){i.blur(o.body())}),o.onToEditing(n.noop),o.onScrollToCursor(function(e){e.preventDefault(),o.getCursorBox().each(function(e){var t=o.win(),n=e.top()>t.innerHeight||e.bottom()>t.innerHeight?e.bottom()-t.innerHeight+50:0;0!==n&&t.scrollTo(t.pageXOffset,t.pageYOffset+n)})})].concat(!0===p?[]:[a.bind(u.fromDom(o.win()),"blur",function(){m.getByDom(f).each(e.off)}),a.bind(h,"select",v),a.bind(o.doc(),"selectionchange",v)]);return{destroy:function(){t.each(x,function(e){e.unbind()})}}}}}),o("tinymce.themes.mobile.android.focus.ResumeEditing",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.sugar.api.dom.Focus","ephox.sugar.api.node.Element","ephox.sugar.api.node.Node","global!setTimeout"],function(e,t,n,o,r,i){return{resume:function(a){a.focus();var u=o.fromDom(a.document.body);(n.active().exists(function(t){return e.contains(["input","textarea"],r.name(t))})?function(e){i(function(){e()},0)}:t.apply)(function(){n.active().each(n.blur),n.focus(u)})}}}),r("global!isNaN",isNaN),r("global!parseInt",parseInt),o("tinymce.themes.mobile.util.DataAttributes",["ephox.sugar.api.properties.Attr","global!isNaN","global!parseInt"],function(e,t,n){return{safeParse:function(o,r){var i=n(e.get(o,r),10);return t(i)?0:i}}}),o("ephox.sugar.impl.NodeValue",["ephox.sand.api.PlatformDetection","ephox.katamari.api.Option","global!Error"],function(e,t,n){return function(o,r){var i=function(e){return o(e)?t.from(e.dom().nodeValue):t.none()},a=e.detect().browser,u=a.isIE()&&10===a.version.major?function(e){try{return i(e)}catch(e){return t.none()}}:i;return{get:function(e){if(!o(e))throw new n("Can only get "+r+" value of a "+r+" node");return u(e).getOr("")},getOption:u,set:function(e,t){if(!o(e))throw new n("Can only set raw "+r+" value of a "+r+" node");e.dom().nodeValue=t}}}}),o("ephox.sugar.api.node.Text",["ephox.sugar.api.node.Node","ephox.sugar.impl.NodeValue"],function(e,t){var n=t(e.isText,"text");return{get:function(e){return n.get(e)},getOption:function(e){return n.getOption(e)},set:function(e,t){n.set(e,t)}}}),o("ephox.sugar.api.selection.Awareness",["ephox.katamari.api.Arr","ephox.sugar.api.node.Node","ephox.sugar.api.node.Text","ephox.sugar.api.search.Traverse"],function(e,t,n,o){var r=function(e){return"img"===t.name(e)?1:n.getOption(e).fold(function(){return o.children(e).length},function(e){return e.length})},i=["img","br"];return{getEnd:r,isEnd:function(e,t){return r(e)===t},isStart:function(e,t){return 0===t},isCursorPosition:function(o){var r;return r=o,n.getOption(r).filter(function(e){return 0!==e.trim().length||e.indexOf("")>-1}).isSome()||e.contains(i,t.name(o))}}}),o("ephox.sugar.api.selection.Situ",["ephox.katamari.api.Adt","ephox.katamari.api.Fun"],function(e,t){var n=e.generate([{before:["element"]},{on:["element","offset"]},{after:["element"]}]);return{before:n.before,on:n.on,after:n.after,cata:function(e,t,n,o){return e.fold(t,n,o)},getStart:function(e){return e.fold(t.identity,t.identity,t.identity)}}}),o("ephox.sugar.api.selection.Selection",["ephox.katamari.api.Adt","ephox.katamari.api.Struct","ephox.sugar.api.node.Element","ephox.sugar.api.search.Traverse","ephox.sugar.api.selection.Situ"],function(e,t,n,o,r){var i=e.generate([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),a=t.immutable("start","soffset","finish","foffset");return{domRange:i.domRange,relative:i.relative,exact:i.exact,exactFromRange:function(e){return i.exact(e.start(),e.soffset(),e.finish(),e.foffset())},range:a,getWin:function(e){var t,i=(t=e,t.match({domRange:function(e){return n.fromDom(e.startContainer)},relative:function(e,t){return r.getStart(e)},exact:function(e,t,n,o){return e}}));return o.defaultView(i)}}}),o("ephox.sugar.api.dom.DocumentPosition",["ephox.sugar.api.dom.Compare","ephox.sugar.api.node.Element","ephox.sugar.api.search.Traverse"],function(e,t,n){var o=function(e,t,o,r){var i=n.owner(e).dom().createRange();return i.setStart(e.dom(),t),i.setEnd(o.dom(),r),i};return{after:function(t,n,r,i){var a=o(t,n,r,i),u=e.eq(t,r)&&n===i;return a.collapsed&&!u},commonAncestorContainer:function(e,n,r,i){var a=o(e,n,r,i);return t.fromDom(a.commonAncestorContainer)}}}),o("ephox.sugar.api.node.Fragment",["ephox.katamari.api.Arr","ephox.sugar.api.node.Element","global!document"],function(e,t,n){return{fromElements:function(o,r){var i=(r||n).createDocumentFragment();return e.each(o,function(e){i.appendChild(e.dom())}),t.fromDom(i)}}}),o("ephox.sugar.selection.core.NativeRange",["ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.sugar.api.dom.Compare","ephox.sugar.api.node.Element"],function(e,t,n,o){var r=function(e,t){e.selectNodeContents(t.dom())},i=function(e){e.deleteContents()},a=function(t){return{left:e.constant(t.left),top:e.constant(t.top),right:e.constant(t.right),bottom:e.constant(t.bottom),width:e.constant(t.width),height:e.constant(t.height)}};return{create:function(e){return e.document.createRange()},replaceWith:function(e,t){i(e),e.insertNode(t.dom())},selectNodeContents:function(e,t){var n=e.document.createRange();return r(n,t),n},selectNodeContentsUsing:r,isCollapsed:function(e,t,o,r){return n.eq(e,o)&&t===r},relativeToNative:function(e,t,n){var o=e.document.createRange();r=o,t.fold(function(e){r.setStartBefore(e.dom())},function(e,t){r.setStart(e.dom(),t)},function(e){r.setStartAfter(e.dom())});var r;i=o,n.fold(function(e){i.setEndBefore(e.dom())},function(e,t){i.setEnd(e.dom(),t)},function(e){i.setEndAfter(e.dom())});var i;return o},exactToNative:function(e,t,n,o,r){var i=e.document.createRange();return i.setStart(t.dom(),n),i.setEnd(o.dom(),r),i},deleteContents:i,cloneFragment:function(e){var t=e.cloneContents();return o.fromDom(t)},getFirstRect:function(e){var n=e.getClientRects(),o=n.length>0?n[0]:e.getBoundingClientRect();return o.width>0||o.height>0?t.some(o).map(a):t.none()},getBounds:function(e){var n=e.getBoundingClientRect();return n.width>0||n.height>0?t.some(n).map(a):t.none()},isWithin:function(e,t){return t.compareBoundaryPoints(e.END_TO_START,e)<1&&t.compareBoundaryPoints(e.START_TO_END,e)>-1},toString:function(e){return e.toString()}}}),o("ephox.sugar.selection.core.SelectionDirection",["ephox.katamari.api.Adt","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.katamari.api.Thunk","ephox.sugar.api.node.Element","ephox.sugar.selection.core.NativeRange"],function(e,t,n,o,r,i){var a=e.generate([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),u=function(e,t,n){return t(r.fromDom(n.startContainer),n.startOffset,r.fromDom(n.endContainer),n.endOffset)},c=function(e,c){var s;return function(e,t){var n=t.ltr();if(n.collapsed)return t.rtl().filter(function(e){return!1===e.collapsed}).map(function(e){return a.rtl(r.fromDom(e.endContainer),e.endOffset,r.fromDom(e.startContainer),e.startOffset)}).getOrThunk(function(){return u(0,a.ltr,n)});return u(0,a.ltr,n)}(0,(s=e,c.match({domRange:function(e){return{ltr:t.constant(e),rtl:n.none}},relative:function(e,t){return{ltr:o.cached(function(){return i.relativeToNative(s,e,t)}),rtl:o.cached(function(){return n.some(i.relativeToNative(s,t,e))})}},exact:function(e,t,r,a){return{ltr:o.cached(function(){return i.exactToNative(s,e,t,r,a)}),rtl:o.cached(function(){return n.some(i.exactToNative(s,r,a,e,t))})}}})))};return{ltr:a.ltr,rtl:a.rtl,diagnose:c,asLtrRange:function(e,t){return c(e,t).match({ltr:function(t,n,o,r){var i=e.document.createRange();return i.setStart(t.dom(),n),i.setEnd(o.dom(),r),i},rtl:function(t,n,o,r){var i=e.document.createRange();return i.setStart(o.dom(),r),i.setEnd(t.dom(),n),i}})}}}),o("ephox.sugar.selection.alien.Geometry",["global!Math"],function(e){return{inRect:function(e,t,n){return t>=e.left&&t<=e.right&&n>=e.top&&n<=e.bottom},searchForPoint:function(t,n,o,r,i){if(0===i)return 0;if(n===r)return i-1;for(var a=r,u=1;u<i;u++){var c=t(u),s=e.abs(n-c.left);if(o>c.bottom);else{if(o<c.top||s>a)return u-1;a=s}}return 0}}}),o("ephox.sugar.selection.query.TextPoint",["ephox.katamari.api.Option","ephox.katamari.api.Options","ephox.sugar.api.node.Text","ephox.sugar.selection.alien.Geometry","global!Math"],function(e,t,n,o,r){return{locate:function(r,i,a,u){var c=r.dom().createRange();c.selectNode(i.dom());var s=c.getClientRects();return t.findMap(s,function(t){return o.inRect(t,a,u)?e.some(t):e.none()}).map(function(e){return function(e,t,r,i,a){var u=function(n){var o=e.dom().createRange();return o.setStart(t.dom(),n),o.collapse(!0),o},c=n.get(t).length,s=o.searchForPoint(function(e){return u(e).getBoundingClientRect()},r,i,a.right,c);return u(s)}(r,i,a,u,e)})}}}),o("ephox.sugar.selection.query.ContainerPoint",["ephox.katamari.api.Option","ephox.katamari.api.Options","ephox.sugar.api.node.Node","ephox.sugar.api.search.Traverse","ephox.sugar.selection.alien.Geometry","ephox.sugar.selection.query.TextPoint","global!Math"],function(e,t,n,o,r,i,a){var u=function(n,i,a,u){var s=n.dom().createRange(),l=o.children(i);return t.findMap(l,function(t){return s.selectNode(t.dom()),r.inRect(s.getBoundingClientRect(),a,u)?c(n,t,a,u):e.none()})},c=function(e,t,o,r){return(n.isText(t)?i.locate:u)(e,t,o,r)};return{locate:function(e,t,n,o){var r=e.dom().createRange();r.selectNode(t.dom());var i=r.getBoundingClientRect(),u=a.max(i.left,a.min(i.right,n)),s=a.max(i.top,a.min(i.bottom,o));return c(e,t,u,s)}}}),o("ephox.sugar.api.selection.CursorPosition",["ephox.katamari.api.Option","ephox.sugar.api.search.PredicateFind","ephox.sugar.api.search.Traverse","ephox.sugar.api.selection.Awareness"],function(e,t,n,o){var r=function(t,o){var r=function(t){for(var i=n.children(t),a=i.length-1;a>=0;a--){var u=i[a];if(o(u))return e.some(u);var c=r(u);if(c.isSome())return c}return e.none()};return r(t)};return{first:function(e){return t.descendant(e,o.isCursorPosition)},last:function(e){return r(e,o.isCursorPosition)}}}),o("ephox.sugar.selection.query.EdgePoint",["ephox.katamari.api.Option","ephox.sugar.api.search.Traverse","ephox.sugar.api.selection.CursorPosition"],function(e,t,n){var o=function(e,t){return t-e.left<e.right-t},r=function(e,t,n){var o=e.dom().createRange();return o.selectNode(t.dom()),o.collapse(n),o},i=function(e,t,i){var a=e.dom().createRange();a.selectNode(t.dom());var u=a.getBoundingClientRect(),c=o(u,i);return(!0===c?n.first:n.last)(t).map(function(t){return r(e,t,c)})},a=function(t,n,i){var a=n.dom().getBoundingClientRect(),u=o(a,i);return e.some(r(t,n,u))};return{search:function(e,n,o){return(0===t.children(n).length?a:i)(e,n,o)}}}),o("ephox.sugar.selection.query.CaretRange",["ephox.katamari.api.Option","ephox.sugar.api.node.Element","ephox.sugar.api.search.Traverse","ephox.sugar.api.selection.Selection","ephox.sugar.selection.query.ContainerPoint","ephox.sugar.selection.query.EdgePoint","global!document","global!Math"],function(e,t,n,o,r,i,a,u){var c=a.caretPositionFromPoint?function(t,n,o){return e.from(t.dom().caretPositionFromPoint(n,o)).bind(function(n){if(null===n.offsetNode)return e.none();var o=t.dom().createRange();return o.setStart(n.offsetNode,n.offset),o.collapse(),e.some(o)})}:a.caretRangeFromPoint?function(t,n,o){return e.from(t.dom().caretRangeFromPoint(n,o))}:function(e,o,a){return t.fromPoint(e,o,a).bind(function(t){var c=function(){return i.search(e,t,o)};return 0===n.children(t).length?c():function(e,t,n,o){var i=e.dom().createRange();i.selectNode(t.dom());var a=i.getBoundingClientRect(),c=u.max(a.left,u.min(a.right,n)),s=u.max(a.top,u.min(a.bottom,o));return r.locate(e,t,c,s)}(e,t,o,a).orThunk(c)})};return{fromPoint:function(e,n,r){var i=t.fromDom(e.document);return c(i,n,r).map(function(e){return o.range(t.fromDom(e.startContainer),e.startOffset,t.fromDom(e.endContainer),e.endOffset)})}}}),o("ephox.sugar.selection.query.Within",["ephox.katamari.api.Arr","ephox.sugar.api.node.Element","ephox.sugar.api.node.Node","ephox.sugar.api.search.SelectorFilter","ephox.sugar.api.search.Selectors","ephox.sugar.selection.core.NativeRange","ephox.sugar.selection.core.SelectionDirection"],function(e,t,n,o,r,i,a){return{find:function(u,c,s){var l=a.asLtrRange(u,c),p=t.fromDom(l.commonAncestorContainer);return n.isElement(p)?function(t,n,a,u){var c=i.create(t),s=(r.is(n,u)?[n]:[]).concat(o.descendants(n,u));return e.filter(s,function(e){return i.selectNodeContentsUsing(c,e),i.isWithin(a,c)})}(u,p,l,s):[]}}}),o("ephox.sugar.selection.quirks.Prefilter",["ephox.katamari.api.Arr","ephox.sugar.api.node.Element","ephox.sugar.api.node.Node","ephox.sugar.api.selection.Selection","ephox.sugar.api.selection.Situ"],function(e,t,n,o,r){var i=function(t,o){var i=n.name(t);return"input"===i?r.after(t):e.contains(["br","img"],i)?0===o?r.before(t):r.after(t):r.on(t,o)},a=function(e,t){var n=e.fold(r.before,i,r.after),a=t.fold(r.before,i,r.after);return o.relative(n,a)},u=function(e,t,n,r){var a=i(e,t),u=i(n,r);return o.relative(a,u)};return{beforeSpecial:i,preprocess:function(e){return e.match({domRange:function(e){var n=t.fromDom(e.startContainer),o=t.fromDom(e.endContainer);return u(n,e.startOffset,o,e.endOffset)},relative:a,exact:u})},preprocessRelative:a,preprocessExact:u}}),o("ephox.sugar.api.selection.WindowSelection",["ephox.katamari.api.Option","ephox.sugar.api.dom.DocumentPosition","ephox.sugar.api.node.Element","ephox.sugar.api.node.Fragment","ephox.sugar.api.search.Traverse","ephox.sugar.api.selection.Selection","ephox.sugar.selection.core.NativeRange","ephox.sugar.selection.core.SelectionDirection","ephox.sugar.selection.query.CaretRange","ephox.sugar.selection.query.Within","ephox.sugar.selection.quirks.Prefilter"],function(e,t,n,o,r,i,a,u,c,s,l){var p=function(t,n){e.from(t.getSelection()).each(function(e){e.removeAllRanges(),e.addRange(n)})},f=function(e,t,n,o,r){var i=a.exactToNative(e,t,n,o,r);p(e,i)},m=function(e,t){return u.diagnose(e,t).match({ltr:function(t,n,o,r){f(e,t,n,o,r)},rtl:function(t,n,o,r){var i=e.getSelection();i.extend?(i.collapse(t.dom(),n),i.extend(o.dom(),r)):f(e,o,r,t,n)}})},d=function(o){var r=n.fromDom(o.anchorNode),a=n.fromDom(o.focusNode);return t.after(r,o.anchorOffset,a,o.focusOffset)?e.some(i.range(n.fromDom(o.anchorNode),o.anchorOffset,n.fromDom(o.focusNode),o.focusOffset)):function(t){if(t.rangeCount>0){var o=t.getRangeAt(0),r=t.getRangeAt(t.rangeCount-1);return e.some(i.range(n.fromDom(o.startContainer),o.startOffset,n.fromDom(r.endContainer),r.endOffset))}return e.none()}(o)},h=function(t){var n=t.getSelection();return n.rangeCount>0?d(n):e.none()};return{setExact:function(e,t,n,o,r){var i=l.preprocessExact(t,n,o,r);m(e,i)},getExact:h,get:function(e){return h(e).map(function(e){return i.exact(e.start(),e.soffset(),e.finish(),e.foffset())})},setRelative:function(e,t,n){var o=l.preprocessRelative(t,n);m(e,o)},toNative:function(e){var t=i.getWin(e).dom(),n=function(e,n,o,r){return a.exactToNative(t,e,n,o,r)},o=l.preprocess(e);return u.diagnose(t,o).match({ltr:n,rtl:n})},setToElement:function(e,t){var n=a.selectNodeContents(e,t);p(e,n)},clear:function(e){e.getSelection().removeAllRanges()},clone:function(e,t){var n=u.asLtrRange(e,t);return a.cloneFragment(n)},replace:function(e,t,n){var r=u.asLtrRange(e,t),i=o.fromElements(n,e.document);a.replaceWith(r,i)},deleteAt:function(e,t){var n=u.asLtrRange(e,t);a.deleteContents(n)},forElement:function(e,t){var o=a.selectNodeContents(e,t);return i.range(n.fromDom(o.startContainer),o.startOffset,n.fromDom(o.endContainer),o.endOffset)},getFirstRect:function(e,t){var n=u.asLtrRange(e,t);return a.getFirstRect(n)},getBounds:function(e,t){var n=u.asLtrRange(e,t);return a.getBounds(n)},getAtPoint:function(e,t,n){return c.fromPoint(e,t,n)},findWithin:function(e,t,n){return s.find(e,t,n)},getAsString:function(e,t){var n=u.asLtrRange(e,t);return a.toString(n)}}}),o("tinymce.themes.mobile.util.Rectangles",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.sugar.api.node.Element","ephox.sugar.api.search.Traverse","ephox.sugar.api.selection.Awareness","ephox.sugar.api.selection.Selection","ephox.sugar.api.selection.WindowSelection"],function(e,t,n,o,r,i,a){var u=function(e){return{left:e.left,top:e.top,right:e.right,bottom:e.bottom,width:t.constant(2),height:e.height}},c=function(e){return{left:t.constant(e.left),top:t.constant(e.top),right:t.constant(e.right),bottom:t.constant(e.bottom),width:t.constant(e.width),height:t.constant(e.height)}};return{getRectangles:function(t){var s=t.getSelection();return void 0!==s&&s.rangeCount>0?function(t){if(t.collapsed){var s=n.fromDom(t.startContainer);return o.parent(s).bind(function(n){var o=i.exact(s,t.startOffset,n,r.getEnd(n));return a.getFirstRect(t.startContainer.ownerDocument.defaultView,o).map(u).map(e.pure)}).getOr([])}return e.map(t.getClientRects(),c)}(s.getRangeAt(0)):[]}}}),o("tinymce.themes.mobile.android.core.AndroidSetup",["ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.sugar.api.events.DomEvent","ephox.sugar.api.node.Element","ephox.sugar.api.properties.Attr","global!Math","tinymce.themes.mobile.android.focus.ResumeEditing","tinymce.themes.mobile.style.Styles","tinymce.themes.mobile.util.DataAttributes","tinymce.themes.mobile.util.Rectangles"],function(e,t,n,o,r,i,a,u,c,s){var l="data-"+u.resolve("last-outer-height"),p=function(e,t){r.set(e,l,t)},f=function(t){return{top:e.constant(t.top()),bottom:e.constant(t.top()+t.height())}},m=function(e,n){var o,r=(o=n,c.safeParse(o,l)),i=e.innerHeight;return r>i?t.some(r-i):t.none()};return{setup:function(e,r){var u=o.fromDom(r.document.body),c=n.bind(o.fromDom(e),"resize",function(){m(e,u).each(function(e){(function(e){var n=s.getRectangles(e);return n.length>0?t.some(n[0]).map(f):t.none()})(r).each(function(t){var n,o,a,u=(n=r,o=t,a=e,o.top()>n.innerHeight||o.bottom()>n.innerHeight?i.min(a,o.bottom()-n.innerHeight+50):0);0!==u&&r.scrollTo(r.pageXOffset,r.pageYOffset+u)})}),p(u,e.innerHeight)});p(u,e.innerHeight);return{toEditing:function(){a.resume(r)},destroy:function(){c.unbind()}}}}}),o("tinymce.themes.mobile.ios.core.PlatformEditor",["ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.sugar.api.dom.Compare","ephox.sugar.api.events.DomEvent","ephox.sugar.api.node.Element","ephox.sugar.api.selection.WindowSelection"],function(e,t,n,o,r,i){var a=function(e){return t.some(r.fromDom(e.dom().contentWindow.document.body))},u=function(e){return t.some(r.fromDom(e.dom().contentWindow.document))},c=function(e){return t.from(e.dom().contentWindow)},s=function(e){return c(e).bind(i.getExact)},l=function(e){return e.getFrame()},p=function(e,t){return function(n){return n[e].getOrThunk(function(){var e=l(n);return function(){return t(e)}})()}},f=function(e,t,n,r){return e[n].getOrThunk(function(){return function(e){return o.bind(t,r,e)}})},m=function(t){return{left:e.constant(t.left),top:e.constant(t.top),right:e.constant(t.right),bottom:e.constant(t.bottom),width:e.constant(t.width),height:e.constant(t.height)}};return{getBody:p("getBody",a),getDoc:p("getDoc",u),getWin:p("getWin",c),getSelection:p("getSelection",s),getFrame:l,getActiveApi:function(o){var p=l(o);return a(p).bind(function(a){return u(p).bind(function(u){return c(p).map(function(c){var l=r.fromDom(u.dom().documentElement),d=o.getCursorBox.getOrThunk(function(){return function(){return i.get(c).bind(function(e){return i.getFirstRect(c,e).orThunk(function(){return e=c,i.getExact(e).filter(function(e){return n.eq(e.start(),e.finish())&&e.soffset()===e.foffset()}).bind(function(e){var n=e.start().dom().getBoundingClientRect();return n.width>0||n.height>0?t.some(n).map(m):t.none()});var e})})}}),h=o.setSelection.getOrThunk(function(){return function(e,t,n,o){i.setExact(c,e,t,n,o)}}),g=o.clearSelection.getOrThunk(function(){return function(){i.clear(c)}});return{body:e.constant(a),doc:e.constant(u),win:e.constant(c),html:e.constant(l),getSelection:e.curry(s,p),setSelection:h,clearSelection:g,frame:e.constant(p),onKeyup:f(o,u,"onKeyup","keyup"),onNodeChanged:f(o,u,"onNodeChanged","selectionchange"),onDomChanged:o.onDomChanged,onScrollToCursor:o.onScrollToCursor,onScrollToElement:o.onScrollToElement,onToReading:o.onToReading,onToEditing:o.onToEditing,onToolbarScrollStart:o.onToolbarScrollStart,onTouchContent:o.onTouchContent,onTapContent:o.onTapContent,onTouchToolstrip:o.onTouchToolstrip,getCursorBox:d}})})})}}}),o("tinymce.themes.mobile.util.Thor",["ephox.katamari.api.Arr","ephox.sand.api.PlatformDetection","ephox.sugar.api.properties.Attr","ephox.sugar.api.properties.Css","ephox.sugar.api.search.SelectorFilter"],function(e,t,n,o,r){var i="data-ephox-mobile-fullscreen-style",a="position:absolute!important;",u="top:0!important;left:0!important;margin:0!important;padding:0!important;width:100%!important;",c=t.detect().os.isAndroid();return{clobberStyles:function(t,s){var l=function(e){return function(t){var o=n.get(t,"style"),r=void 0===o?"no-styles":o.trim();r!==e&&(n.set(t,i,r),n.set(t,"style",e))}},p=r.ancestors(t,"*"),f=e.bind(p,function(e){return r.siblings(e,"*")}),m=function(e){var t=o.get(e,"background-color");return void 0!==t&&""!==t?"background-color:"+t+"!important":"background-color:rgb(255,255,255)!important;"}(s);e.each(f,l("display:none!important;")),e.each(p,l(a+u+m));l((!0===c?"":a)+u+m)(t)},restoreStyles:function(){var t=r.all("["+i+"]");e.each(t,function(e){var t=n.get(e,i);"no-styles"!==t?n.set(e,"style",t):n.remove(e,"style"),n.remove(e,i)})}}}),o("tinymce.themes.mobile.touch.view.MetaViewport",["ephox.sugar.api.dom.Insert","ephox.sugar.api.node.Element","ephox.sugar.api.properties.Attr","ephox.sugar.api.search.SelectorFind"],function(e,t,n,o){return{tag:function(){var r=o.first("head").getOrDie(),i=o.first('meta[name="viewport"]').getOrThunk(function(){var o=t.fromTag("meta");return n.set(o,"name","viewport"),e.append(r,o),o}),a=n.get(i,"content");return{maximize:function(){n.set(i,"content","width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0")},restore:function(){void 0!==a&&null!==a&&a.length>0?n.set(i,"content",a):n.set(i,"content","user-scalable=yes")}}}}}),o("tinymce.themes.mobile.android.core.AndroidMode",["ephox.katamari.api.Singleton","ephox.sugar.api.properties.Class","tinymce.themes.mobile.android.core.AndroidEvents","tinymce.themes.mobile.android.core.AndroidSetup","tinymce.themes.mobile.ios.core.PlatformEditor","tinymce.themes.mobile.util.Thor","tinymce.themes.mobile.style.Styles","tinymce.themes.mobile.touch.view.MetaViewport"],function(e,t,n,o,r,i,a,u){return{create:function(c,s){var l=u.tag(),p=e.api(),f=e.api();return{enter:function(){s.hide(),t.add(c.container,a.resolve("fullscreen-maximized")),t.add(c.container,a.resolve("android-maximized")),l.maximize(),t.add(c.body,a.resolve("android-scroll-reload")),p.set(o.setup(c.win,r.getWin(c.editor).getOrDie("no"))),r.getActiveApi(c.editor).each(function(e){i.clobberStyles(c.container,e.body()),f.set(n.initEvents(e,c.toolstrip,c.alloy))})},exit:function(){l.restore(),s.show(),t.remove(c.container,a.resolve("fullscreen-maximized")),t.remove(c.container,a.resolve("android-maximized")),i.restoreStyles(),t.remove(c.body,a.resolve("android-scroll-reload")),f.clear(),p.clear()}}}}}),o("tinymce.themes.mobile.api.MobileSchema",["ephox.boulder.api.FieldSchema","ephox.boulder.api.ValueSchema","ephox.katamari.api.Fun","ephox.sugar.api.node.Element","ephox.sugar.api.search.Traverse","global!window"],function(e,t,n,o,r,i){return t.objOf([e.strictObjOf("editor",[e.strict("getFrame"),e.option("getBody"),e.option("getDoc"),e.option("getWin"),e.option("getSelection"),e.option("setSelection"),e.option("clearSelection"),e.option("cursorSaver"),e.option("onKeyup"),e.option("onNodeChanged"),e.option("getCursorBox"),e.strict("onDomChanged"),e.defaulted("onTouchContent",n.noop),e.defaulted("onTapContent",n.noop),e.defaulted("onTouchToolstrip",n.noop),e.defaulted("onScrollToCursor",n.constant({unbind:n.noop})),e.defaulted("onScrollToElement",n.constant({unbind:n.noop})),e.defaulted("onToEditing",n.constant({unbind:n.noop})),e.defaulted("onToReading",n.constant({unbind:n.noop})),e.defaulted("onToolbarScrollStart",n.identity)]),e.strict("socket"),e.strict("toolstrip"),e.strict("dropup"),e.strict("toolbar"),e.strict("container"),e.strict("alloy"),e.state("win",function(e){return r.owner(e.socket).dom().defaultView}),e.state("body",function(e){return o.fromDom(e.socket.dom().ownerDocument.body)}),e.defaulted("translate",n.identity),e.defaulted("setReadOnly",n.noop)])}),o("ephox.katamari.api.Throttler",["global!clearTimeout","global!setTimeout"],function(e,t){return{adaptable:function(n,o){var r=null,i=null;return{cancel:function(){null!==r&&(e(r),r=null,i=null)},throttle:function(){i=arguments,null===r&&(r=t(function(){n.apply(null,i),r=null,i=null},o))}}},first:function(n,o){var r=null;return{cancel:function(){null!==r&&(e(r),r=null)},throttle:function(){var e=arguments;null===r&&(r=t(function(){n.apply(null,e),r=null,e=null},o))}}},last:function(n,o){var r=null;return{cancel:function(){null!==r&&(e(r),r=null)},throttle:function(){var i=arguments;null!==r&&e(r),r=t(function(){n.apply(null,i),r=null,i=null},o)}}}}}),o("tinymce.themes.mobile.touch.view.TapToEditMask",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.api.behaviour.Toggling","ephox.alloy.api.component.Memento","ephox.alloy.api.ui.Button","ephox.alloy.api.ui.Container","ephox.katamari.api.Throttler","global!setTimeout","tinymce.themes.mobile.style.Styles","tinymce.themes.mobile.util.UiDomFactory"],function(e,t,n,o,r,i,a,u,c){return{sketch:function(a,s){var l=n.record(r.sketch({dom:c.dom('<div aria-hidden="true" class="${prefix}-mask-tap-icon"></div>'),containerBehaviours:e.derive([t.config({toggleClass:u.resolve("mask-tap-icon-selected"),toggleOnExecute:!1})])})),p=i.first(a,200);return r.sketch({dom:c.dom('<div class="${prefix}-disabled-mask"></div>'),components:[r.sketch({dom:c.dom('<div class="${prefix}-content-container"></div>'),components:[o.sketch({dom:c.dom('<div class="${prefix}-content-tap-section"></div>'),components:[l.asSpec()],action:function(e){p.throttle()},buttonBehaviours:e.derive([t.config({toggleClass:u.resolve("mask-tap-icon-selected")})])})]})]})}}}),o("tinymce.themes.mobile.api.AndroidWebapp",["ephox.alloy.api.component.GuiFactory","ephox.boulder.api.ValueSchema","ephox.katamari.api.Fun","ephox.sugar.api.dom.Insert","ephox.sugar.api.properties.Css","tinymce.themes.mobile.android.core.AndroidMode","tinymce.themes.mobile.api.MobileSchema","tinymce.themes.mobile.touch.view.TapToEditMask"],function(e,t,n,o,r,i,a,u){return{produce:function(c){var s=t.asRawOrDie("Getting AndroidWebapp schema",a,c);r.set(s.toolstrip,"width","100%");var l=e.build(u.sketch(function(){s.setReadOnly(!0),f.enter()},s.translate));s.alloy.add(l);var p={show:function(){s.alloy.add(l)},hide:function(){s.alloy.remove(l)}};o.append(s.container,l.element());var f=i.create(s,p);return{setReadOnly:s.setReadOnly,refreshStructure:n.noop,enter:f.enter,exit:f.exit,destroy:n.noop}}}}),o("ephox.alloy.ui.schema.ToolbarSchema",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.api.behaviour.Replacing","ephox.alloy.data.Fields","ephox.alloy.parts.PartType","ephox.boulder.api.FieldSchema","ephox.katamari.api.Fun"],function(e,t,n,o,r,i){var a=[r.defaulted("shell",!0),r.defaulted("toolbarBehaviours",{})],u=[o.optional({name:"groups",overrides:function(n){return{behaviours:e.derive([t.config({})])}}})];return{name:i.constant("Toolbar"),schema:i.constant(a),parts:i.constant(u)}}),o("ephox.alloy.api.ui.Toolbar",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.api.behaviour.Replacing","ephox.alloy.api.ui.Sketcher","ephox.alloy.parts.AlloyParts","ephox.alloy.ui.schema.ToolbarSchema","ephox.katamari.api.Merger","ephox.katamari.api.Option","global!console","global!Error"],function(e,t,n,o,r,i,a,u,c){return n.composite({name:"Toolbar",configFields:r.schema(),partFields:r.parts(),factory:function(n,r,s,l){var p=function(e){return n.shell()?a.some(e):o.getPart(e,n,"groups")},f=n.shell()?{behaviours:[t.config({})],components:[]}:{behaviours:[],components:r};return{uid:n.uid(),dom:n.dom(),components:f.components,behaviours:i.deepMerge(e.derive(f.behaviours),n.toolbarBehaviours()),apis:{setGroups:function(e,n){p(e).fold(function(){throw u.error("Toolbar was defined to not be a shell, but no groups container was specified in components"),new c("Toolbar was defined to not be a shell, but no groups container was specified in components")},function(e){t.set(e,n)})}},domModification:{attributes:{role:"group"}}}},apis:{setGroups:function(e,t,n){e.setGroups(t,n)}}})}),o("ephox.alloy.ui.schema.ToolbarGroupSchema",["ephox.alloy.data.Fields","ephox.alloy.parts.PartType","ephox.boulder.api.FieldSchema","ephox.katamari.api.Fun"],function(e,t,n,o){var r=[n.strict("items"),e.markers(["itemClass"]),n.defaulted("hasTabstop",!0),n.defaulted("tgroupBehaviours",{})],i=[t.group({name:"items",unit:"item",overrides:function(e){return{domModification:{classes:[e.markers().itemClass()]}}}})];return{name:o.constant("ToolbarGroup"),schema:o.constant(r),parts:o.constant(i)}}),o("ephox.alloy.api.ui.ToolbarGroup",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.api.behaviour.Keying","ephox.alloy.api.behaviour.Tabstopping","ephox.alloy.api.ui.Sketcher","ephox.alloy.ui.schema.ToolbarGroupSchema","ephox.katamari.api.Merger","global!Error"],function(e,t,n,o,r,i,a){return o.composite({name:"ToolbarGroup",configFields:r.schema(),partFields:r.parts(),factory:function(o,r,a,u){return i.deepMerge({dom:{attributes:{role:"toolbar"}}},{uid:o.uid(),dom:o.dom(),components:r,behaviours:i.deepMerge(e.derive([t.config({mode:"flow",selector:"."+o.markers().itemClass()}),o.hasTabstop()?n.config({}):n.revoke()]),o.tgroupBehaviours()),"debug.sketcher":a["debug.sketcher"]})}})}),o("tinymce.themes.mobile.ios.scroll.Scrollables",["ephox.katamari.api.Fun","ephox.sugar.api.events.DomEvent","ephox.sugar.api.properties.Attr","ephox.sugar.api.search.SelectorFind","tinymce.themes.mobile.style.Styles"],function(e,t,n,o,r){var i="data-"+r.resolve("horizontal-scroll"),a=function(e){return e.dom().scrollTop>0||function(e){e.dom().scrollTop=1;var t=0!==e.dom().scrollTop;return e.dom().scrollTop=0,t}(e)},u=function(e){return e.dom().scrollLeft>0||function(e){e.dom().scrollLeft=1;var t=0!==e.dom().scrollLeft;return e.dom().scrollLeft=0,t}(e)},c=function(e){return"true"===n.get(e,i)?u:a};return{exclusive:function(n,r){return t.bind(n,"touchmove",function(t){o.closest(t.target(),r).filter(c).fold(function(){t.raw().preventDefault()},e.noop)})},markAsHorizontal:function(e){n.set(e,i,"true")}}}),o("tinymce.themes.mobile.toolbar.ScrollingToolbar",["ephox.alloy.api.behaviour.AddEventsBehaviour","ephox.alloy.api.behaviour.Behaviour","ephox.alloy.api.behaviour.Keying","ephox.alloy.api.behaviour.Toggling","ephox.alloy.api.component.GuiFactory","ephox.alloy.api.events.AlloyEvents","ephox.alloy.api.ui.Container","ephox.alloy.api.ui.Toolbar","ephox.alloy.api.ui.ToolbarGroup","ephox.katamari.api.Arr","ephox.katamari.api.Cell","ephox.katamari.api.Fun","ephox.sugar.api.properties.Css","tinymce.themes.mobile.ios.scroll.Scrollables","tinymce.themes.mobile.style.Styles","tinymce.themes.mobile.touch.scroll.Scrollable","tinymce.themes.mobile.util.UiDomFactory"],function(e,t,n,o,r,i,a,u,c,s,l,p,f,m,d,h,g){return function(){var v=function(n){var o=!0===n.scrollable?"${prefix}-toolbar-scrollable-group":"";return{dom:g.dom('<div aria-label="'+n.label+'" class="${prefix}-toolbar-group '+o+'"></div>'),tgroupBehaviours:t.derive([e.config("adhoc-scrollable-toolbar",!0===n.scrollable?[i.runOnInit(function(e,t){f.set(e.element(),"overflow-x","auto"),m.markAsHorizontal(e.element()),h.register(e.element())})]:[])]),components:[a.sketch({components:[c.parts().items({})]})],markers:{itemClass:d.resolve("toolbar-group-item")},items:n.items}},x=r.build(u.sketch({dom:g.dom('<div class="${prefix}-toolbar"></div>'),components:[u.parts().groups({})],toolbarBehaviours:t.derive([o.config({toggleClass:d.resolve("context-toolbar"),toggleOnExecute:!1,aria:{mode:"none"}}),n.config({mode:"cyclic"})]),shell:!0})),y=r.build(a.sketch({dom:{classes:[d.resolve("toolstrip")]},components:[r.premade(x)],containerBehaviours:t.derive([o.config({toggleClass:d.resolve("android-selection-context-toolbar"),toggleOnExecute:!1})])})),b=function(){u.setGroups(x,k.get()),o.off(x)},k=l([]);return{wrapper:p.constant(y),toolbar:p.constant(x),createGroups:function(e){return s.map(e,p.compose(c.sketch,v))},setGroups:function(e){k.set(e),b()},setContextToolbar:function(e){o.on(x),u.setGroups(x,e)},restoreToolbar:function(){o.isOn(x)&&b()},refresh:function(){u.refresh(x)},focus:function(){n.focusIn(x)}}}}),o("tinymce.themes.mobile.ui.CommonRealm",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.api.behaviour.Replacing","ephox.alloy.api.behaviour.Swapping","ephox.alloy.api.component.GuiFactory","ephox.alloy.api.ui.Button","ephox.alloy.api.ui.Container","ephox.katamari.api.Fun","ephox.sugar.api.properties.Class","tinymce.themes.mobile.style.Styles","tinymce.themes.mobile.util.UiDomFactory"],function(e,t,n,o,r,i,a,u,c,s){var l=function(e,n){t.append(e,o.premade(n))},p=function(e,n){t.remove(e,n)};return{makeEditSwitch:function(e){return o.build(r.sketch({dom:s.dom('<div class="${prefix}-mask-edit-icon ${prefix}-icon"></div>'),action:function(){e.run(function(e){e.setReadOnly(!1)})}}))},makeSocket:function(){return o.build(i.sketch({dom:s.dom('<div class="${prefix}-editor-socket"></div>'),components:[],containerBehaviours:e.derive([t.config({})])}))},updateMode:function(e,t,o,r){(!0===o?n.toAlpha:n.toOmega)(r);(o?l:p)(e,t)}}}),o("ephox.alloy.behaviour.sliding.SlidingApis",["ephox.sugar.api.properties.Class","ephox.sugar.api.properties.Classes","ephox.sugar.api.properties.Css"],function(e,t,n){var o=function(e,t){return t.getAnimationRoot().fold(function(){return e.element()},function(t){return t(e)})},r=function(e){return e.dimension().property()},i=function(e,t){return e.dimension().getDimension()(t)},a=function(e,n){var r=o(e,n);t.remove(r,[n.shrinkingClass(),n.growingClass()])},u=function(t,o){e.remove(t.element(),o.openClass()),e.add(t.element(),o.closedClass()),n.set(t.element(),r(o),"0px"),n.reflow(t.element())},c=function(t,o){e.remove(t.element(),o.closedClass()),e.add(t.element(),o.openClass()),n.remove(t.element(),r(o))},s=function(t,a,c){c.setCollapsed(),n.set(t.element(),r(a),i(a,t.element())),n.reflow(t.element());var s=o(t,a);e.add(s,a.shrinkingClass()),u(t,a),a.onStartShrink()(t)},l=function(t,a,s){var l=function(e,t){c(e,t);var n=i(t,e.element());return u(e,t),n}(t,a),p=o(t,a);e.add(p,a.growingClass()),c(t,a),n.set(t.element(),r(a),l),s.setExpanded(),a.onStartGrow()(t)},p=function(t,n,r){var i=o(t,n);return!0===e.has(i,n.growingClass())},f=function(t,n,r){var i=o(t,n);return!0===e.has(i,n.shrinkingClass())};return{grow:function(e,t,n){n.isExpanded()||l(e,t,n)},shrink:function(e,t,n){n.isExpanded()&&s(e,t,n)},immediateShrink:function(e,t,o){o.isExpanded()&&(c=e,s=t,l=o,l.setCollapsed(),n.set(c.element(),r(s),i(s,c.element())),n.reflow(c.element()),a(c,s),u(c,s),s.onStartShrink()(c),s.onShrunk()(c));var c,s,l},hasGrown:function(e,t,n){return n.isExpanded()},hasShrunk:function(e,t,n){return n.isCollapsed()},isGrowing:p,isShrinking:f,isTransitioning:function(e,t,n){return!0===p(e,t)||!0===f(e,t)},toggleGrow:function(e,t,n){(n.isExpanded()?s:l)(e,t,n)},disableTransitions:a}}),o("ephox.alloy.behaviour.sliding.ActiveSliding",["ephox.alloy.api.events.AlloyEvents","ephox.alloy.api.events.NativeEvents","ephox.alloy.behaviour.sliding.SlidingApis","ephox.alloy.dom.DomModification","ephox.boulder.api.Objects","ephox.sugar.api.properties.Css"],function(e,t,n,o,r,i){return{exhibit:function(e,t){return t.expanded()?o.nu({classes:[t.openClass()],styles:{}}):o.nu({classes:[t.closedClass()],styles:r.wrap(t.dimension().property(),"0px")})},events:function(o,r){return e.derive([e.run(t.transitionend(),function(e,t){t.event().raw().propertyName===o.dimension().property()&&(n.disableTransitions(e,o,r),r.isExpanded()&&i.remove(e.element(),o.dimension().property()),(r.isExpanded()?o.onGrown():o.onShrunk())(e,t))})])}}}),o("ephox.alloy.behaviour.sliding.SlidingSchema",["ephox.alloy.data.Fields","ephox.boulder.api.FieldSchema","ephox.boulder.api.ValueSchema","ephox.sugar.api.view.Height","ephox.sugar.api.view.Width"],function(e,t,n,o,r){return[t.strict("closedClass"),t.strict("openClass"),t.strict("shrinkingClass"),t.strict("growingClass"),t.option("getAnimationRoot"),e.onHandler("onShrunk"),e.onHandler("onStartShrink"),e.onHandler("onGrown"),e.onHandler("onStartGrow"),t.defaulted("expanded",!1),t.strictOf("dimension",n.choose("property",{width:[e.output("property","width"),e.output("getDimension",function(e){return r.get(e)+"px"})],height:[e.output("property","height"),e.output("getDimension",function(e){return o.get(e)+"px"})]}))]}),o("ephox.alloy.behaviour.sliding.SlidingState",["ephox.alloy.behaviour.common.BehaviourState","ephox.katamari.api.Cell","ephox.katamari.api.Fun"],function(e,t,n){return{init:function(o){var r=t(o.expanded());return e({isExpanded:function(){return!0===r.get()},isCollapsed:function(){return!1===r.get()},setCollapsed:n.curry(r.set,!1),setExpanded:n.curry(r.set,!0),readState:function(){return"expanded: "+r.get()}})}}}),o("ephox.alloy.api.behaviour.Sliding",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.behaviour.sliding.ActiveSliding","ephox.alloy.behaviour.sliding.SlidingApis","ephox.alloy.behaviour.sliding.SlidingSchema","ephox.alloy.behaviour.sliding.SlidingState"],function(e,t,n,o,r){return e.create({fields:o,name:"sliding",active:t,apis:n,state:r})}),o("tinymce.themes.mobile.ui.Dropup",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.api.behaviour.Replacing","ephox.alloy.api.behaviour.Sliding","ephox.alloy.api.component.GuiFactory","ephox.alloy.api.ui.Container","ephox.katamari.api.Fun","global!window","tinymce.themes.mobile.channels.Receivers","tinymce.themes.mobile.style.Styles"],function(e,t,n,o,r,i,a,u,c){return{build:function(s,l){var p=o.build(r.sketch({dom:{tag:"div",classes:c.resolve("dropup")},components:[],containerBehaviours:e.derive([t.config({}),n.config({closedClass:c.resolve("dropup-closed"),openClass:c.resolve("dropup-open"),shrinkingClass:c.resolve("dropup-shrinking"),growingClass:c.resolve("dropup-growing"),dimension:{property:"height"},onShrunk:function(e){s(),l(),t.set(e,[])},onGrown:function(e){s(),l()}}),u.orientation(function(e,t){f(i.noop)})])})),f=function(e){a.requestAnimationFrame(function(){e(),n.shrink(p)})};return{appear:function(e,o,r){!0===n.hasShrunk(p)&&!1===n.isTransitioning(p)&&a.requestAnimationFrame(function(){o(r),t.set(p,[e()]),n.grow(p)})},disappear:f,component:i.constant(p),element:p.element}}}}),o("ephox.alloy.events.GuiEvents",["ephox.alloy.alien.Keys","ephox.alloy.api.events.SystemEvents","ephox.alloy.events.TapEvent","ephox.boulder.api.FieldSchema","ephox.boulder.api.ValueSchema","ephox.katamari.api.Arr","ephox.sand.api.PlatformDetection","ephox.sugar.api.events.DomEvent","ephox.sugar.api.node.Node","ephox.sugar.api.search.Traverse","global!setTimeout"],function(e,t,n,o,r,i,a,u,c,s,l){var p=a.detect().browser.isFirefox(),f=r.objOfOnly([o.strictFunction("triggerEvent"),o.strictFunction("broadcastEvent"),o.defaulted("stopBackspace",!0)]);return{setup:function(o,m){var d,h,g,v,x=r.asRawOrDie("Getting GUI events settings",f,m),y=a.detect().deviceType.isTouch()?["touchstart","touchmove","touchend","gesturestart"]:["mousedown","mouseup","mouseover","mousemove","mouseout","click"],b=n.monitor(x),k=i.map(y.concat(["selectstart","input","contextmenu","change","transitionend","dragstart","dragover","drop"]),function(e){return u.bind(o,e,function(t){b.fireIfReady(t,e).each(function(e){e&&t.kill()}),x.triggerEvent(e,t)&&t.kill()})}),S=u.bind(o,"keydown",function(t){x.triggerEvent("keydown",t)?t.kill():!0!==x.stopBackspace||(n=t,n.raw().which!==e.BACKSPACE()[0]||i.contains(["input","textarea"],c.name(n.target())))||t.prevent();var n}),O=(d=o,h=function(e){x.triggerEvent("focusin",e)&&e.kill()},p?u.capture(d,"focus",h):u.bind(d,"focusin",h)),T=(g=o,v=function(e){x.triggerEvent("focusout",e)&&e.kill(),l(function(){x.triggerEvent(t.postBlur(),e)},0)},p?u.capture(g,"blur",v):u.bind(g,"focusout",v)),w=s.defaultView(o),E=u.bind(w,"scroll",function(e){x.broadcastEvent(t.windowScroll(),e)&&e.kill()});return{unbind:function(){i.each(k,function(e){e.unbind()}),S.unbind(),O.unbind(),T.unbind(),E.unbind()}}}}}),o("ephox.alloy.events.EventSource",["ephox.boulder.api.Objects","ephox.katamari.api.Cell"],function(e,t){return{derive:function(n,o){var r=e.readOptFrom(n,"target").map(function(e){return e()}).getOr(o);return t(r)}}}),o("ephox.alloy.events.SimulatedEvent",["ephox.katamari.api.Cell","ephox.katamari.api.Fun","global!Error"],function(e,t,n){var o=function(n,o){var r=e(!1),i=e(!1);return{stop:function(){r.set(!0)},cut:function(){i.set(!0)},isStopped:r.get,isCut:i.get,event:t.constant(n),setSource:o.set,getSource:o.get}};return{fromSource:o,fromExternal:function(o){var r=e(!1);return{stop:function(){r.set(!0)},cut:t.noop,isStopped:r.get,isCut:t.constant(!1),event:t.constant(o),setTarget:t.die(new n("Cannot set target of a broadcasted event")),getTarget:t.die(new n("Cannot get target of a broadcasted event"))}},fromTarget:function(t,n){var r=e(n);return o(t,r)}}}),o("ephox.alloy.events.Triggers",["ephox.alloy.events.DescribedHandler","ephox.alloy.events.EventSource","ephox.alloy.events.SimulatedEvent","ephox.katamari.api.Adt","ephox.katamari.api.Arr","ephox.sugar.api.search.Traverse","global!Error"],function(e,t,n,o,r,i,a){var u=o.generate([{stopped:[]},{resume:["element"]},{complete:[]}]),c=function(t,o,r,a,c,s){var l=t(o,a),p=n.fromSource(r,c);return l.fold(function(){return s.logEventNoHandlers(o,a),u.complete()},function(t){var n=t.descHandler();return e.getHandler(n)(p),p.isStopped()?(s.logEventStopped(o,t.element(),n.purpose()),u.stopped()):p.isCut()?(s.logEventCut(o,t.element(),n.purpose()),u.complete()):i.parent(t.element()).fold(function(){return s.logNoParent(o,t.element(),n.purpose()),u.complete()},function(e){return s.logEventResponse(o,t.element(),n.purpose()),u.resume(e)})})},s=function(e,t,n,o,r,i){return c(e,t,n,o,r,i).fold(function(){return!0},function(o){return s(e,t,n,o,r,i)},function(){return!1})},l=function(e,n,o,r,i){var a=t.derive(o,r);return s(e,n,o,r,a,i)};return{triggerHandler:function(e,n,o,r,i){var a=t.derive(o,r);return c(e,n,o,r,a,i)},triggerUntilStopped:function(e,t,n,o){var r=n.target();return l(e,t,n,r,o)},triggerOnUntilStopped:l,broadcast:function(t,o,i){var a=n.fromExternal(o);return r.each(t,function(t){var n=t.descHandler();e.getHandler(n)(a)}),a.isStopped()}}}),o("ephox.alloy.alien.TransformFind",["ephox.sugar.api.search.PredicateFind"],function(e){return{closest:function(t,n,o){return e.closest(t,function(e){return n(e).isSome()},o).bind(n)}}}),o("ephox.alloy.events.EventRegistry",["ephox.alloy.alien.TransformFind","ephox.alloy.events.DescribedHandler","ephox.alloy.registry.Tagger","ephox.boulder.api.Objects","ephox.katamari.api.Fun","ephox.katamari.api.Obj","ephox.katamari.api.Option","ephox.katamari.api.Struct","global!console"],function(e,t,n,o,r,i,a,u,c){var s=u.immutable("element","descHandler");return function(){var u={};return{registerId:function(e,n,o){i.each(o,function(o,r){var i=void 0!==u[r]?u[r]:{};i[n]=t.curryArgs(o,e),u[r]=i})},unregisterId:function(e){i.each(u,function(t,n){t.hasOwnProperty(e)&&delete t[e]})},filterByType:function(e){return o.readOptFrom(u,e).map(function(e){return i.mapToArray(e,function(e,t){return n=t,o=e,{id:r.constant(n),descHandler:r.constant(o)};var n,o})}).getOr([])},find:function(t,r,i){var c=o.readOpt(r)(u);return e.closest(i,function(e){return t=c,r=e,n.read(r).fold(function(e){return a.none()},function(e){var n=o.readOpt(e);return t.bind(n).map(function(e){return s(r,e)})});var t,r},t)}}}}),o("ephox.alloy.registry.Registry",["ephox.alloy.events.EventRegistry","ephox.alloy.log.AlloyLogger","ephox.alloy.registry.Tagger","ephox.boulder.api.Objects","ephox.sugar.api.node.Body","global!Error"],function(e,t,n,o,r,i){return function(){var a=e(),u={},c=function(e){n.read(e.element()).each(function(e){u[e]=void 0,a.unregisterId(e)})};return{find:function(e,t,n){return a.find(e,t,n)},filter:function(e){return a.filterByType(e)},register:function(e){var s=function(e){var t=e.element();return n.read(t).fold(function(){return n.write("uid-",e.element())},function(e){return e})}(e);o.hasKey(u,s)&&function(e,n){var o=u[n];if(o!==e)throw new i('The tagId "'+n+'" is already used by: '+t.element(o.element())+"\nCannot use it for: "+t.element(e.element())+"\nThe conflicting element is"+(r.inBody(o.element())?" ":" not ")+"already in the DOM");c(e)}(e,s);var l=[e];a.registerId(l,s,e.events()),u[s]=e},unregister:c,getById:function(e){return o.readOpt(e)(u)}}}}),o("ephox.alloy.api.system.Gui",["ephox.alloy.api.component.GuiFactory","ephox.alloy.api.events.SystemEvents","ephox.alloy.api.system.Attachment","ephox.alloy.api.system.SystemApi","ephox.alloy.api.ui.Container","ephox.alloy.debugging.Debugging","ephox.alloy.events.DescribedHandler","ephox.alloy.events.GuiEvents","ephox.alloy.events.Triggers","ephox.alloy.log.AlloyLogger","ephox.alloy.registry.Registry","ephox.alloy.registry.Tagger","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Result","ephox.sugar.api.dom.Compare","ephox.sugar.api.dom.Focus","ephox.sugar.api.dom.Insert","ephox.sugar.api.dom.Remove","ephox.sugar.api.node.Node","ephox.sugar.api.properties.Class","ephox.sugar.api.search.Traverse","global!Error"],function(e,t,n,o,r,i,a,u,c,s,l,p,f,m,d,h,g,v,x,y,b,k,S){var O=function(r){var s=function(e){return k.parent(r.element()).fold(function(){return!0},function(t){return h.eq(e,t)})},v=l(),b=function(e,t){return v.find(s,e,t)},O=u.setup(r.element(),{triggerEvent:function(e,t){return i.monitorEvent(e,t.target(),function(n){return c.triggerUntilStopped(b,e,t,n)})},broadcastEvent:function(e,t){var n=v.filter(e);return c.broadcast(n,t)}}),T=o({debugInfo:m.constant("real"),triggerEvent:function(e,t,n){i.monitorEvent(e,t,function(o){c.triggerOnUntilStopped(b,e,n,t,o)})},triggerFocus:function(e,n){p.read(e).fold(function(){g.focus(e)},function(o){i.monitorEvent(t.focus(),e,function(o){c.triggerHandler(b,t.focus(),{originator:m.constant(n),target:m.constant(e)},e,o)})})},triggerEscape:function(e,t){T.triggerEvent("keydown",e.element(),t.event())},getByUid:function(e){return M(e)},getByDom:function(e){return B(e)},build:e.build,addToGui:function(e){A(e)},removeFromGui:function(e){C(e)},addToWorld:function(e){w(e)},removeFromWorld:function(e){E(e)},broadcast:function(e){D(e)},broadcastOn:function(e,t){R(e,t)}}),w=function(e){e.connect(T),y.isText(e.element())||(v.register(e),f.each(e.components(),w),T.triggerEvent(t.systemInit(),e.element(),{target:m.constant(e.element())}))},E=function(e){y.isText(e.element())||(f.each(e.components(),E),v.unregister(e)),e.disconnect()},A=function(e){n.attach(r,e)},C=function(e){n.detach(e)},F=function(e){var n=v.filter(t.receive());f.each(n,function(t){var n=t.descHandler();a.getHandler(n)(e)})},D=function(e){F({universal:m.constant(!0),data:m.constant(e)})},R=function(e,t){F({universal:m.constant(!1),channels:m.constant(e),data:m.constant(t)})},M=function(e){return v.getById(e).fold(function(){return d.error(new S('Could not find component with uid: "'+e+'" in system.'))},d.value)},B=function(e){return p.read(e).bind(M)};return w(r),{root:m.constant(r),element:r.element,destroy:function(){O.unbind(),x.remove(r.element())},add:A,remove:C,getByUid:M,getByDom:B,addToWorld:w,removeFromWorld:E,broadcast:D,broadcastOn:R}};return{create:function(){var t=e.build(r.sketch({dom:{tag:"div"}}));return O(t)},takeover:O}}),o("tinymce.themes.mobile.ui.OuterContainer",["ephox.alloy.api.behaviour.Behaviour","ephox.alloy.api.behaviour.Swapping","ephox.alloy.api.component.GuiFactory","ephox.alloy.api.system.Gui","ephox.alloy.api.ui.Container","ephox.katamari.api.Fun","tinymce.themes.mobile.style.Styles"],function(e,t,n,o,r,i,a){var u=i.constant(a.resolve("readonly-mode")),c=i.constant(a.resolve("edit-mode"));return function(i){var s=n.build(r.sketch({dom:{classes:[a.resolve("outer-container")].concat(i.classes)},containerBehaviours:e.derive([t.config({alpha:u(),omega:c()})])}));return o.takeover(s)}}),o("tinymce.themes.mobile.ui.AndroidRealm",["ephox.alloy.api.behaviour.Replacing","ephox.alloy.api.behaviour.Swapping","ephox.katamari.api.Fun","ephox.katamari.api.Singleton","tinymce.themes.mobile.api.AndroidWebapp","tinymce.themes.mobile.style.Styles","tinymce.themes.mobile.toolbar.ScrollingToolbar","tinymce.themes.mobile.ui.CommonRealm","tinymce.themes.mobile.ui.Dropup","tinymce.themes.mobile.ui.OuterContainer"],function(e,t,n,o,r,i,a,u,c,s){return function(t){var l=s({classes:[i.resolve("android-container")]}),p=a(),f=o.api(),m=u.makeEditSwitch(f),d=u.makeSocket(),h=c.build(n.noop,t);l.add(p.wrapper()),l.add(d),l.add(h.component());return{system:n.constant(l),element:l.element,init:function(e){f.set(r.produce(e))},exit:function(){f.run(function(t){t.exit(),e.remove(d,m)})},setToolbarGroups:function(e){var t=p.createGroups(e);p.setGroups(t)},setContextToolbar:function(e){var t=p.createGroups(e);p.setContextToolbar(t)},focusToolbar:function(){p.focus()},restoreToolbar:function(){p.restoreToolbar()},updateMode:function(e){u.updateMode(d,m,e,l.root())},socket:n.constant(d),dropup:n.constant(h)}}}),o("ephox.sugar.api.view.Position",["ephox.katamari.api.Fun"],function(e){var t=function(n,o){return{left:e.constant(n),top:e.constant(o),translate:function(e,r){return t(n+e,o+r)}}};return t}),o("ephox.sugar.api.dom.Dom",["ephox.katamari.api.Fun","ephox.sugar.api.dom.Compare","ephox.sugar.api.node.Element","ephox.sugar.api.node.Node","ephox.sugar.api.search.PredicateFind","global!document"],function(e,t,n,o,r,i){return{attached:function(o,a){var u=a||n.fromDom(i.documentElement);return r.ancestor(o,e.curry(t.eq,u)).isSome()},windowOf:function(e){var t=e.dom();return t===t.window?e:o.isDocument(e)?t.defaultView||t.parentWindow:null}}}),o("ephox.sugar.api.view.Location",["ephox.sugar.api.view.Position","ephox.sugar.api.dom.Dom","ephox.sugar.api.node.Element"],function(e,t,n){var o=function(e,t){return void 0!==e?e:void 0!==t?t:0},r=function(o){var r=o.dom(),i=r.ownerDocument,a=i.body,u=n.fromDom(i.documentElement);return a===r?e(a.offsetLeft,a.offsetTop):t.attached(o,u)?function(t){var n=t.getBoundingClientRect();return e(n.left,n.top)}(r):e(0,0)};return{absolute:function(e){var i=e.dom().ownerDocument,a=i.body,u=t.windowOf(n.fromDom(i)),c=i.documentElement,s=o(u.pageYOffset,c.scrollTop),l=o(u.pageXOffset,c.scrollLeft),p=o(c.clientTop,a.clientTop),f=o(c.clientLeft,a.clientLeft);return r(e).translate(l-f,s-p)},relative:function(t){var n=t.dom();return e(n.offsetLeft,n.offsetTop)},viewport:r}}),o("tinymce.themes.mobile.ios.core.IosEvents",["ephox.alloy.events.TapEvent","ephox.katamari.api.Arr","ephox.katamari.api.Throttler","ephox.sugar.api.dom.Compare","ephox.sugar.api.events.DomEvent","ephox.sugar.api.view.Height","ephox.sugar.api.view.Location","tinymce.themes.mobile.util.TappingEvent"],function(e,t,n,o,r,i,a,u){return{initEvents:function(e,c,s,l,p){var f=function(){c.run(function(e){e.refreshSelection()})},m=function(e,t){var n=e-l.dom().scrollTop;c.run(function(e){e.scrollIntoView(n,n+t)})},d=function(){c.run(function(e){e.clearSelection()})},h=function(){e.getCursorBox().each(function(e){m(e.top(),e.height())}),c.run(function(e){e.syncHeight()})},g=u.monitor(e),v=n.last(h,300),x=[e.onKeyup(function(){d(),v.throttle()}),e.onNodeChanged(f),e.onDomChanged(v.throttle),e.onDomChanged(f),e.onScrollToCursor(function(e){e.preventDefault(),v.throttle()}),e.onScrollToElement(function(e){t=e.element(),a.absolute(t).top(),i.get(t),m(c,l);var t}),e.onToEditing(function(){c.run(function(e){e.toEditing()})}),e.onToReading(function(){c.run(function(e){e.toReading()})}),r.bind(e.doc(),"touchend",function(t){o.eq(e.html(),t.target())||o.eq(e.body(),t.target())}),r.bind(s,"transitionend",function(e){"height"===e.raw().propertyName&&function(){var e=i.get(s);c.run(function(t){t.setViewportOffset(e)}),f(),h()}()}),r.capture(s,"touchstart",function(t){c.run(function(e){e.highlightSelection()}),n=t,c.run(function(e){e.onToolbarTouch(n)});var n;e.onTouchToolstrip()}),r.bind(e.body(),"touchstart",function(t){d(),e.onTouchContent(),g.fireTouchstart(t)}),g.onTouchmove(),g.onTouchend(),r.bind(e.body(),"click",function(e){e.kill()}),r.bind(s,"touchmove",function(){e.onToolbarScrollStart()})];return{destroy:function(){t.each(x,function(e){e.unbind()})}}}}}),o("tinymce.themes.mobile.touch.focus.CursorRefresh",["ephox.sugar.api.dom.Focus","global!setTimeout"],function(e,t){return{refreshInput:function(n){var o=n.dom().selectionStart,r=n.dom().selectionEnd,i=n.dom().selectionDirection;t(function(){n.dom().setSelectionRange(o,r,i),e.focus(n)},50)},refresh:function(e){var t=e.getSelection();if(t.rangeCount>0){var n=t.getRangeAt(0),o=e.document.createRange();o.setStart(n.startContainer,n.startOffset),o.setEnd(n.endContainer,n.endOffset),t.removeAllRanges(),t.addRange(o)}}}}),o("tinymce.themes.mobile.ios.focus.ResumeEditing",["ephox.sugar.api.dom.Compare","ephox.sugar.api.dom.Focus","ephox.sugar.api.node.Element","tinymce.themes.mobile.touch.focus.CursorRefresh"],function(e,t,n,o){return{resume:function(r,i){t.active().each(function(n){e.eq(n,i)||t.blur(n)}),r.focus(),t.focus(n.fromDom(r.document.body)),o.refresh(r)}}}),o("tinymce.themes.mobile.ios.focus.FakeSelection",["ephox.katamari.api.Arr","ephox.sugar.api.dom.Insert","ephox.sugar.api.dom.InsertAll","ephox.sugar.api.dom.Remove","ephox.sugar.api.events.DomEvent","ephox.sugar.api.node.Element","ephox.sugar.api.properties.Class","ephox.sugar.api.properties.Classes","ephox.sugar.api.properties.Css","ephox.sugar.api.search.Traverse","tinymce.themes.mobile.ios.focus.ResumeEditing","tinymce.themes.mobile.style.Styles","tinymce.themes.mobile.util.Rectangles"],function(e,t,n,o,r,i,a,u,c,s,l,p,f){return function(m,d){var h=m.document,g=i.fromTag("div");a.add(g,p.resolve("unfocused-selections")),t.append(i.fromDom(h.documentElement),g);var v=r.bind(g,"touchstart",function(e){e.prevent(),l.resume(m,d),y()}),x=function(e){var t=i.fromTag("span");return u.add(t,[p.resolve("layer-editor"),p.resolve("unfocused-selection")]),c.setAll(t,{left:e.left()+"px",top:e.top()+"px",width:e.width()+"px",height:e.height()+"px"}),t},y=function(){o.empty(g)};return{update:function(){y();var t=f.getRectangles(m),o=e.map(t,x);n.append(g,o)},isActive:function(){return s.children(g).length>0},destroy:function(){v.unbind(),o.remove(g)},clear:y}}}),o("ephox.katamari.api.LazyValue",["ephox.katamari.api.Arr","ephox.katamari.api.Option","global!setTimeout"],function(e,t,n){var o=function(r){var i=t.none(),a=[],u=function(e){c()?l(e):a.push(e)},c=function(){return i.isSome()},s=function(t){e.each(t,l)},l=function(e){i.each(function(t){n(function(){e(t)},0)})};return r(function(e){i=t.some(e),s(a),a=[]}),{get:u,map:function(e){return o(function(t){u(function(n){t(e(n))})})},isReady:c}};return{nu:o,pure:function(e){return o(function(t){t(e)})}}}),o("ephox.katamari.async.Bounce",["global!Array","global!setTimeout"],function(e,t){return{bounce:function(n){return function(){var o=e.prototype.slice.call(arguments),r=this;t(function(){n.apply(r,o)},0)}}}}),o("ephox.katamari.api.Future",["ephox.katamari.api.LazyValue","ephox.katamari.async.Bounce"],function(e,t){var n=function(o){var r=function(e){o(t.bounce(e))};return{map:function(e){return n(function(t){r(function(n){var o=e(n);t(o)})})},bind:function(e){return n(function(t){r(function(n){e(n).get(t)})})},anonBind:function(e){return n(function(t){r(function(n){e.get(t)})})},toLazy:function(){return e.nu(r)},get:r}};return{nu:n,pure:function(e){return n(function(t){t(e)})}}}),o("tinymce.themes.mobile.ios.smooth.SmoothAnimation",["ephox.katamari.api.Option","global!clearInterval","global!Math","global!setInterval"],function(e,t,n,o){var r=function(t,o,r){return n.abs(t-o)<=r?e.none():t<o?e.some(t+r):e.some(t-r)};return{create:function(){var e=null;return{animate:function(i,a,u,c,s,l){var p=!1,f=function(e){p=!0,s(e)};t(e);var m=function(n){t(e),f(n)};e=o(function(){var o=i();r(o,a,u).fold(function(){t(e),f(a)},function(r){if(c(r,m),!p){var u=i();(u!==r||n.abs(u-a)>n.abs(o-a))&&(t(e),f(a))}})},l)}}},adjust:r}}),o("tinymce.themes.mobile.ios.view.Devices",["ephox.katamari.api.Option","ephox.katamari.api.Options"],function(e,t){return{findDevice:function(n,o){return t.findMap([{width:320,height:480,keyboard:{portrait:300,landscape:240}},{width:320,height:568,keyboard:{portrait:300,landscape:240}},{width:375,height:667,keyboard:{portrait:305,landscape:240}},{width:414,height:736,keyboard:{portrait:320,landscape:240}},{width:768,height:1024,keyboard:{portrait:320,landscape:400}},{width:1024,height:1366,keyboard:{portrait:380,landscape:460}}],function(t){return n<=t.width&&o<=t.height?e.some(t.keyboard):e.none()}).getOr({portrait:o/5,landscape:n/4})}}}),o("tinymce.themes.mobile.ios.view.DeviceZones",["ephox.sugar.api.properties.Css","ephox.sugar.api.search.Traverse","ephox.sugar.api.view.Height","tinymce.themes.mobile.ios.view.Devices","tinymce.themes.mobile.touch.view.Orientation"],function(e,t,n,o,r){var i=function(e){var t,n=r.get(e).isPortrait(),i=(t=e,o.findDevice(t.screen.width,t.screen.height)),a=n?i.portrait:i.landscape;return(n?e.screen.height:e.screen.width)-e.innerHeight>a?0:a},a=function(e,o){var r=t.owner(e).dom().defaultView;return n.get(e)+n.get(o)-i(r)};return{getGreenzone:a,updatePadding:function(t,o,r){var i=a(o,r),u=n.get(o)+n.get(r)-i;e.set(t,"padding-bottom",u+"px")}}}),o("tinymce.themes.mobile.ios.view.IosViewport",["ephox.katamari.api.Adt","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.sugar.api.properties.Attr","ephox.sugar.api.properties.Css","ephox.sugar.api.search.SelectorFilter","ephox.sugar.api.search.Traverse","ephox.sugar.api.view.Height","tinymce.themes.mobile.ios.view.DeviceZones","tinymce.themes.mobile.style.Styles","tinymce.themes.mobile.touch.scroll.Scrollable","tinymce.themes.mobile.util.DataAttributes"],function(e,t,n,o,r,i,a,u,c,s,l,p){var f=e.generate([{fixed:["element","property","offsetY"]},{scroller:["element","offsetY"]}]),m="data-"+s.resolve("position-y-fixed"),d="data-"+s.resolve("y-property"),h="data-"+s.resolve("scrolling"),g="data-"+s.resolve("last-window-height"),v=function(e){return p.safeParse(e,m)},x=function(e,t){var n,r=(n=e,o.get(n,d));return f.fixed(e,r,t)},y=function(e,t){return f.scroller(e,t)},b=function(e){var t=v(e);return("true"===o.get(e,h)?y:x)(e,t)},k=function(e,t,n){var r=a.owner(e).dom().defaultView.innerHeight;return o.set(e,g,r+"px"),r-t-n};return{findFixtures:function(e){var n=i.descendants(e,"["+m+"]");return t.map(n,b)},takeover:function(e,t,i,s){var f=a.owner(e).dom().defaultView,v=function(e){var t=o.get(e,"style");return r.setAll(e,{position:"absolute",top:"0px"}),o.set(e,m,"0px"),o.set(e,d,"top"),{restore:function(){o.set(e,"style",t||""),o.remove(e,m),o.remove(e,d)}}}(i),x=u.get(i),y=u.get(s),b=k(e,x,y),S=function(e,t,n){var i=o.get(n,"style");return l.register(n),r.setAll(n,{position:"absolute",height:t+"px",width:"100%",top:e+"px"}),o.set(n,m,e+"px"),o.set(n,h,"true"),o.set(n,d,"top"),{restore:function(){l.deregister(n),o.set(n,"style",i||""),o.remove(n,m),o.remove(n,h),o.remove(n,d)}}}(x,b,e),O=function(e,t,n){var i=o.get(e,"style");return r.setAll(e,{position:"absolute",bottom:"0px"}),o.set(e,m,"0px"),o.set(e,d,"bottom"),{restore:function(){o.set(e,"style",i||""),o.remove(e,m),o.remove(e,d)}}}(s),T=!0,w=function(){var t;return f.innerHeight>(t=e,p.safeParse(t,g))},E=function(){if(T){var n=u.get(i),a=u.get(s),l=k(e,n,a);o.set(e,m,n+"px"),r.set(e,"height",l+"px"),r.set(s,"bottom",-(n+l+a)+"px"),c.updatePadding(t,e,s)}};return c.updatePadding(t,e,s),{setViewportOffset:function(t){var n=t+"px";o.set(e,m,n),E()},isExpanding:w,isShrinking:n.not(w),refresh:E,restore:function(){T=!1,v.restore(),S.restore(),O.restore()}}},getYFixedData:v}}),o("tinymce.themes.mobile.ios.scroll.IosScrolling",["ephox.katamari.api.Fun","ephox.katamari.api.Future","ephox.sugar.api.properties.Attr","ephox.sugar.api.properties.Classes","ephox.sugar.api.properties.Css","ephox.sugar.api.search.Traverse","global!Math","tinymce.themes.mobile.ios.smooth.SmoothAnimation","tinymce.themes.mobile.ios.view.IosViewport","tinymce.themes.mobile.style.Styles","tinymce.themes.mobile.util.DataAttributes"],function(e,t,n,o,r,i,a,u,c,s,l){var p=u.create(),f="data-"+s.resolve("last-scroll-top"),m=function(e){var t=r.getRaw(e,"top").getOr(0);return parseInt(t,10)},d=function(e){return parseInt(e.dom().scrollTop,10)},h=function(e,t){var n=t+c.getYFixedData(e)+"px";r.set(e,"top",n)};return{moveScrollAndTop:function(n,o,i){return t.nu(function(t){var a=e.curry(d,n);p.animate(a,o,15,function(e){n.dom().scrollTop=e,r.set(n,"top",m(n)+15+"px")},function(){n.dom().scrollTop=o,r.set(n,"top",i+"px"),t(o)},10)})},moveOnlyScroll:function(o,r){return t.nu(function(t){var i=e.curry(d,o);n.set(o,f,i());var u=a.abs(r-i()),c=a.ceil(u/10);p.animate(i,r,c,function(e,t){l.safeParse(o,f)!==o.dom().scrollTop?t(o.dom().scrollTop):(o.dom().scrollTop=e,n.set(o,f,e))},function(){o.dom().scrollTop=r,n.set(o,f,r),t(r)},10)})},moveOnlyTop:function(n,o){return t.nu(function(t){var i=e.curry(m,n),u=function(e){r.set(n,"top",e+"px")},c=a.abs(o-i()),s=a.ceil(c/10);p.animate(i,o,s,u,function(){u(o),t(o)},10)})},moveWindowScroll:function(e,n,o){var r=i.owner(e).dom().defaultView;return t.nu(function(t){h(e,o),h(n,o),r.scrollTo(0,o),t(o)})}}}),o("tinymce.themes.mobile.ios.smooth.BackgroundActivity",["ephox.katamari.api.Cell","ephox.katamari.api.LazyValue"],function(e,t){return function(n){var o=e(t.pure({}));return{start:function(e){var r=t.nu(function(t){return n(e).get(t)});o.set(r)},idle:function(e){o.get().get(function(){e()})}}}}),o("tinymce.themes.mobile.ios.view.Greenzone",["ephox.katamari.api.Fun","global!parseInt","tinymce.themes.mobile.ios.scroll.IosScrolling","tinymce.themes.mobile.ios.view.DeviceZones","tinymce.themes.mobile.touch.focus.CursorRefresh"],function(e,t,n,o,r){return{scrollIntoView:function(t,i,a,u,c){var s=o.getGreenzone(i,a),l=e.curry(r.refresh,t);u>s||c>s?n.moveOnlyScroll(i,i.dom().scrollTop-s+c).get(l):u<0&&n.moveOnlyScroll(i,i.dom().scrollTop+u).get(l)}}}),o("ephox.katamari.async.AsyncValues",["ephox.katamari.api.Arr"],function(e){return{par:function(t,n){return n(function(n){var o=[],r=0;0===t.length?n([]):e.each(t,function(e,i){e.get((a=i,function(e){o[a]=e,++r>=t.length&&n(o)}));var a})})}}}),o("ephox.katamari.api.Futures",["ephox.katamari.api.Arr","ephox.katamari.api.Future","ephox.katamari.async.AsyncValues"],function(e,t,n){var o=function(e){return n.par(e,t.nu)};return{par:o,mapM:function(t,n){var r=e.map(t,n);return o(r)},compose:function(e,t){return function(n){return t(n).bind(e)}}}}),o("tinymce.themes.mobile.ios.view.IosUpdates",["ephox.katamari.api.Arr","ephox.katamari.api.Future","ephox.katamari.api.Futures","ephox.sugar.api.properties.Css","tinymce.themes.mobile.ios.scroll.IosScrolling","tinymce.themes.mobile.ios.view.IosViewport"],function(e,t,n,o,r,i){var a=function(e,n){return e.fold(function(e,r,i){return function(e,n,r,i){var a=r+i;return o.set(e,n,a+"px"),t.pure(i)}(e,r,n,i)},function(e,t){return function(e,t,n){var i=t+n,a=o.getRaw(e,"top").getOr(n),u=i-parseInt(a,10),c=e.dom().scrollTop+u;return r.moveScrollAndTop(e,c,i)}(e,n,t)})};return{updatePositions:function(t,o){var r=i.findFixtures(t),u=e.map(r,function(e){return a(e,o)});return n.par(u)}}}),o("tinymce.themes.mobile.util.CaptureBin",["ephox.sugar.api.dom.Focus","ephox.sugar.api.dom.Insert","ephox.sugar.api.dom.Remove","ephox.sugar.api.node.Element","ephox.sugar.api.properties.Css"],function(e,t,n,o,r){return{input:function(i,a){var u=o.fromTag("input");r.setAll(u,{opacity:"0",position:"absolute",top:"-1000px",left:"-1000px"}),t.append(i,u),e.focus(u),a(u),n.remove(u)}}}),o("tinymce.themes.mobile.ios.core.IosSetup",["ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.katamari.api.Throttler","ephox.sugar.api.dom.Focus","ephox.sugar.api.events.DomEvent","ephox.sugar.api.node.Body","ephox.sugar.api.node.Element","ephox.sugar.api.properties.Css","global!clearInterval","global!clearTimeout","global!console","global!Math","global!parseInt","global!setInterval","global!setTimeout","tinymce.themes.mobile.ios.focus.FakeSelection","tinymce.themes.mobile.ios.scroll.IosScrolling","tinymce.themes.mobile.ios.smooth.BackgroundActivity","tinymce.themes.mobile.ios.view.Greenzone","tinymce.themes.mobile.ios.view.IosUpdates","tinymce.themes.mobile.ios.view.IosViewport","tinymce.themes.mobile.touch.view.Orientation","tinymce.themes.mobile.util.CaptureBin","tinymce.themes.mobile.util.Rectangles"],function(e,t,n,o,r,i,a,u,c,s,l,p,f,m,d,h,g,v,x,y,b,k,S,O){var T=function(o,i,u,c,s,l){var p=v(function(e){return g.moveWindowScroll(o,i,e)}),f=n.last(function(){p.idle(function(){y.updatePositions(u,c.pageYOffset).get(function(){(function(){var n=O.getRectangles(l);return t.from(n[0]).bind(function(n){var o=n.top()-i.dom().scrollTop;return o>c.innerHeight+5||o<-5?t.some({top:e.constant(o),bottom:e.constant(o+n.height())}):t.none()})})().each(function(e){i.dom().scrollTop=i.dom().scrollTop+e.top()}),p.start(0),s.refresh()})})},1e3),m=r.bind(a.fromDom(c),"scroll",function(){c.pageYOffset<0||f.throttle()});return y.updatePositions(u,c.pageYOffset).get(e.identity),{unbind:m.unbind}};return{setup:function(t){var n=t.cWin(),c=t.ceBody(),s=t.socket(),l=t.toolstrip(),p=t.toolbar(),f=t.contentElement(),m=t.keyboardType(),d=t.outerWindow(),v=t.dropup(),y=b.takeover(s,c,l,v),O=m(t.outerBody(),n,i.body(),f,l,p),w=k.onChange(d,{onChange:e.noop,onReady:y.refresh});w.onAdjustment(function(){y.refresh()});var E=r.bind(a.fromDom(d),"resize",function(){y.isExpanding()&&y.refresh()}),A=T(l,s,t.outerBody(),d,y,n),C=h(n,f),F=function(){C.clear()};return{toEditing:function(){O.toEditing(),F()},toReading:function(){O.toReading()},onToolbarTouch:function(e){O.onToolbarTouch(e)},refreshSelection:function(){C.isActive()&&C.update()},clearSelection:F,highlightSelection:function(){C.update()},scrollIntoView:function(e,t){x.scrollIntoView(n,s,v,e,t)},updateToolbarPadding:e.noop,setViewportOffset:function(t){y.setViewportOffset(t),g.moveOnlyTop(s,t).get(e.identity)},syncHeight:function(){u.set(f,"height",f.dom().contentWindow.document.body.scrollHeight+"px")},refreshStructure:y.refresh,destroy:function(){y.restore(),w.destroy(),A.unbind(),E.unbind(),O.destroy(),C.destroy(),S.input(i.body(),o.blur)}}}}}),o("tinymce.themes.mobile.ios.view.IosKeyboard",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.sugar.api.dom.Focus","ephox.sugar.api.events.DomEvent","ephox.sugar.api.node.Body","ephox.sugar.api.node.Node","tinymce.themes.mobile.ios.focus.ResumeEditing","tinymce.themes.mobile.util.CaptureBin"],function(e,t,n,o,r,i,a,u){return{stubborn:function(t,r,c,s){var l=function(){a.resume(r,s)},p=o.bind(c,"keydown",function(t){e.contains(["input","textarea"],i.name(t.target()))||l()});return{toReading:function(){u.input(t,n.blur)},toEditing:l,onToolbarTouch:function(){},destroy:function(){p.unbind()}}},timid:function(e,o,r,i){var u=function(){n.blur(i)};return{toReading:function(){u()},toEditing:function(){a.resume(o,i)},onToolbarTouch:function(){u()},destroy:t.noop}}}}),o("tinymce.themes.mobile.ios.core.IosMode",["ephox.katamari.api.Fun","ephox.katamari.api.Singleton","ephox.katamari.api.Struct","ephox.sugar.api.dom.Focus","ephox.sugar.api.node.Element","ephox.sugar.api.properties.Class","ephox.sugar.api.properties.Css","global!document","tinymce.themes.mobile.ios.core.IosEvents","tinymce.themes.mobile.ios.core.IosSetup","tinymce.themes.mobile.ios.core.PlatformEditor","tinymce.themes.mobile.ios.scroll.Scrollables","tinymce.themes.mobile.ios.view.IosKeyboard","tinymce.themes.mobile.util.Thor","tinymce.themes.mobile.style.Styles","tinymce.themes.mobile.touch.scroll.Scrollable","tinymce.themes.mobile.touch.view.MetaViewport"],function(e,t,n,o,r,i,a,u,c,s,l,p,f,m,d,h,g){return{create:function(v,x){var y=g.tag(),b=t.value(),k=t.value(),S=t.api(),O=t.api();return{enter:function(){x.hide();var t=r.fromDom(u);l.getActiveApi(v.editor).each(function(r){b.set({socketHeight:a.getRaw(v.socket,"height"),iframeHeight:a.getRaw(r.frame(),"height"),outerScroll:u.body.scrollTop}),k.set({exclusives:p.exclusive(t,"."+h.scrollable())}),i.add(v.container,d.resolve("fullscreen-maximized")),m.clobberStyles(v.container,r.body()),y.maximize(),a.set(v.socket,"overflow","scroll"),a.set(v.socket,"-webkit-overflow-scrolling","touch"),o.focus(r.body());var l=n.immutableBag(["cWin","ceBody","socket","toolstrip","toolbar","dropup","contentElement","cursor","keyboardType","isScrolling","outerWindow","outerBody"],[]);S.set(s.setup(l({cWin:r.win(),ceBody:r.body(),socket:v.socket,toolstrip:v.toolstrip,toolbar:v.toolbar,dropup:v.dropup.element(),contentElement:r.frame(),cursor:e.noop,outerBody:v.body,outerWindow:v.win,keyboardType:f.stubborn,isScrolling:function(){return k.get().exists(function(e){return e.socket.isScrolling()})}}))),S.run(function(e){e.syncHeight()}),O.set(c.initEvents(r,S,v.toolstrip,v.socket,v.dropup))})},refreshStructure:function(){S.run(function(e){e.refreshStructure()})},exit:function(){y.restore(),O.clear(),S.clear(),x.show(),b.on(function(e){e.socketHeight.each(function(e){a.set(v.socket,"height",e)}),e.iframeHeight.each(function(e){a.set(v.editor.getFrame(),"height",e)}),u.body.scrollTop=e.scrollTop}),b.clear(),k.on(function(e){e.exclusives.unbind()}),k.clear(),i.remove(v.container,d.resolve("fullscreen-maximized")),m.restoreStyles(),h.deregister(v.toolbar),a.remove(v.socket,"overflow"),a.remove(v.socket,"-webkit-overflow-scrolling"),o.blur(v.editor.getFrame()),l.getActiveApi(v.editor).each(function(e){e.clearSelection()})}}}}}),o("tinymce.themes.mobile.api.IosWebapp",["ephox.alloy.api.component.GuiFactory","ephox.boulder.api.ValueSchema","ephox.katamari.api.Fun","ephox.sugar.api.properties.Css","tinymce.themes.mobile.api.MobileSchema","tinymce.themes.mobile.ios.core.IosMode","tinymce.themes.mobile.touch.view.TapToEditMask"],function(e,t,n,o,r,i,a){return{produce:function(u){var c=t.asRawOrDie("Getting IosWebapp schema",r,u);o.set(c.toolstrip,"width","100%"),o.set(c.container,"position","relative");var s=e.build(a.sketch(function(){c.setReadOnly(!0),p.enter()},c.translate));c.alloy.add(s);var l={show:function(){c.alloy.add(s)},hide:function(){c.alloy.remove(s)}},p=i.create(c,l);return{setReadOnly:c.setReadOnly,refreshStructure:p.refreshStructure,enter:p.enter,exit:p.exit,destroy:n.noop}}}}),o("tinymce.themes.mobile.ui.IosRealm",["ephox.alloy.api.behaviour.Replacing","ephox.katamari.api.Fun","ephox.katamari.api.Singleton","tinymce.themes.mobile.api.IosWebapp","tinymce.themes.mobile.style.Styles","tinymce.themes.mobile.toolbar.ScrollingToolbar","tinymce.themes.mobile.ui.CommonRealm","tinymce.themes.mobile.ui.Dropup","tinymce.themes.mobile.ui.OuterContainer"],function(e,t,n,o,r,i,a,u,c){return function(s){var l=c({classes:[r.resolve("ios-container")]}),p=i(),f=n.api(),m=a.makeEditSwitch(f),d=a.makeSocket(),h=u.build(function(){f.run(function(e){e.refreshStructure()})},s);l.add(p.wrapper()),l.add(d),l.add(h.component());return{system:t.constant(l),element:l.element,init:function(e){f.set(o.produce(e))},exit:function(){f.run(function(t){e.remove(d,m),t.exit()})},setToolbarGroups:function(e){var t=p.createGroups(e);p.setGroups(t)},setContextToolbar:function(e){var t=p.createGroups(e);p.setContextToolbar(t)},focusToolbar:function(){p.focus()},restoreToolbar:function(){p.restoreToolbar()},updateMode:function(e){a.updateMode(d,m,e,l.root())},socket:t.constant(d),dropup:t.constant(h)}}}),o("tinymce.core.EditorManager",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.EditorManager")}),o("tinymce.themes.mobile.util.CssUrls",["ephox.boulder.api.Objects","tinymce.core.EditorManager"],function(e,t){return{derive:function(n){var o=e.readOptFrom(n.settings,"skin_url").fold(function(){return t.baseURL+"/skins/lightgray"},function(e){return e});return{content:o+"/content.mobile.min.css",ui:o+"/skin.mobile.min.css"}}}}),o("tinymce.themes.mobile.util.FormatChangers",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Obj","tinymce.themes.mobile.channels.TinyChannels"],function(e,t,n,o){var r=function(e,t,n){e.system().broadcastOn([o.formatChanged()],{command:t,state:n})};return{init:function(t,o){var i=n.keys(o.formatter.get());e.each(i,function(e){o.formatter.formatChanged(e,function(n){r(t,e,n)})}),e.each(["ul","ol"],function(e){o.selection.selectorChanged(e,function(n,o){r(t,e,n)})})},fontSizes:t.constant(["x-small","small","medium","large","x-large"])}}),o("tinymce.themes.mobile.util.SkinLoaded",[],function(){return{fireSkinLoaded:function(e){var t=function(){e._skinLoaded=!0,e.fire("SkinLoaded")};return function(){e.initialized?t():e.on("init",t)}}}}),o("tinymce.themes.mobile.Theme",["ephox.alloy.api.behaviour.Swapping","ephox.alloy.api.events.AlloyTriggers","ephox.alloy.api.system.Attachment","ephox.alloy.debugging.Debugging","ephox.katamari.api.Cell","ephox.katamari.api.Fun","ephox.sand.api.PlatformDetection","ephox.sugar.api.dom.Focus","ephox.sugar.api.dom.Insert","ephox.sugar.api.node.Element","ephox.sugar.api.node.Node","tinymce.core.ThemeManager","tinymce.core.dom.DOMUtils","tinymce.themes.mobile.alien.TinyCodeDupe","tinymce.themes.mobile.api.Settings","tinymce.themes.mobile.channels.TinyChannels","tinymce.themes.mobile.features.Features","tinymce.themes.mobile.style.Styles","tinymce.themes.mobile.touch.view.Orientation","tinymce.themes.mobile.ui.AndroidRealm","tinymce.themes.mobile.ui.Buttons","tinymce.themes.mobile.ui.IosRealm","tinymce.themes.mobile.util.CssUrls","tinymce.themes.mobile.util.FormatChangers","tinymce.themes.mobile.util.SkinLoaded"],function(e,t,n,o,r,i,a,u,c,s,l,p,f,m,d,h,g,v,x,y,b,k,S,O,T){var w=i.constant("toReading"),E=i.constant("toEditing");return p.add("mobile",function(p){return{getNotificationManagerImpl:function(){return{open:i.identity,close:i.noop,reposition:i.noop,getArgs:i.identity}},renderUI:function(A){var C=S.derive(p);!1===d.isSkinDisabled(p)?(p.contentCSS.push(C.content),f.DOM.styleSheetLoader.load(C.ui,T.fireSkinLoaded(p))):T.fireSkinLoaded(p)();var F=function(){p.fire("scrollIntoView")},D=s.fromTag("div"),R=a.detect().os.isAndroid()?y(F):k(F),M=s.fromDom(A.targetNode);c.after(M,D),n.attachSystem(D,R.system());var B=A.targetNode.ownerDocument.defaultView,I=x.onChange(B,{onChange:function(){R.system().broadcastOn([h.orientationChanged()],{width:x.getActualWidth(B)})},onReady:i.noop}),N=function(e,t,n){!1===n&&p.selection.collapse(),R.setToolbarGroups(n?e.get():t.get()),p.setMode(!0===n?"readonly":"design"),p.fire(!0===n?w():E()),R.updateMode(n)},P=function(e,t){return p.on(e,t),{unbind:function(){p.off(e)}}};return p.on("init",function(){R.init({editor:{getFrame:function(){return s.fromDom(p.contentAreaContainer.querySelector("iframe"))},onDomChanged:function(){return{unbind:i.noop}},onToReading:function(e){return P(w(),e)},onToEditing:function(e){return P(E(),e)},onScrollToCursor:function(e){return p.on("scrollIntoView",function(t){e(t)}),{unbind:function(){p.off("scrollIntoView"),I.destroy()}}},onTouchToolstrip:function(){n()},onTouchContent:function(){var e=s.fromDom(p.editorContainer.querySelector("."+v.resolve("toolbar")));(o=e,u.search(o).bind(function(e){return R.system().getByDom(e).toOption()})).each(t.emitExecute);var o;R.restoreToolbar(),n()},onTapContent:function(t){var n=t.target();"img"===l.name(n)?(p.selection.select(n.dom()),t.kill()):"a"===l.name(n)&&R.system().getByDom(s.fromDom(p.editorContainer)).each(function(t){e.isAlpha(t)&&m.openLink(n.dom())})}},container:s.fromDom(p.editorContainer),socket:s.fromDom(p.contentAreaContainer),toolstrip:s.fromDom(p.editorContainer.querySelector("."+v.resolve("toolstrip"))),toolbar:s.fromDom(p.editorContainer.querySelector("."+v.resolve("toolbar"))),dropup:R.dropup(),alloy:R.system(),translate:i.noop,setReadOnly:function(e){N(k,y,e)}});var n=function(){R.dropup().disappear(function(){R.system().broadcastOn([h.dropupDismissed()],{})})};o.registerInspector("remove this",R.system());var a={label:"The first group",scrollable:!1,items:[b.forToolbar("back",function(){p.selection.collapse(),R.exit()},{})]},c={label:"Back to read only",scrollable:!1,items:[b.forToolbar("readonly-back",function(){N(k,y,!0)},{})]},f=g.setup(R,p),d=g.detect(p.settings,f),x={label:"The extra group",scrollable:!1,items:[]},y=r([c,{label:"the action group",scrollable:!0,items:d},x]),k=r([a,{label:"The read only mode group",scrollable:!0,items:[]},x]);O.init(R,p)}),{iframeContainer:R.socket().element().dom(),editorContainer:R.element().dom()}}}}),function(){}}),n("tinymce.themes.mobile.Theme")()}();