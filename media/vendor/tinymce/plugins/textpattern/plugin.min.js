!function(){var t={},e=function(e){for(var n=t[e],a=n.deps,i=n.defn,o=a.length,l=new Array(o),c=0;c<o;++c)l[c]=r(a[c]);var u=i.apply(null,l);if(void 0===u)throw"module ["+e+"] returned undefined";n.instance=u},n=function(e,n,r){if("string"!=typeof e)throw"module id must be a string";if(void 0===n)throw"no dependencies for "+e;if(void 0===r)throw"no definition function for "+e;t[e]={deps:n,defn:r,instance:void 0}},r=function(n){var r=t[n];if(void 0===r)throw"module ["+n+"] was undefined";return void 0===r.instance&&e(n),r.instance},a=function(t,e){for(var n=t.length,a=new Array(n),i=0;i<n;++i)a[i]=r(t[i]);e.apply(null,a)};({}).bolt={module:{api:{define:n,require:a,demand:r}}};var i=n,o=function(t,e){i(t,[],function(){return e})};i("ephox.katamari.api.Cell",[],function(){var t=function(e){var n=e,r=function(){return n};return{get:r,set:function(t){n=t},clone:function(){return t(r())}}};return t}),o("global!tinymce.util.Tools.resolve",tinymce.util.Tools.resolve),i("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.PluginManager")}),i("tinymce.plugins.textpattern.api.Api",[],function(){return{get:function(t){return{setPatterns:function(e){t.set(e)},getPatterns:function(){return t.get()}}}}}),i("tinymce.plugins.textpattern.api.Settings",[],function(){var t=[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"***",end:"***",format:["bold","italic"]},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}];return{getPatterns:function(e){return void 0!==e.textpattern_patterns?e.textpattern_patterns:t}}}),i("tinymce.core.util.Delay",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.util.Delay")}),i("tinymce.core.util.VK",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.util.VK")}),o("global!document",document),i("tinymce.core.dom.TreeWalker",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.dom.TreeWalker")}),i("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.util.Tools")}),i("tinymce.plugins.textpattern.core.Patterns",[],function(){var t=function(t){return t.sort(function(t,e){return t.start.length>e.start.length?-1:t.start.length<e.start.length?1:0})},e=function(t,e,n,r){return e.substr(n-t.end.length-r,t.end.length)===t.end},n=function(t,e,n){return t-e-n.end.length-n.start.length>0};return{findPattern:function(t,e){for(var n=0;n<t.length;n++)if(0===e.indexOf(t[n].start)&&(!t[n].end||e.lastIndexOf(t[n].end)===e.length-t[n].end.length))return t[n]},findEndPattern:function(r,a,i,o){var l,c,u=t(r);for(c=0;c<u.length;c++)if(void 0!==(l=u[c]).end&&e(l,a,i,o)&&n(i,o,l))return l}}}),i("tinymce.plugins.textpattern.core.Formatter",["global!document","tinymce.core.dom.TreeWalker","tinymce.core.util.Tools","tinymce.plugins.textpattern.core.Patterns"],function(t,e,n,r){var a=function(t,e,n,r,a){return(t=r>0?t.splitText(r):t).splitText(n-r+e.end.length),t.deleteData(0,e.start.length),t.deleteData(t.data.length-e.end.length,e.end.length),t},i=function(e,n,a){if(!1!==n.collapsed){var i=n.startContainer,o=i.data,l=!0===a?1:0;if(3===i.nodeType){var c=r.findEndPattern(e,o,n.startOffset,l);if(void 0!==c){var u=o.lastIndexOf(c.end,n.startOffset-l),s=o.lastIndexOf(c.start,u-c.end.length);if(u=o.indexOf(c.end,s+c.start.length),-1!==s){var f=t.createRange();f.setStart(i,s),f.setEnd(i,u+c.end.length);var d=r.findPattern(e,f.toString());if(!(void 0===c||d!==c||i.data.length<=c.start.length+c.end.length))return{pattern:c,startOffset:s,endOffset:u}}}}}},o=function(t,e,r,i){var o=n.isArray(r.pattern.format)?r.pattern.format:[r.pattern.format];if(0!==n.grep(o,function(e){var n=t.formatter.get(e);return n&&n[0].inline}).length)return t.undoManager.transact(function(){e=a(e,r.pattern,r.endOffset,r.startOffset),o.forEach(function(n){t.formatter.apply(n,{},e)})}),e},l=function(t,e,n){var r=t.selection.getRng(!0),a=i(e,r,n);if(a)return o(t,r.startContainer,a)};return{patternFromRng:i,applyInlineFormatSpace:function(t,e){return l(t,e,!0)},applyInlineFormatEnter:function(t,e){return l(t,e,!1)},applyBlockFormat:function(t,a){var i,o,l,c,u,s,f,d,g,m,p;if(i=t.selection,o=t.dom,i.isCollapsed()&&(f=o.getParent(i.getStart(),"p"))){for(g=new e(f,f);u=g.next();)if(3===u.nodeType){c=u;break}if(c){if(!(d=r.findPattern(a,c.data)))return;if(m=i.getRng(!0),l=m.startContainer,p=m.startOffset,c===l&&(p=Math.max(0,p-d.start.length)),n.trim(c.data).length===d.start.length)return;d.format&&(s=t.formatter.get(d.format))&&s[0].block&&(c.deleteData(0,d.start.length),t.formatter.apply(d.format,{},c),m.setStart(l,p),m.collapse(!0),i.setRng(m)),d.cmd&&t.undoManager.transact(function(){c.deleteData(0,d.start.length),t.execCommand(d.cmd)})}}}}}),i("tinymce.plugins.textpattern.core.KeyHandler",["tinymce.core.util.VK","tinymce.plugins.textpattern.core.Formatter"],function(t,e){var n=function(t,e,n){for(var r=0;r<t.length;r++)if(n(t[r],e))return!0};return{handleEnter:function(t,n){var r,a;(r=e.applyInlineFormatEnter(t,n))&&((a=t.dom.createRng()).setStart(r,r.data.length),a.setEnd(r,r.data.length),t.selection.setRng(a)),e.applyBlockFormat(t,n)},handleInlineKey:function(t,n){var r,a,i,o,l;(r=e.applyInlineFormatSpace(t,n))&&(l=t.dom,a=r.data.slice(-1),/[\u00a0 ]/.test(a)&&(r.deleteData(r.data.length-1,1),i=l.doc.createTextNode(a),l.insertAfter(i,r.parentNode),(o=l.createRng()).setStart(i,1),o.setEnd(i,1),t.selection.setRng(o)))},checkCharCode:function(t,e){return n(t,e,function(t,e){return t.charCodeAt(0)===e.charCode})},checkKeyCode:function(e,r){return n(e,r,function(e,n){return e===n.keyCode&&!1===t.modifierPressed(n)})}}}),i("tinymce.plugins.textpattern.core.Keyboard",["tinymce.core.util.Delay","tinymce.core.util.VK","tinymce.plugins.textpattern.core.KeyHandler"],function(t,e,n){return{setup:function(r,a){var i=[",",".",";",":","!","?"],o=[32];r.on("keydown",function(t){13!==t.keyCode||e.modifierPressed(t)||n.handleEnter(r,a.get())},!0),r.on("keyup",function(t){n.checkKeyCode(o,t)&&n.handleInlineKey(r,a.get())}),r.on("keypress",function(e){n.checkCharCode(i,e)&&t.setEditorTimeout(r,function(){n.handleInlineKey(r,a.get())})})}}}),i("tinymce.plugins.textpattern.Plugin",["ephox.katamari.api.Cell","tinymce.core.PluginManager","tinymce.plugins.textpattern.api.Api","tinymce.plugins.textpattern.api.Settings","tinymce.plugins.textpattern.core.Keyboard"],function(t,e,n,r,a){return e.add("textpattern",function(e){var i=t(r.getPatterns(e.settings));return a.setup(e,i),n.get(i)}),function(){}}),r("tinymce.plugins.textpattern.Plugin")()}();