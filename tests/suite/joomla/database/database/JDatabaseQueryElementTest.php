<?php
/**
 * @version		$Id: JDatabaseQueryElementTest.php 20196 2011-01-09 02:40:25Z ian $
 * @copyright	Copyright (C) 2005 - 2011 Open Source Matters. All rights reserved.
 * @license		GNU General Public License version 2 or later; see LICENSE.txt
 */

require_once JPATH_PLATFORM.'/joomla/database/databasequery.php';

/**
 * Test class for JDatabaseQueryElement.
 * Generated by PHPUnit on 2009-10-08 at 22:01:07.
 */
class JDatabaseQueryElementTest extends PHPUnit_Framework_TestCase
{
	/**
	 * Test cases for append and __toString
	 *
	 * Each test case provides
	 * - array	element	the base element for the test, given as hash
	 * 				name => element_name,
	 * 				elements => element array,
	 * 				glue => glue
	 * - array	appendElement	the element to be appended (same format as above)
	 * - array 	expected	array of elements that should be the value of the elements attribute after the merge
	 * - string	expected value of __toString() for element after append
	 *
	 * @return  array
	 *
	 * @since   11.1
	 */
	public function dataTestAppend()
	{
		return array(
       		'array-element' => array(
				array(
					'name' => 'SELECT',
					'elements' => array(),
					'glue' => ','
					),
				array(
					'name' => 'FROM',
					'elements' => array('my_table_name'),
					'glue' => ','
					),
				array(
					'name' => 'FROM',
					'elements' => array('my_table_name'),
					'glue' => ','
					),
				PHP_EOL . 'SELECT ' . PHP_EOL . 'FROM my_table_name',
				),
      		'non-array-element' => array(
				array(
					'name' => 'SELECT',
					'elements' => array(),
					'glue' => ','
					),
				array(
					'name' => 'FROM',
					'elements' => array('my_table_name'),
					'glue' => ','
					),
				array(
					'name' => 'FROM',
					'elements' => array('my_table_name'),
					'glue' => ','
					),
				PHP_EOL . 'SELECT ' . PHP_EOL . 'FROM my_table_name',
				)
		);
	}

	/**
	 * Test cases for constructor
	 *
	 * Each test case provides
	 * - array	element	the base element for the test, given as hash
	 * 				name => element_name,
	 * 				elements => array or string
	 * 				glue => glue
	 * - array	expected values in same hash format
	 *
	 */
	function dataTestConstruct()
	{
		return array(
       		'array-element' => array(
					array(
						'name' => 'FROM',
						'elements' => array('field1', 'field2'),
						'glue' => ','
						),
					array(
						'name' => 'FROM',
						'elements' => array('field1', 'field2'),
						'glue' => ','
						)
			),
        		'non-array-element' => array(
					array(
						'name' => 'TABLE',
						'elements' => 'my_table_name',
						'glue' => ','
						),
					array(
						'name' => 'TABLE',
						'elements' => array('my_table_name'),
						'glue' => ','
						)
			)
		);
	}

	/**
	 * Test the class constructor.
	 *
	 * @param   array  $element   values for base element
	 * @param   array  $expected  values for expected fields
	 *
	 * @return	void
	 *
	 * @since   11.1
	 * @dataProvider  dataTestConstruct
	 */
	public function test__Construct($element, $expected)
	{
		$baseElement = new JDatabaseQueryElement($element['name'], $element['elements'], $element['glue']);

		$this->assertAttributeEquals(
			$expected['name'], 'name', $baseElement, 'Line ' . __LINE__. ' name should be set'
		);

		$this->assertAttributeEquals(
			$expected['elements'], 'elements', $baseElement, 'Line ' . __LINE__. ' elements should be set'
		);

		$this->assertAttributeEquals(
			$expected['glue'], 'glue', $baseElement, 'Line ' . __LINE__. ' glue should be set'
		);
	}

	/**
	 * Test the __toString magic method.
	 *
	 * @param   array   $element   base element values
	 * @param   array   $append    append element values
	 * @param   array   $expected  expected element values for elements field after append
	 * @param   string  $string    expected value of toString
	 *
	 * @return  void
	 *
	 * @since   11.1
	 * @dataProvider  dataTestAppend
	 */
	public function test__toString($element, $append, $expected, $string)
	{
		$baseElement = new JDatabaseQueryElement($element['name'], $element['elements'], $element['glue']);
		$appendElement = new JDatabaseQueryElement($append['name'], $append['elements'], $append['glue']);
		$baseElement->append($appendElement);
		$this->assertEquals($string, $baseElement->__toString());
	}

	/**
	 * Test the append method.
	 *
	 * @param   array   $element   base element values
	 * @param   array 	$append    append element values
	 * @param   array	$expected  expected element values for elements field after append
	 * @param   string	$string    expected value of toString (not used in this test)
	 *
	 * @return  void
	 *
	 * @since   11.1
	 * @dataProvider dataTestAppend
	 */

	public function testAppend($element, $append, $expected, $string)
	{
		$baseElement = new JDatabaseQueryElement($element['name'], $element['elements'], $element['glue']);
		$appendElement = new JDatabaseQueryElement($append['name'], $append['elements'], $append['glue']);
		$expectedElement = new JDatabaseQueryElement($expected['name'], $expected['elements'], $expected['glue']);
		$baseElement->append($appendElement);
		$this->assertAttributeEquals(array($expectedElement), 'elements', $baseElement);
	}
}